/*
 COPYRIGHT 2009 ESRI

 TRADE SECRETS: ESRI PROPRIETARY AND CONFIDENTIAL
 Unpublished material - all rights reserved under the
 Copyright Laws of the United States and applicable international
 laws, treaties, and conventions.

 For additional information, contact:
 Environmental Systems Research Institute, Inc.
 Attn: Contracts and Legal Services Department
 380 New York Street
 Redlands, California, 92373
 USA

 email: contracts@esri.com
 */
//>>built
require({cache:{"esri/layers/FeatureEditResult":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","esri/kernel"],function(_1,_2,_3,_4){var _5=_1(null,{declaredClass:"esri.layers.FeatureEditResult",constructor:function(_6){if(_6&&_2.isObject(_6)){this.objectId=_6.objectId;this.success=_6.success;if(!_6.success){var _7=_6.error;this.error=new Error();this.error.code=_7.code;this.error.message=_7.description;}}}});if(_3("extend-esri")){_2.setObject("layers.FeatureEditResult",_5,_4);}return _5;});},"esri/layers/MapImageLayer":function(){define(["dojo/_base/declare","dojo/_base/connect","dojo/_base/lang","dojo/_base/array","dojo/dom-construct","dojo/dom-style","esri/kernel","esri/config","esri/sniff","esri/domUtils","esri/geometry/Point","esri/geometry/webMercatorUtils","esri/layers/layer"],function(_8,_9,_a,_b,_c,_d,_e,_f,has,_10,_11,_12,_13){var _14=_8([_13],{declaredClass:"esri.layers.MapImageLayer","-chains-":{constructor:"manual"},constructor:function(_15){this.inherited(arguments,[null,_15]);this._mapImages=[];this.registerConnectEvents("esri.layers.MapImageLayer",true);var _16=_a.hitch;this._panStart=_16(this,this._panStart);this._pan=_16(this,this._pan);this._extentChange=_16(this,this._extentChange);this._zoom=_16(this,this._zoom);this._zoomStart=_16(this,this._zoomStart);this._scale=_16(this,this._scale);this._resize=_16(this,this._resize);_9.connect(this,"onSuspend",this,this._onSuspend);_9.connect(this,"onResume",this,this._onResume);this.loaded=true;this.onLoad(this);},opacity:1,_transform:_e._getDOMAccessor("transform"),addImage:function(_17){var _18=this._mapImages.push(_17);_18=_18-1;_17._idx=_18;_17._layer=this;if(this._div){this._createImage(_17,_18);}},removeImage:function(_19){if(_19){var idx=_19._idx,_1a=this._mapImages;if(_1a[idx]===_19){delete _1a[idx];var _1b=_19._node;if(_1b){this._clearEvents(_1b);_1b.e_idx=_1b.e_bl=_1b.e_tr=_1b.e_l=_1b.e_t=_1b.e_w=_1b.e_h=null;if(_1b.parentNode){_1b.parentNode.removeChild(_1b);_c.destroy(_1b);}}_19._node=_19._idx=_19._layer=null;}}},removeAllImages:function(){var _1c=this._mapImages,i,len=_1c.length;for(i=0;i<len;i++){var _1d=_1c[i];if(_1d){this.removeImage(_1d);}}this._mapImages=[];},getImages:function(){var _1e=this._mapImages,_1f=[],i,len=_1e.length;for(i=0;i<len;i++){if(_1e[i]){_1f.push(_1e[i]);}}return _1f;},setOpacity:function(_20){if(this.opacity!=_20){this._opacityChanged(this.opacity=_20);this.onOpacityChange();}},onOpacityChange:function(){},_opacityChanged:function(_21){var div=this._div,i,len,_22;if(div){if(!has("ie")||has("ie")>8){_d.set(div,"opacity",_21);}else{_22=div.childNodes;len=_22.length;for(i=0;i<len;i++){_d.set(_22[i],"opacity",_21);}}}},_createImage:function(_23,idx){var _24=_c.create("img");_d.set(_24,{position:"absolute"});if(has("ie")<=8){_d.set(_24,"opacity",this.opacity);}if(_23.rotation){var _25="rotate("+(360-_23.rotation)+"deg)";if(has("ie")<9){}else{_d.set(_24,this._transform,_25);_d.set(_24,"transform",_25);}}_23._node=_24;_24.e_idx=idx;_24.e_layer=this;_24.e_load=_9.connect(_24,"onload",_14.prototype._imageLoaded);_24.e_error=_9.connect(_24,"onerror",_14.prototype._imageError);_24.e_abort=_9.connect(_24,"onabort",_14.prototype._imageError);_24.src=_23.href;},_imageLoaded:function(evt,img){var _26=img||evt.target||evt.currentTarget,_27=_26.e_layer,_28=_27._mapImages[_26.e_idx],map=_27._map;if(map&&(map.__zooming||map.__panning||!_27._sr)){_27._standby.push(_26);return;}_27._clearEvents(_26);if(!_28||_28._node!==_26){return;}if(map){_27._attach(_28);}},_imageError:function(evt){var _29=evt.target||evt.currentTarget,_2a=_29.e_layer,_2b=_2a._mapImages[_29.e_idx];_2a._clearEvents(_29);if(_2b){_2b._node=null;}},_clearEvents:function(_2c){var _2d=_9.disconnect;_2d(_2c.e_load);_2d(_2c.e_error);_2d(_2c.e_abort);_2c.e_load=_2c.e_error=_2c.e_abort=_2c.e_layer=null;},_attach:function(_2e){var _2f=_2e.extent,_30=_2f.spatialReference,_31=this._sr,div=this._div,_32=_2e._node,_33=new _11({x:_2f.xmin,y:_2f.ymin,spatialReference:_30}),_34=new _11({x:_2f.xmax,y:_2f.ymax,spatialReference:_30});if(!_31.equals(_30)){if(_31.isWebMercator()&&_30.wkid===4326){_33=_12.geographicToWebMercator(_33);_34=_12.geographicToWebMercator(_34);}else{if(_30.isWebMercator()&&_31.wkid===4326){_33=_12.webMercatorToGeographic(_33);_34=_12.webMercatorToGeographic(_34);}}}_32.e_bl=_33;_32.e_tr=_34;if(_2e.visible){this._setPos(_32,div._left,div._top);(this._active||div).appendChild(_32);}},_setPos:function(_35,_36,_37){var _38=_35.e_bl,_39=_35.e_tr,map=this._map;_38=map.toScreen(_38);_39=map.toScreen(_39);var _3a=_38.x-_36,top=_39.y-_37,_3b=Math.abs(_39.x-_38.x),_3c=Math.abs(_38.y-_39.y),css={width:_3b+"px",height:_3c+"px"},_3d=this._mapImages[_35.e_idx];if(map.navigationMode==="css-transforms"){css[_e._css.names.transform]=_e._css.translate(_3a,top)+(_3d.rotation?(" "+_e._css.rotate(360-_3d.rotation)):"");}else{css.left=_3a+"px";css.top=top+"px";}_d.set(_35,css);_35.e_l=_3a;_35.e_t=top;_35.e_w=_3b;_35.e_h=_3c;},managedSuspension:true,_setMap:function(map,_3e){this.inherited(arguments);var div=this._div=_c.create("div",null,_3e),_3f=_e._css.names,css={position:"absolute"},vd=map.__visibleDelta;if(!has("ie")||has("ie")>8){css.opacity=this.opacity;}if(map.navigationMode==="css-transforms"){css[_3f.transform]=_e._css.translate(vd.x,vd.y);_d.set(div,css);div._left=vd.x;div._top=vd.y;css={position:"absolute",width:map.width+"px",height:map.height+"px",overflow:"visible"};this._active=_c.create("div",null,div);_d.set(this._active,css);this._passive=_c.create("div",null,div);_d.set(this._passive,css);}else{div._left=0;div._top=0;_d.set(div,css);}this._standby=[];var _40=this._mapImages,i,len=_40.length;for(i=0;i<len;i++){var _41=_40[i],_42=_41._node;if(!_42){this._createImage(_41,_41._idx);}}_10.hide(div);return div;},_unsetMap:function(map,_43){this._disconnect();var div=this._div;if(div){var _44=this._mapImages,i,len=_44.length;for(i=0;i<len;i++){var _45=_44[i];if(_45){var _46=_45._node;if(_46){this._clearEvents(_46);_46.e_idx=_46.e_bl=_46.e_tr=_46.e_l=_46.e_t=_46.e_w=_46.e_h=null;}_45._node=null;}}_43.removeChild(div);_c.destroy(div);}this._map=this._div=this._sr=this._active=this._passive=this._standby=null;this.inherited(arguments);},_onSuspend:function(){this._disconnect();_10.hide(this._div);},_onResume:function(evt){if(evt.firstOccurrence){this._sr=this._map.spatialReference;this._processStandbyList();}var map=this._map,div=this._div,vd=map.__visibleDelta;if(map.navigationMode==="css-transforms"){div._left=vd.x;div._top=vd.y;_d.set(div,_e._css.names.transform,_e._css.translate(div._left,div._top));}this._redraw(map.navigationMode==="css-transforms");this._connect(map);_10.show(div);},_connect:function(map){if(!this._connections){var _47=_9.connect,_48=(map.navigationMode==="css-transforms");this._connections=[_47(map,"onPanStart",this._panStart),_47(map,"onPan",this._pan),_47(map,"onExtentChange",this._extentChange),_48&&_47(map,"onZoomStart",this._zoomStart),_48?_47(map,"onScale",this._scale):_47(map,"onZoom",this._zoom),_48&&_47(map,"onResize",this._resize)];}},_disconnect:function(){if(this._connections){_b.forEach(this._connections,_9.disconnect);this._connections=null;}},_panStart:function(){this._panL=this._div._left;this._panT=this._div._top;},_pan:function(_49,_4a){var div=this._div;div._left=this._panL+_4a.x;div._top=this._panT+_4a.y;if(this._map.navigationMode==="css-transforms"){_d.set(div,_e._css.names.transform,_e._css.translate(div._left,div._top));}else{_d.set(div,{left:div._left+"px",top:div._top+"px"});}},_extentChange:function(_4b,_4c,_4d){if(_4d){this._redraw(this._map.navigationMode==="css-transforms");}else{if(_4c){this._pan(_4b,_4c);}}this._processStandbyList();},_processStandbyList:function(){var i,_4e=this._standby;if(_4e&&_4e.length){for(i=_4e.length-1;i>=0;i--){this._imageLoaded(null,_4e[i]);_4e.splice(i,1);}}},_redraw:function(_4f){if(_4f){var _50=this._passive,_51=_e._css.names;_d.set(_50,_51.transition,"none");this._moveImages(_50,this._active);_d.set(_50,_51.transform,"none");}var div=this._active||this._div,_52=this._div._left,_53=this._div._top,i,len=div.childNodes.length,_54;for(i=0;i<len;i++){_54=div.childNodes[i];this._setPos(_54,_52,_53);}},_zoom:function(_55,_56,_57){var div=this._div,_58=div._left,_59=div._top,i,len=div.childNodes.length,_5a;for(i=0;i<len;i++){_5a=div.childNodes[i];var _5b=_5a.e_w*_56,_5c=_5a.e_h*_56,_5d=(_57.x-_58-_5a.e_l)*(_5b-_5a.e_w)/_5a.e_w,_5e=(_57.y-_59-_5a.e_t)*(_5c-_5a.e_h)/_5a.e_h;_5d=isNaN(_5d)?0:_5d;_5e=isNaN(_5e)?0:_5e;_d.set(_5a,{left:(_5a.e_l-_5d)+"px",top:(_5a.e_t-_5e)+"px",width:_5b+"px",height:_5c+"px"});}},_zoomStart:function(){this._moveImages(this._active,this._passive);},_moveImages:function(_5f,_60){var _61=_5f.childNodes,i,len=_61.length;if(len>0){for(i=len-1;i>=0;i--){_60.appendChild(_61[i]);}}},_scale:function(mtx,_62){var css={},_63=_e._css.names,_64=this._passive;_d.set(_64,_63.transition,_62?"none":(_63.transformName+" "+_f.defaults.map.zoomDuration+"ms ease"));css[_63.transform]=_e._css.matrix(mtx);_d.set(_64,_63.transform,_e._css.matrix(mtx));},_resize:function(_65,_66,_67){_d.set(this._active,{width:_66+"px",height:_67+"px"});_d.set(this._passive,{width:_66+"px",height:_67+"px"});}});if(has("extend-esri")){_a.setObject("layers.MapImageLayer",_14,_e);}return _14;});},"esri/layers/WebTiledLayer":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/_base/url","dojo/has","dojo/string","esri/kernel","esri/urlUtils","esri/SpatialReference","esri/geometry/Extent","esri/layers/TiledMapServiceLayer","esri/layers/TileInfo"],function(_68,_69,_6a,Url,has,_6b,_6c,_6d,_6e,_6f,_70,_71){var _72=_68(_70,{declaredClass:"esri.layers.WebTiledLayer",constructor:function(_73,_74){if(!_74){_74={};}this.urlTemplate=_73;var _75=new _6f(-20037508.342787,-20037508.34278,20037508.34278,20037508.342787,new _6e({wkid:102100}));var _76=new _6f(-20037508.342787,-20037508.34278,20037508.34278,20037508.342787,new _6e({wkid:102100}));this.initialExtent=_74.initialExtent||_75;this.fullExtent=_74.fullExtent||_76;if(_74.tileInfo){this.tileInfo=_74.tileInfo;}else{var _77=[{"level":0,"resolution":156543.033928,"scale":591657527.591555},{"level":1,"resolution":78271.5169639999,"scale":295828763.795777},{"level":2,"resolution":39135.7584820001,"scale":147914381.897889},{"level":3,"resolution":19567.8792409999,"scale":73957190.948944},{"level":4,"resolution":9783.93962049996,"scale":36978595.474472},{"level":5,"resolution":4891.96981024998,"scale":18489297.737236},{"level":6,"resolution":2445.98490512499,"scale":9244648.868618},{"level":7,"resolution":1222.99245256249,"scale":4622324.434309},{"level":8,"resolution":611.49622628138,"scale":2311162.217155},{"level":9,"resolution":305.748113140558,"scale":1155581.108577},{"level":10,"resolution":152.874056570411,"scale":577790.554289},{"level":11,"resolution":76.4370282850732,"scale":288895.277144},{"level":12,"resolution":38.2185141425366,"scale":144447.638572},{"level":13,"resolution":19.1092570712683,"scale":72223.819286},{"level":14,"resolution":9.55462853563415,"scale":36111.909643},{"level":15,"resolution":4.77731426794937,"scale":18055.954822},{"level":16,"resolution":2.38865713397468,"scale":9027.977411},{"level":17,"resolution":1.19432856685505,"scale":4513.988705},{"level":18,"resolution":0.597164283559817,"scale":2256.994353},{"level":19,"resolution":0.298582141647617,"scale":1128.497176}];var _78=new _71({"rows":256,"cols":256,"origin":{"x":-20037508.342787,"y":20037508.342787},"spatialReference":{"wkid":102100},"lods":_77});this.tileInfo=_78;}this.spatialReference=new _6e(this.tileInfo.spatialReference.toJson());this.copyright=_74.copyright||"";var url=new Url(_73);var _79=url.scheme+"://"+url.authority+"/";this.urlPath=_73.substring(_79.length);this.tileServers=_74.tileServers||[];if(url.authority.indexOf("{subDomain}")===-1){this.tileServers.push(_79);}if(_74.subDomains&&_74.subDomains.length>0&&url.authority.split(".").length>1){this.subDomains=_74.subDomains;var _7a;_6a.forEach(_74.subDomains,function(_7b,idx){if(url.authority.indexOf("${subDomain}")>-1){_7a=url.scheme+"://"+_6b.substitute(url.authority,{subDomain:_7b})+"/";}else{if(url.authority.indexOf("{subDomain}")>-1){_7a=url.scheme+"://"+url.authority.replace(/\{subDomain\}/gi,_7b)+"/";}}this.tileServers.push(_7a);},this);}this.tileServers=_6a.map(this.tileServers,function(_7c){if(_7c.charAt(_7c.length-1)!=="/"){_7c+="/";}return _7c;});this._levelToLevelValue=[];_6a.forEach(this.tileInfo.lods,function(_7d){this._levelToLevelValue[_7d.level]=_7d.levelValue?_7d.levelValue:_7d.level;},this);this.loaded=true;this.onLoad(this);this.registerConnectEvents("esri.layers.WebTiledLayer",true);},getTileUrl:function(_7e,row,col){_7e=this._levelToLevelValue[_7e];var _7f=this.tileServers[row%this.tileServers.length];var _80=_7f+_6b.substitute(this.urlPath,{level:_7e,col:col,row:row});_80=_80.replace(/\{level\}/gi,_7e);_80=_80.replace(/\{row\}/gi,row);_80=_80.replace(/\{col\}/gi,col);return _6d.addProxy(_80);}});if(has("extend-esri")){_69.setObject("layers.WebTiledLayer",_72,_6c);}return _72;});},"esri/layers/ServiceGeneratedFeatureCollection":function(){define(["dojo/_base/declare","dojo/_base/connect","dojo/_base/lang","dojo/_base/array","dojo/dom-construct","dojo/dom-style","dojo/has","esri/kernel","esri/SpatialReference","esri/geometry/Extent","esri/geometry/webMercatorUtils","esri/renderers/SimpleRenderer","esri/layers/layer","esri/layers/FeatureLayer","esri/dijit/PopupTemplate"],function(_81,_82,_83,_84,_85,_86,has,_87,_88,_89,_8a,_8b,_8c,_8d,_8e){var _8f=_81([_8c],{declaredClass:"esri.layers._ServiceGeneratedFeatureCollection",constructor:function(url,_90){this.pointSymbol=_90&&_90.pointSymbol;this.polylineSymbol=_90&&_90.polylineSymbol;this.polygonSymbol=_90&&_90.polygonSymbol;this._outSR=(_90&&(_90.outSpatialReference||_90.outSR))||new _88({wkid:4326});this._options=_90;this.registerConnectEvents("esri.layers._ServiceGeneratedFeatureCollection",true);},parse:function(){console.error("parse function has not been implemented");},getFeatureLayers:function(){var _91=[];if(this._fLayers){_91=_91.concat(this._fLayers);}return _91;},onRefresh:function(){},refresh:function(){if(!this.loaded||!this._map||this._io){return;}this._createLayer();},_createLayer:function(_92){var _93=this;this._fireUpdateStart();var _94=this.parse(_92);_94.addCallback(function(_95){_93._io=null;_93._initLayer(_95);});_94.addErrback(function(err){_93._io=null;err=_83.mixin(new Error(),err);err.message="Unable to load resource: "+_93.url+" "+(err.message||"");_93._fireUpdateEnd(err);_93.onError(err);});},_initLayer:function(_96){if(this.loaded){this._removeInternalLayers();}this.name=_96.name;this.description=_96.description;this.snippet=_96.snippet;if(_96.visibility!==undefined){this.defaultVisibility=this.visible=!!_96.visibility;}else{this.defaultVisibility=this.visible=true;}this.featureInfos=_96.featureInfos;this.fullExtent=this.initialExtent=new _89(_96.lookAtExtent);this.copyright=_96.author||_96.copyright;var _97;var _98=_83.getObject("featureCollection.layers",false,_96);if(_98&&_98.length>0){this._fLayers=[];_84.forEach(_98,function(_99,i){var _9a=_83.getObject("featureSet.features",false,_99),_9b;if(_9a&&_9a.length>0){_97=_83.mixin({outFields:["*"],infoTemplate:_99.popupInfo?new _8e(_99.popupInfo):null,editable:false},this._options);if(_97.id){_97.id=_97.id+"_"+i;}_99.layerDefinition.capabilities="Query,Data";_9b=new _8d(_99,_97);if(_9b.geometryType){this["_"+_9b.geometryType]=_9b;}this._fLayers.push(_9b);}},this);if(this._fLayers.length===0){delete this._fLayers;}}this.items=[];if(this._esriGeometryPoint){this.items=this.items.concat(this._esriGeometryPoint.graphics);if(this.pointSymbol){var _9c=new _8b(this.pointSymbol);this._esriGeometryPoint.setRenderer(_9c);}}if(this._esriGeometryPolyline){this.items=this.items.concat(this._esriGeometryPolyline.graphics);if(this.polylineSymbol){var _9d=new _8b(this.polylineSymbol);this._esriGeometryPolyline.setRenderer(_9d);}}if(this._esriGeometryPolygon){this.items=this.items.concat(this._esriGeometryPolygon.graphics);if(this.polygonSymbol){var _9e=new _8b(this.polygonSymbol);this._esriGeometryPolygon.setRenderer(_9e);}}this._fireUpdateEnd();if(this.loaded){this._addInternalLayers();this.onRefresh();}},_addInternalLayers:function(){var map=this._map;this._fireUpdateStart();var _9f=map.spatialReference,_a0=this._outSR,_a1;if(_9f.wkid){_a1=(_9f._isWebMercator()&&_a0._isWebMercator())||(_9f.wkid===_a0.wkid);}else{if(_9f.wkt){_a1=(_9f.wkt===_a0.wkt);}else{console.log("_setMap - map has invalid spatial reference");return;}}if(!_a1){if(_9f._isWebMercator()&&_a0.wkid===4326){this._converter=_8a.geographicToWebMercator;}else{if(_a0._isWebMercator()&&_9f.wkid===4326){this._converter=_8a.webMercatorToGeographic;}else{console.log("_setMap - unsupported workflow. Spatial reference of the map and layer do not match, and the conversion cannot be done on the client.");return;}}}var _a2=this._fLayers;if(_a2&&_a2.length>0){_84.forEach(_a2,function(_a3){if(this._converter){var _a4=_a3.graphics,i,_a5,len=_a4?_a4.length:0;for(i=0;i<len;i++){_a5=_a4[i].geometry;if(_a5){_a4[i].setGeometry(this._converter(_a5));}}}map.addLayer(_a3);},this);}this.setVisibility(this.visible);},_removeInternalLayers:function(){var map=this._map;if(map){_84.forEach(this.getFeatureLayers(),map.removeLayer,map);}},onVisibilityChange:function(_a6){this._fireUpdateStart();_84.forEach(this.getFeatureLayers(),function(_a7){_a7.setVisibility(_a6);});this._fireUpdateEnd();},_setMap:function(map,_a8){this.inherited(arguments);this._map=map;var div=this._div=_85.create("div",null,_a8);_86.set(div,"position","absolute");this._addInternalLayers();this.evaluateSuspension();return div;},_unsetMap:function(map,_a9){if(this._io){this._io.cancel();}_82.disconnect(this._extChgHandle);delete this._extChgHandle;this._removeInternalLayers();var div=this._div;if(div){_a9.removeChild(div);_85.destroy(div);}this._div=null;this.inherited(arguments);}});if(has("extend-esri")){_83.setObject("layers._ServiceGeneratedFeatureCollection",_8f,_87);}return _8f;});},"esri/layers/KMLGroundOverlay":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","esri/kernel","esri/lang","esri/layers/MapImage"],function(_aa,_ab,has,_ac,_ad,_ae){var _af=_aa([_ae],{declaredClass:"esri.layers.KMLGroundOverlay",constructor:function(_b0){if(_ad.isDefined(this.visibility)){this.visible=!!this.visibility;}}});if(has("extend-esri")){_ab.setObject("layers.KMLGroundOverlay",_af,_ac);}return _af;});},"dojo/data/util/simpleFetch":function(){define(["../../_base/lang","../../_base/kernel","./sorter"],function(_b1,_b2,_b3){var _b4={};_b1.setObject("dojo.data.util.simpleFetch",_b4);_b4.errorHandler=function(_b5,_b6){if(_b6.onError){var _b7=_b6.scope||_b2.global;_b6.onError.call(_b7,_b5,_b6);}};_b4.fetchHandler=function(_b8,_b9){var _ba=_b9.abort||null,_bb=false,_bc=_b9.start?_b9.start:0,_bd=(_b9.count&&(_b9.count!==Infinity))?(_bc+_b9.count):_b8.length;_b9.abort=function(){_bb=true;if(_ba){_ba.call(_b9);}};var _be=_b9.scope||_b2.global;if(!_b9.store){_b9.store=this;}if(_b9.onBegin){_b9.onBegin.call(_be,_b8.length,_b9);}if(_b9.sort){_b8.sort(_b3.createSortFunction(_b9.sort,this));}if(_b9.onItem){for(var i=_bc;(i<_b8.length)&&(i<_bd);++i){var _bf=_b8[i];if(!_bb){_b9.onItem.call(_be,_bf,_b9);}}}if(_b9.onComplete&&!_bb){var _c0=null;if(!_b9.onItem){_c0=_b8.slice(_bc,_bd);}_b9.onComplete.call(_be,_c0,_b9);}};_b4.fetch=function(_c1){_c1=_c1||{};if(!_c1.store){_c1.store=this;}this._fetchItems(_c1,_b1.hitch(this,"fetchHandler"),_b1.hitch(this,"errorHandler"));return _c1;};return _b4;});},"esri/layers/KMLLayer":function(){define(["dojo/_base/kernel","dojo/_base/declare","dojo/_base/connect","dojo/_base/lang","dojo/_base/array","dojo/_base/json","dojo/_base/sniff","dojo/io-query","dojo/dom-construct","dojo/dom-style","esri/kernel","esri/config","esri/lang","esri/request","esri/SpatialReference","esri/geometry/webMercatorUtils","esri/dijit/PopupTemplate","esri/layers/layer","esri/layers/KMLFolder","esri/layers/KMLGroundOverlay","esri/layers/MapImageLayer","esri/layers/FeatureLayer"],function(_c2,_c3,_c4,_c5,_c6,_c7,has,ioq,_c8,_c9,_ca,_cb,_cc,_cd,_ce,_cf,_d0,_d1,_d2,_d3,_d4,_d5){var _d6=_c3([_d1],{declaredClass:"esri.layers.KMLLayer",serviceUrl:location.protocol+"//utility.arcgis.com/sharing/kml",constructor:function(url,_d7){if(!url){console.log("KMLLayer:constructor - please provide url for the KML file");}this._outSR=(_d7&&_d7.outSR)||new _ce({wkid:4326});this._options=_d7;if(_cb.defaults.kmlService){this.serviceUrl=_cb.defaults.kmlService;}var _d8=(this.linkInfo=_d7&&_d7.linkInfo);if(_d8){this.visible=!!_d8.visibility;this._waitingForMap=!!_d8.viewFormat;}if(!_d8||(_d8&&_d8.visibility&&!this._waitingForMap)){this._parseKml();}this.refresh=_c5.hitch(this,this.refresh);this.registerConnectEvents("esri.layers.KMLLayer",true);},getFeature:function(_d9){if(!_d9){return;}var _da=_d9.type,id=_d9.id,_db,i,len;switch(_da){case "esriGeometryPoint":case "esriGeometryPolyline":case "esriGeometryPolygon":var _dc=this["_"+_da];if(_dc){_db=_c5.getObject("_mode._featureMap."+id,false,_dc);}break;case "GroundOverlay":var _dd=this._groundLyr;if(_dd){var _de=_dd.getImages();len=_de.length;for(i=0;i<len;i++){if(_de[i].id===id){_db=_de[i];break;}}}break;case "ScreenOverlay":break;case "NetworkLink":_c6.some(this._links,function(_df){if(_df.linkInfo&&_df.linkInfo.id===id){_db=_df;return true;}else{return false;}});break;case "Folder":var _e0=this.folders;len=_e0?_e0.length:0;for(i=0;i<len;i++){if(_e0[i].id===id){_db=_e0[i];break;}}break;default:console.log("KMLLayer:getFeature - unknown feature type");break;}return _db;},getLayers:function(){var _e1=[];if(this._groundLyr){_e1.push(this._groundLyr);}if(this._fLayers){_e1=_e1.concat(this._fLayers);}if(this._links){_c6.forEach(this._links,function(_e2){if(_e2.declaredClass){_e1.push(_e2);}});}return _e1;},setFolderVisibility:function(_e3,_e4){if(!_e3){return;}this._fireUpdateStart();_e3.visible=_e4;if(_e4){_e4=this._areLocalAncestorsVisible(_e3);}this._setState(_e3,_e4);this._fireUpdateEnd();},onRefresh:function(){},_parseKml:function(map){var _e5=this;this._fireUpdateStart();this._io=_cd({url:this.serviceUrl,content:{url:this._url.path+this._getQueryParameters(map),model:"simple",folders:"",refresh:this.loaded?true:undefined,outSR:_c7.toJson(this._outSR.toJson())},callbackParamName:"callback",load:function(_e6){_e5._io=null;_e5._initLayer(_e6);},error:function(err){_e5._io=null;err=_c5.mixin(new Error(),err);err.message="Unable to load KML: "+_e5.url+" "+(err.message||"");_e5._fireUpdateEnd(err);_e5.onError(err);}});},_initLayer:function(_e7){if(this.loaded){this._removeInternalLayers();}this.name=_e7.name;this.description=_e7.description;this.snippet=_e7.snippet;this.visibility=_e7.visibility;this.featureInfos=_e7.featureInfos;var i,len;var _e8=(this.folders=_e7.folders),_e9=[],_ea;if(_e8){len=_e8.length;for(i=0;i<len;i++){_ea=(_e8[i]=new _d2(_e8[i]));if(_ea.parentFolderId===-1){_e9.push(_ea);}}}var _eb=(this._links=_e7.networkLinks),_ec;len=_eb?_eb.length:0;for(i=0;i<len;i++){if(_eb[i].viewRefreshMode&&_eb[i].viewRefreshMode.toLowerCase().indexOf("onregion")!==-1){continue;}_ec=_c5.mixin({},this._options);_ec.linkInfo=_eb[i];if(_ec.id){_ec.id=_ec.id+"_"+i;}_eb[i]=new _d6(_eb[i].href,_ec);_eb[i]._parentLayer=this;_eb[i]._parentFolderId=this._getLinkParentId(_eb[i].linkInfo.id);}var _ed=_e7.groundOverlays;if(_ed&&_ed.length>0){_ec=_c5.mixin({},this._options);if(_ec.id){_ec.id=_ec.id+"_"+"mapImage";}var _ee=(this._groundLyr=new _d4(_ec));len=_ed.length;for(i=0;i<len;i++){_ee.addImage(new _d3(_ed[i]));}}var _ef=_c5.getObject("featureCollection.layers",false,_e7);if(_ef&&_ef.length>0){this._fLayers=[];_c6.forEach(_ef,function(_f0,i){var _f1=_c5.getObject("featureSet.features",false,_f0),_f2;if(_f1&&_f1.length>0){_ec=_c5.mixin({outFields:["*"],infoTemplate:_f0.popupInfo?new _d0(_f0.popupInfo):null,editable:false},this._options);if(_ec.id){_ec.id=_ec.id+"_"+i;}_f0.layerDefinition.capabilities="Query,Data";_f2=new _d5(_f0,_ec);if(_f2.geometryType){this["_"+_f2.geometryType]=_f2;}this._fLayers.push(_f2);}},this);if(this._fLayers.length===0){delete this._fLayers;}}len=_e9.length;for(i=0;i<len;i++){_ea=_e9[i];this._setState(_ea,_ea.visible);}this._fireUpdateEnd();if(this.loaded){this._addInternalLayers();this.onRefresh();}else{this.loaded=true;this.onLoad(this);}},_addInternalLayers:function(){var map=this._map;this._fireUpdateStart();if(this._links){_c6.forEach(this._links,function(_f3){if(_f3.declaredClass){map.addLayer(_f3);if(_f3._waitingForMap){_f3._waitingForMap=null;if(_f3.visible){_f3._parseKml(map);}else{_f3._wMap=map;}}}});}var _f4=map.spatialReference,_f5=this._outSR,_f6;if(!_f4.equals(_f5)){if(_f4.isWebMercator()&&_f5.wkid===4326){_f6=_cf.geographicToWebMercator;}else{if(_f5.isWebMercator()&&_f4.wkid===4326){_f6=_cf.webMercatorToGeographic;}else{console.log("KMLLayer:_setMap - unsupported workflow. Spatial reference of the map and kml layer do not match, and the conversion cannot be done on the client.");return;}}}if(this._groundLyr){if(_f6){_c6.forEach(this._groundLyr.getImages(),function(_f7){_f7.extent=_f6(_f7.extent);});}map.addLayer(this._groundLyr);}var _f8=this._fLayers;if(_f8&&_f8.length>0){_c6.forEach(_f8,function(_f9){if(_f6){var _fa=_f9.graphics,i,_fb,len=_fa?_fa.length:0;for(i=0;i<len;i++){_fb=_fa[i].geometry;if(_fb){_fa[i].setGeometry(_f6(_fb));}}}map.addLayer(_f9);});}this.onVisibilityChange(this.visible);},_removeInternalLayers:function(){var map=this._map;if(this._links){_c6.forEach(this._links,function(_fc){if(_fc.declaredClass&&_fc._io){_fc._io.cancel();}});}if(map){_c6.forEach(this.getLayers(),map.removeLayer,map);}},_setState:function(_fd,_fe){var _ff=_fd.featureInfos,info,_100,i,len=_ff?_ff.length:0,_101=_fe?"show":"hide";for(i=0;i<len;i++){info=_ff[i];_100=this.getFeature(info);if(!_100){continue;}if(info.type==="Folder"){this._setState(_100,_fe&&_100.visible);}else{if(info.type==="NetworkLink"){this._setInternalVisibility(_100,_fe);}else{_100[_101]();}}}},_areLocalAncestorsVisible:function(_102){var _103=_102.parentFolderId,_104=_102.visible;while(_104&&_103!==-1){var _105=this.getFeature({type:"Folder",id:_103});_104=_104&&_105.visible;_103=_105.parentFolderId;}return _104;},_setInternalVisibility:function(_106,_107){var _108=_106._parentLayer,_109=_106._parentFolderId;_107=_107&&_106.visible;while(_107&&_108){_107=_107&&_108.visible;if(_109>-1){_107=_107&&_108._areLocalAncestorsVisible(_108.getFeature({type:"Folder",id:_109}));}_109=_108._parentFolderId;_108=_108._parentLayer;}this._setIntState(_106,_107);},_setIntState:function(link,_10a){if(!link){return;}_c6.forEach(link.getLayers(),function(_10b){if(_10b.linkInfo){link._setIntState(_10b,_10a&&_10b.visible&&link._areLocalAncestorsVisible(link.getFeature({type:"Folder",id:_10b._parentFolderId})));}else{_10b.setVisibility(_10a);}});},_getLinkParentId:function(id){var _10c=-1;if(this.folders){_c6.some(this.folders,function(_10d){if(_10d.networkLinkIds&&_c6.indexOf(_10d.networkLinkIds,id)!==-1){_10c=_10d.id;return true;}return false;});}return _10c;},_checkAutoRefresh:function(){var _10e=this.linkInfo;if(_10e){if(this.visible){if(this.loaded&&this._map){var _10f=_10e.refreshMode,_110=_10e.refreshInterval,_111=_10e.viewRefreshMode,_112=_10e.viewRefreshTime;if(_10f&&_10f.toLowerCase().indexOf("oninterval")!==-1&&_110>0){this._stopAutoRefresh();this._timeoutHandle=setTimeout(this.refresh,_110*1000);}if(_111&&_111.toLowerCase().indexOf("onstop")!==-1&&_112>0){if(!this._extChgHandle){this._extChgHandle=_c4.connect(this._map,"onExtentChange",this,this._extentChanged);}}}}else{this._stopAutoRefresh();_c4.disconnect(this._extChgHandle);delete this._extChgHandle;}}},_stopAutoRefresh:function(){clearTimeout(this._timeoutHandle);this._timeoutHandle=null;},_getQueryParameters:function(map){map=map||this._map;var _113={},_114=this.linkInfo,_115=map&&map.extent,_116;if(this._url.query){_c5.mixin(_113,this._url.query);_116=!!this._url.query.token;}if(_ca.id&&!_116){var _117=_ca.id.findCredential(this._url.path);if(_117){_113.token=_117.token;}}if(_114){var _118=_114.viewFormat,_119=_114.httpQuery,_11a=_114.viewBoundScale;if(_115&&_118){var _11b=_115,_11c=_115,sr=_115.spatialReference;if(sr){if(sr.isWebMercator()){_11b=_cf.webMercatorToGeographic(_115);}else{if(sr.wkid===4326){_11c=_cf.geographicToWebMercator(_115);}}}var _11d=_11b.getCenter(),_11e=Math.max(_11c.getWidth(),_11c.getHeight());if(_11a){_11b=_11b.expand(_11a);}_118=_118.replace(/\[bboxWest\]/ig,_11b.xmin).replace(/\[bboxEast\]/ig,_11b.xmax).replace(/\[bboxSouth\]/ig,_11b.ymin).replace(/\[bboxNorth\]/ig,_11b.ymax).replace(/\[lookatLon\]/ig,_11d.x).replace(/\[lookatLat\]/ig,_11d.y).replace(/\[lookatRange\]/ig,_11e).replace(/\[lookatTilt\]/ig,0).replace(/\[lookatHeading\]/ig,0).replace(/\[lookatTerrainLon\]/ig,_11d.x).replace(/\[lookatTerrainLat\]/ig,_11d.y).replace(/\[lookatTerrainAlt\]/ig,0).replace(/\[cameraLon\]/ig,_11d.x).replace(/\[cameraLat\]/ig,_11d.y).replace(/\[cameraAlt\]/ig,_11e).replace(/\[horizFov\]/ig,60).replace(/\[vertFov\]/ig,60).replace(/\[horizPixels\]/ig,map.width).replace(/\[vertPixels\]/ig,map.height).replace(/\[terrainEnabled\]/ig,0);_c5.mixin(_113,ioq.queryToObject(_118));}if(_119){_119=_119.replace(/\[clientVersion\]/ig,_ca.version).replace(/\[kmlVersion\]/ig,2.2).replace(/\[clientName\]/ig,"ArcGIS API for JavaScript").replace(/\[language\]/ig,_c2.locale);_c5.mixin(_113,ioq.queryToObject(_119));}}var _11f=[],_120;for(_120 in _113){if(_cc.isDefined(_113[_120])){_11f.push(_120+"="+_113[_120]);}}_11f=_11f.join("&");return _11f?("?"+_11f):"";},_setMap:function(map,_121){this._map=map;var div=this._div=_c8.create("div",null,_121);_c9.set(div,"position","absolute");this._addInternalLayers();return div;},_unsetMap:function(map,_122){if(this._io){this._io.cancel();}this._stopAutoRefresh();_c4.disconnect(this._extChgHandle);delete this._extChgHandle;this._removeInternalLayers();var div=this._div;if(div){_122.removeChild(div);_c8.destroy(div);}this._map=this._wMap=this._div=null;},onVisibilityChange:function(_123){if(!this.loaded){if(this.linkInfo&&_123){if(!this._waitingForMap){this._parseKml(this._wMap);}}return;}this._fireUpdateStart();this._setInternalVisibility(this,_123);this._checkAutoRefresh();this._fireUpdateEnd();},refresh:function(){if(!this.loaded||!this._map||this._io){return;}this._parseKml();},_extentChanged:function(){this._stopAutoRefresh();this._timeoutHandle=setTimeout(this.refresh,this.linkInfo.viewRefreshTime*1000);}});if(has("extend-esri")){_c5.setObject("layers.KMLLayer",_d6,_ca);}return _d6;});},"dojo/data/util/sorter":function(){define(["../../_base/lang"],function(lang){var _124={};lang.setObject("dojo.data.util.sorter",_124);_124.basicComparator=function(a,b){var r=-1;if(a===null){a=undefined;}if(b===null){b=undefined;}if(a==b){r=0;}else{if(a>b||a==null){r=1;}}return r;};_124.createSortFunction=function(_125,_126){var _127=[];function _128(attr,dir,comp,s){return function(_129,_12a){var a=s.getValue(_129,attr);var b=s.getValue(_12a,attr);return dir*comp(a,b);};};var _12b;var map=_126.comparatorMap;var bc=_124.basicComparator;for(var i=0;i<_125.length;i++){_12b=_125[i];var attr=_12b.attribute;if(attr){var dir=(_12b.descending)?-1:1;var comp=bc;if(map){if(typeof attr!=="string"&&("toString" in attr)){attr=attr.toString();}comp=map[attr]||bc;}_127.push(_128(attr,dir,comp,_126));}}return function(rowA,rowB){var i=0;while(i<_127.length){var ret=_127[i++](rowA,rowB);if(ret!==0){return ret;}}return 0;};};return _124;});},"esri/layers/OnDemandMode":function(){define(["dojo/_base/declare","dojo/_base/connect","dojo/_base/lang","dojo/_base/array","dojo/has","esri/kernel","esri/geometry/Point","esri/tasks/query","esri/layers/RenderMode","esri/layers/GridLayout"],function(_12c,_12d,lang,_12e,has,_12f,_130,_131,_132,_133){var _134=_12c([_132],{declaredClass:"esri.layers._OnDemandMode",constructor:function(_135){this.featureLayer=_135;this._featureMap={};this._queryErrorHandler=lang.hitch(this,this._queryErrorHandler);},initialize:function(map){this.inherited(arguments);var _136=this.featureLayer,_137=_136._srInfo;this._gridLayer=new _133(new _130(_137?_137.valid[0]:map.extent.xmin,map.extent.ymax,map.spatialReference),{width:_136._tileWidth,height:_136._tileHeight},{width:map.width,height:map.height},_137);this._cellMap={};this._gridLayer.setResolution(map.extent);},startup:function(){this._ioQueue=[];if(!this.featureLayer.suspended){this._zoomHandler();this._enableConnectors();}},propertyChangeHandler:function(type){if(this._init){if(type<2){this._zoomHandler();}else{console.log("FeatureLayer: layer in on-demand mode does not support time definitions. Layer id = "+this.featureLayer.id+", Layer URL = "+this.featureLayer.url);}}},destroy:function(){this._disableConnectors();this.inherited(arguments);},drawFeature:function(_138){var _139=this._gridLayer,geom=_138.geometry,_13a=[];if(!geom){return;}_13a=_139.getCellsInExtent((geom.type==="point")?{xmin:geom.x,ymin:geom.y,xmax:geom.x,ymax:geom.y}:geom.getExtent(),false).cells;var _13b=this._cellMap,i,cell,oid=_138.attributes[this.featureLayer.objectIdField],_13c,row,col;for(i=0;i<_13a.length;i++){cell=_13a[i];_13c=cell.latticeID;row=cell.row;col=cell.col;if(_13c){cell=(_13b[_13c]=(_13b[_13c]||cell));}else{_13b[row]=_13b[row]||{};cell=(_13b[row][col]=(_13b[row][col]||cell));}cell.features=cell.features||[];cell.features.push(_138);this._addFeatureIIf(oid,_138);this._incRefCount(oid);}},suspend:function(){if(!this._init){return;}this._disableConnectors();},resume:function(){if(!this._init){return;}this._enableConnectors();this._zoomHandler();},refresh:function(){this._zoomHandler();},_enableConnectors:function(){var map=this.map;this._zoomConnect=_12d.connect(map,"onZoomEnd",this,this._zoomHandler);this._panConnect=_12d.connect(map,"onPanEnd",this,this._panHandler);this._resizeConnect=_12d.connect(map,"onResize",this,this._panHandler);},_disableConnectors:function(){_12d.disconnect(this._zoomConnect);_12d.disconnect(this._panConnect);_12d.disconnect(this._resizeConnect);},_zoomHandler:function(){this._processIOQueue(true);var _13d=this.featureLayer,map=this.map;if(_13d.suspended){return;}_13d._fireUpdateStart();this._clearIIf();var _13e=_13d._trackManager;if(_13e){_13e.clearTracks();}this._cellMap={};this._gridLayer.setResolution(map.extent);this._sendRequest();},_panHandler:function(){this.featureLayer._fireUpdateStart();this._sendRequest(this.featureLayer._resized&&arguments[0]);},_getRequestId:function(_13f,cell){var id="_"+_13f.name+_13f.layerId+_13f._ulid+"_"+cell.resolution+"_"+(cell.latticeID||(cell.row+"_"+cell.col));return id.replace(/[^a-zA-Z0-9\_]+/g,"_");},_sendRequest:function(_140){this._exceeds=false;var _141=this.featureLayer,map=this.map,_142=_140||map.extent,_143=this._gridLayer.getCellsInExtent(_142,_141.latticeTiling),_144=_143.cells;if(!_141.isEditable()){var _145=this._cellMap;_144=_12e.filter(_144,function(cell){if(cell.lattice){if(_145[cell.latticeID]){return false;}}else{if(_145[cell.row]&&_145[cell.row][cell.col]){return false;}}return true;});}var _146=_141.getOutFields(),_147=_141.getDefinitionExpression(),time=_141._getOffsettedTE(_141._mapTimeExtent),_148=_141._usePatch,_149=this._ioQueue,i,self=this,func=this._drawFeatures,cell,_14a,_14b;this._pending=this._pending||0;for(i=0;i<_144.length;i++){cell=_144[i];_14a=new _131();_14a.geometry=cell.extent||cell.lattice;_14a.outFields=_146;_14a.where=_147;if(_141.latticeTiling&&cell.extent){_14a.spatialRelationship=_131.SPATIAL_REL_CONTAINS;}_14a.returnGeometry=true;_14a.timeExtent=time;_14a.maxAllowableOffset=_141._maxOffset;if(_141._ts){_14a._ts=(new Date()).getTime();}_14b=null;if(_148){_14b=this._getRequestId(_141,cell);if(this._isPending(_14b)){continue;}}this._pending++;_149.push(_141._task.execute(_14a,function(){var _14c=cell;return function(_14d){func.apply(self,[_14d,_14c]);};}.call(this),this._queryErrorHandler,_14b));}this._removeOldCells(_142);this._endCheck();},_drawFeatures:function(_14e,cell){this._exceeds=this._exceeds||_14e.exceededTransferLimit;this._finalizeIO();var _14f=this.featureLayer,map=this.map,_150=map.extent,_151=cell.extent,row=cell.row,col=cell.col,_152=_14f.objectIdField,_153=_14e.features,_154=this._gridLayer,_155=this._cellMap,i,len,_156=cell.latticeID,_157=_156?_155[_156]:(_155[row]&&_155[row][col]);if((cell.resolution!=_154._resolution)||(_156?(_156!==_154.getLatticeID(_150)):(!_154.intersects(_151,_150)))){if(_157){this._removeCell(row,col,_156);}}else{if(_157){this._updateCell(_157,_153);}else{cell.features=_153;if(_156){_155[_156]=cell;}else{_155[row]=_155[row]||{};_155[row][col]=cell;}len=_153.length;for(i=0;i<len;i++){var _158=_153[i];var oid=_158.attributes[_152];this._addFeatureIIf(oid,_158);this._incRefCount(oid);}}}this._endCheck();},_queryErrorHandler:function(err){this._finalizeIO();this.featureLayer._errorHandler(err);this._endCheck(true);},_finalizeIO:function(){this._purgeRequests();this._pending--;},_endCheck:function(_159){if(this._pending===0){this._processIOQueue();var _15a=this.featureLayer,_15b=_15a._trackManager;if(_15b){_15b.clearTracks();_15b.addFeatures(_15a.graphics);if(_15a._ager){_12e.forEach(_15a.graphics,function(_15c){if(_15c._shape){_15a._repaint(_15c);}});}_15b.moveLatestToFront();_15b.drawTracks();}this.featureLayer._fireUpdateEnd(_159&&new Error("FeatureLayer: an error occurred while updating the layer"),this._exceeds?{queryLimitExceeded:true}:null);if(this._exceeds){_15a.onQueryLimitExceeded();}}},_processIOQueue:function(_15d){this._ioQueue=_12e.filter(this._ioQueue,function(dfd){var keep=dfd.fired>-1?false:true;return keep;});if(_15d){_12e.forEach(this._ioQueue,this._cancelPendingRequest);}},_removeOldCells:function(_15e){var _15f=this._cellMap,_160=this._gridLayer,_161,_162;for(_161 in _15f){if(_15f[_161]){var row=_15f[_161],_163=row.latticeID,_164=0,_165=0;if(_163){_164++;if(_163!==_160.getLatticeID(_15e)){this._removeCell(null,null,_163);_165++;}}else{for(_162 in row){if(row[_162]){_164++;var _166=row[_162].extent;if(!_160.intersects(_166,_15e)){this._removeCell(_161,_162);_165++;}}}}if(_165===_164){delete _15f[_161];}}}},_updateCell:function(cell,_167){var _168=this.featureLayer,_169=_168.objectIdField,_16a=_168._selectedFeatures,i,len=_167.length;cell.features=cell.features||[];for(i=0;i<len;i++){var _16b=_167[i];var oid=_16b.attributes[_169];var _16c=this._addFeatureIIf(oid,_16b);if(_16c===_16b){this._incRefCount(oid);cell.features.push(_16c);}else{if(!(oid in _16a)){_16c.setGeometry(_16b.geometry);_16c.setAttributes(_16b.attributes);}}}},_removeCell:function(row,col,_16d){var _16e=this._cellMap,_16f=this.featureLayer,_170=_16f.objectIdField;var cell=_16d?_16e[_16d]:(_16e[row]&&_16e[row][col]);if(cell){if(_16d){delete _16e[_16d];}else{delete _16e[row][col];}var _171=cell.features,i;for(i=0;i<_171.length;i++){var _172=_171[i];var oid=_172.attributes[_170];this._decRefCount(oid);if(oid in _16f._selectedFeatures){continue;}this._removeFeatureIIf(oid);}}}});if(has("extend-esri")){lang.setObject("layers._OnDemandMode",_134,_12f);}return _134;});},"esri/layers/FeatureLayer":function(){define(["dojo/_base/declare","dojo/_base/connect","dojo/_base/lang","dojo/_base/array","dojo/_base/json","dojo/_base/Deferred","dojo/date/locale","dojo/sniff","dojo/io-query","dojo/dom-construct","dojo/i18n","esri/kernel","esri/lang","esri/request","esri/deferredUtils","esri/SpatialReference","esri/symbols/SimpleMarkerSymbol","esri/symbols/SimpleLineSymbol","esri/symbols/SimpleFillSymbol","esri/symbols/jsonUtils","esri/renderers/SimpleRenderer","esri/renderers/UniqueValueRenderer","esri/renderers/jsonUtils","esri/tasks/QueryTask","esri/tasks/query","esri/tasks/FeatureSet","esri/geometry/Extent","esri/geometry/jsonUtils","esri/geometry/normalizeUtils","esri/layers/GraphicsLayer","esri/layers/Field","esri/layers/TimeInfo","esri/layers/FeatureType","esri/layers/FeatureTemplate","esri/layers/FeatureEditResult","esri/layers/SnapshotMode","esri/layers/OnDemandMode","esri/layers/SelectionMode","esri/layers/TrackManager","dojo/i18n!esri/nls/jsapi","dojo/has!extend-esri?esri/layers/agscommon"],function(_173,_174,lang,_175,_176,_177,_178,has,ioq,_179,i18n,_17a,_17b,_17c,_17d,_17e,_17f,_180,_181,_182,_183,_184,_185,_186,_187,_188,_189,_18a,_18b,_18c,_18d,_18e,_18f,_190,_191,_192,_193,_194,_195){var _196=_173(_18c,{declaredClass:"esri.layers.FeatureLayer",invalidParams:"query contains one or more unsupported parameters",constructor:function(url,_197){this.i18n=i18n.getLocalization("esri","jsapi");this._outFields=_197&&_197.outFields;this._loadCallback=_197&&_197.loadCallback;var _198=_197&&_197._usePatch;this._usePatch=(_198===null||_198===undefined)?true:_198;this._trackIdField=_197&&_197.trackIdField;this.objectIdField=_197&&_197.objectIdField;this._maxOffset=_197&&_197.maxAllowableOffset;this._optEditable=_197&&_197.editable;this._optAutoGen=_197&&_197.autoGeneralize;this.editSummaryCallback=_197&&_197.editSummaryCallback;this.userId=_197&&_197.userId;this.userIsAdmin=_197&&_197.userIsAdmin;this.useMapTime=(_197&&_197.hasOwnProperty("useMapTime"))?(!!_197.useMapTime):true;this.source=_197&&_197.source;this.gdbVersion=_197&&_197.gdbVersion;this._selectedFeatures={};this._selectedFeaturesArr=[];this._newFeatures=[];this._deletedFeatures={};this._ulid=this._getUniqueId();var ctor=this.constructor,mode=this.mode=(_17b.isDefined(_197&&_197.mode)?_197.mode:ctor.MODE_ONDEMAND);switch(mode){case ctor.MODE_SNAPSHOT:this._mode=new _192(this);this._isSnapshot=true;break;case ctor.MODE_ONDEMAND:this._tileWidth=(_197&&_197.tileWidth)||512;this._tileHeight=(_197&&_197.tileHeight)||512;this._mode=new _193(this);var _199=_197&&_197.latticeTiling;this.latticeTiling=_199;break;case ctor.MODE_SELECTION:this._mode=new _194(this);this._isSelOnly=true;break;}this._initLayer=lang.hitch(this,this._initLayer);this._selectHandler=lang.hitch(this,this._selectHandler);this._editable=false;if(lang.isObject(url)&&url.layerDefinition){var json=url;this._collection=true;this.mode=ctor.MODE_SNAPSHOT;this._initLayer(json);return this;}this._task=new _186(this.url,{source:this.source,gdbVersion:this.gdbVersion});var _19a=this._url.path;this._fserver=false;if(_19a.search(/\/FeatureServer\//i)!==-1){this._fserver=true;}var _19b=_197&&_197.resourceInfo;if(_19b){this._initLayer(_19b);}else{if(this.source){var _19c={source:this.source.toJson()};this._url.query=lang.mixin(this._url.query,{layer:_176.toJson(_19c)});}if(this.gdbVersion){this._url.query=lang.mixin(this._url.query,{gdbVersion:this.gdbVersion});}_17c({url:_19a,content:lang.mixin({f:"json"},this._url.query),callbackParamName:"callback",load:this._initLayer,error:this._errorHandler});}this.registerConnectEvents("esri.layers.FeatureLayer",{"add-attachment-complete":["result"],"before-apply-edits":["adds","updates","deletes"],"delete-attachments-complete":["results"],"edits-complete":["adds","updates","deletes"],"query-attachment-infos-complete":["results"],"query-count-complete":["count"],"query-features-complete":["featureSet"],"query-ids-complete":["objectIds"],"query-related-features-complete":["featureSets"],"selection-complete":["features","method"],"update-end":["error","info"]});},_initLayer:function(_19d,io){if(_19d||io){this._json=_19d;this._findCredential();var ssl=(this.credential&&this.credential.ssl)||(_19d&&_19d._ssl);if(ssl){this._useSSL();this._task._useSSL();}if(this._collection){this._mode=new _192(this);this._isSnapshot=true;this._featureSet=_19d.featureSet;this._nextId=_19d.nextObjectId;_19d=_19d.layerDefinition;}if(_19d.hasOwnProperty("capabilities")){var _19e=(this.capabilities=_19d.capabilities);if(_19e&&_19e.toLowerCase().indexOf("editing")!==-1){this._editable=true;}else{this._editable=false;}}else{if(!this._collection){this._editable=this._fserver;}}if(_17b.isDefined(this._optEditable)){this._editable=this._optEditable;delete this._optEditable;}this._json=_176.toJson(this._json);if(this.isEditable()){delete this._maxOffset;}else{if(this.mode!==this.constructor.MODE_SNAPSHOT&&((_19d.geometryType==="esriGeometryPolyline")||(_19d.geometryType==="esriGeometryPolygon"))){this._autoGeneralize=_17b.isDefined(this._optAutoGen)?this._optAutoGen:(this.mode===this.constructor.MODE_ONDEMAND);delete this._optAutoGen;}}var _19f=_19d.effectiveMinScale||_19d.minScale,_1a0=_19d.effectiveMaxScale||_19d.maxScale;if(!this._hasMin&&_19f){this.setMinScale(_19f);}if(!this._hasMax&&_1a0){this.setMaxScale(_1a0);}this.layerId=_19d.id;this.name=_19d.name;this.description=_19d.description;this.copyright=_19d.copyrightText;this.type=_19d.type;this.geometryType=_19d.geometryType;this.displayField=_19d.displayField;this.defaultDefinitionExpression=_19d.definitionExpression;this.fullExtent=new _189(_19d.extent);this.initialExtent=new _189(this.fullExtent.toJson());if(this.fullExtent.spatialReference){this.spatialReference=new _17e(this.fullExtent.spatialReference.toJson());}this.defaultVisibility=_19d.defaultVisibility;if((this.geometryType==="esriGeometryPoint")||(this.geometryType==="esriGeometryMultipoint")){this.latticeTiling=false;}this.indexedFields=_19d.indexedFields;this.maxRecordCount=_19d.maxRecordCount;this.canModifyLayer=_19d.canModifyLayer;this.supportsStatistics=_19d.supportsStatistics;this.supportsAdvancedQueries=_19d.supportsAdvancedQueries;this.hasLabels=_19d.hasLabels;this.canScaleSymbols=_19d.canScaleSymbols;this.supportsRollbackOnFailure=_19d.supportsRollbackOnFailure;this.syncCanReturnChanges=_19d.syncCanReturnChanges;this.isDataVersioned=_19d.isDataVersioned;this.editFieldsInfo=_19d.editFieldsInfo;this.ownershipBasedAccessControlForFeatures=_19d.ownershipBasedAccessControlForFeatures;if(this.editFieldsInfo&&this.ownershipBasedAccessControlForFeatures){this.creatorField=this.editFieldsInfo.creatorField;}this.relationships=_19d.relationships;this.allowGeometryUpdates=_17b.isDefined(_19d.allowGeometryUpdates)?_19d.allowGeometryUpdates:true;this._isTable=(this.type==="Table");var _1a1=(this.fields=[]),_1a2=_19d.fields,i;for(i=0;i<_1a2.length;i++){_1a1.push(new _18d(_1a2[i]));}if(!this.objectIdField){this.objectIdField=_19d.objectIdField;if(!this.objectIdField){_1a2=_19d.fields;for(i=0;i<_1a2.length;i++){var _1a3=_1a2[i];if(_1a3.type==="esriFieldTypeOID"){this.objectIdField=_1a3.name;break;}}}if(!this.objectIdField){console.debug("esri.layers.FeatureLayer: "+_17b.substitute({url:this.url},"objectIdField is not set [url: ${url}]"));}}if(!_17b.isDefined(this._nextId)){var _1a4=this.objectIdField,_1a5=-1;if(this._collection&&_1a4){var fset=this._featureSet,_1a6=fset&&fset.features,il=_1a6?_1a6.length:0,oid,attr;for(i=0;i<il;i++){attr=_1a6[i].attributes;oid=attr&&attr[_1a4];if(oid>_1a5){_1a5=oid;}}}this._nextId=(_1a5+1);}this.globalIdField=_19d.globalIdField;var _1a7=(this.typeIdField=_19d.typeIdField),_1a8;if(_1a7){_1a8=!this._getField(_1a7)&&this._getField(_1a7,true);if(_1a8){this.typeIdField=_1a8.name;}}this.visibilityField=_19d.visibilityField;var _1a9=_19d.defaultSymbol;if(_1a9){this.defaultSymbol=_182.fromJson(_1a9);}var _1aa=this.types=[],_1ab=_19d.types,_1ac,_1ad,_1ae,_1af=this.editFieldsInfo,_1b0=_1af&&_1af.creatorField,_1b1=_1af&&_1af.editorField,fix=(_1b0||_1b1),_1b2=[];if(_1ab){for(i=0;i<_1ab.length;i++){_1ac=new _18f(_1ab[i]);_1ad=_1ac.templates;if(fix&&_1ad&&_1ad.length){_1b2=_1b2.concat(_1ad);}_1aa.push(_1ac);}}var _1b3=_19d.templates,_1b4,_1b5=this.templates=[];if(_1b3){for(i=0;i<_1b3.length;i++){_1b4=new _190(_1b3[i]);if(fix){_1b2.push(_1b4);}_1b5.push(_1b4);}}for(i=0;i<_1b2.length;i++){_1ae=lang.getObject("prototype.attributes",false,_1b2[i]);if(_1ae){if(_1b0){delete _1ae[_1b0];}if(_1b1){delete _1ae[_1b1];}}}var _1b6=_19d.timeInfo;if(_1b6){this.timeInfo=new _18e(_1b6);this._startTimeField=_1b6.startTimeField;this._endTimeField=_1b6.endTimeField;if(this._startTimeField&&this._endTimeField){this._twoTimeFields=true;}if(this._trackIdField){_1b6.trackIdField=this._trackIdField;}else{this._trackIdField=_1b6.trackIdField;}}this.hasAttachments=(!this._collection&&_19d.hasAttachments)?true:false;this.htmlPopupType=_19d.htmlPopupType;var _1b7=_19d.drawingInfo,_1b8;if(!this.renderer){if(_1b7&&_1b7.renderer){_1b8=_1b7.renderer;this.setRenderer(_185.fromJson(_1b8));if(_1b8.type==="classBreaks"){this.renderer.setMaxInclusive(true);}if(!this._collection){var _1b9=_1b8.type,_1ba=[];_1b8=this.renderer;switch(_1b9){case "simple":_1ba.push(_1b8.symbol);break;case "uniqueValue":case "classBreaks":_1ba.push(_1b8.defaultSymbol);_1ba=_1ba.concat(_175.map(_1b8.infos,function(info){return info.symbol;}));break;}_1ba=_175.filter(_1ba,_17b.isDefined);var _1bb=this._url.path+"/images/",_1bc=this._getToken();_175.forEach(_1ba,function(sym){var url=sym.url;if(url){if((url.search(/https?\:/)===-1)&&(url.indexOf("data:")===-1)){sym.url=_1bb+url;}if(_1bc&&sym.url.search(/https?\:/)!==-1){sym.url+=("?token="+_1bc);}}});}}else{if(_1a9){_1ab=this.types;if(_1ab.length>0){_1b8=new _184(this.defaultSymbol,this.typeIdField);_175.forEach(_1ab,function(type){_1b8.addValue(type.id,type.symbol);});}else{_1b8=new _183(this.defaultSymbol);}this.setRenderer(_1b8);}else{if(!this._isTable){var _1bd;switch(this.geometryType){case "esriGeometryPoint":case "esriGeometryMultipoint":_1bd=new _17f();break;case "esriGeometryPolyline":_1bd=new _180();break;case "esriGeometryPolygon":_1bd=new _181();break;}this.setRenderer(_1bd?new _183(_1bd):null);}}}}var _1be=(_1b7&&_1b7.transparency)||0;if(!_17b.isDefined(this.opacity)&&_1be>0){this.opacity=1-(_1be/100);}this.version=_19d.currentVersion;if(!this.version){var ver;if("capabilities" in _19d||"drawingInfo" in _19d||"hasAttachments" in _19d||"htmlPopupType" in _19d||"relationships" in _19d||"timeInfo" in _19d||"typeIdField" in _19d||"types" in _19d){ver=10;}else{ver=9.3;}this.version=ver;}if((has("ie")||has("safari"))&&this.isEditable()&&this.version<10.02){this._ts=true;}this.loaded=true;this._fixRendererFields();this._checkFields();this._updateCaps();var _1bf=function(){this.onLoad(this);var _1c0=this._loadCallback;if(_1c0){delete this._loadCallback;_1c0(this);}};if(this._collection){this._fireUpdateStart();var _1c1=this._featureSet;delete this._featureSet;this._mode._drawFeatures(new _188(_1c1));this._fcAdded=true;_1bf.call(this);}else{this._forceIdentity(_1bf);}}},setRenderer:function(ren){this.inherited("setRenderer",arguments);var _1c2=this.renderer;if(_1c2){this._ager=(_1c2.declaredClass.indexOf("TemporalRenderer")!==-1&&_1c2.observationAger&&_1c2.observationRenderer);var _1c3=_175.filter([_1c2,_1c2.observationRenderer,_1c2.latestObservationRenderer,_1c2.trackRenderer],_17b.isDefined);var _1c4=[];_175.forEach(_1c3,function(rnd){if(!lang.isFunction(rnd.attributeField)){_1c4.push(rnd.attributeField);}_1c4.push(rnd.attributeField2);_1c4.push(rnd.attributeField3);},this);this._rendererFields=_175.filter(_1c4,_17b.isDefined);}else{this._ager=false;this._rendererFields=[];}if(this.loaded&&this._rendererFields.length>0){this._fixRendererFields();this._checkFields(this._rendererFields);}if(this.loaded&&this._collection){this._typesDirty=true;}},_setMap:function(map){var div=this.inherited(arguments),mode=this._mode;if(mode){mode.initialize(map);}return div;},_unsetMap:function(map){var mode=this._mode;if(mode){mode.suspend();}if(this._trackManager){this._trackManager.destroy();this._trackManager=null;}_174.disconnect(this._zoomConnect);this._zoomConnect=null;this._toggleTime(false);this.inherited("_unsetMap",arguments);},refresh:function(){var mode=this._mode;if(mode){mode.refresh();}},getOutFields:function(){return _175.filter(this._getOutFields(),function(_1c5){return (_1c5==="*"||!!this._getField(_1c5));},this);},setEditable:function(_1c6){if(!this._collection){console.log("FeatureLayer:setEditable - this functionality is not yet supported for layer in a feature service");return this;}if(!this.loaded){this._optEditable=_1c6;return this;}var _1c7=this._editable;this._editable=_1c6;this._updateCaps();if(_1c7!==_1c6){this.onCapabilitiesChange();}return this;},getEditCapabilities:function(_1c8){var _1c9={"canCreate":false,"canUpdate":false,"canDelete":false};if(!this.loaded||!this.isEditable()){return _1c9;}var _1ca=_1c8&&_1c8.feature,_1cb=_1c8&&_1c8.userId,caps=_175.map((this.capabilities?this.capabilities.toLowerCase().split(","):[]),lang.trim),_1cc=_175.indexOf(caps,"editing")>-1,_1cd=_1cc&&(_175.indexOf(caps,"create")>-1),_1ce=_1cc&&(_175.indexOf(caps,"update")>-1),_1cf=_1cc&&(_175.indexOf(caps,"delete")>-1),_1d0=this.ownershipBasedAccessControlForFeatures,_1d1=this.editFieldsInfo,_1d2=_1d1&&_1d1.creatorField,_1d3=_1d1&&_1d1.realm,_1d4=_1ca&&_1ca.attributes,_1d5=(_1d4&&_1d2)?_1d4[_1d2]:undefined,_1d6,_1d7=!!this.userIsAdmin,_1d8=!_1d0||_1d7||!!(_1d0.allowOthersToUpdate||_1d0.allowUpdateToOthers),_1d9=!_1d0||_1d7||!!(_1d0.allowOthersToDelete||_1d0.allowDeleteToOthers);if(_1d7||(_1cc&&!(_1cd||_1ce||_1cf))){_1cd=_1ce=_1cf=true;}_1d6={"canCreate":_1cd,"canUpdate":_1ce,"canDelete":_1cf};if(_1d5===null){_1d6.canUpdate=_1ce&&_1d8;_1d6.canDelete=_1cf&&_1d9;}else{if(_1d5===""){return _1d6;}else{if(_1d5){_1cb=_1cb||this.getUserId();if(_1cb&&_1d3){_1cb=_1cb+"@"+_1d3;}if(_1cb.toLowerCase()===_1d5.toLowerCase()){return _1d6;}else{_1d6.canUpdate=_1ce&&_1d8;_1d6.canDelete=_1cf&&_1d9;}}}}return _1d6;},getUserId:function(){var _1da;if(this.loaded){_1da=(this.credential&&this.credential.userId)||this.userId||"";}return _1da;},setUserIsAdmin:function(_1db){this.userIsAdmin=_1db;},setEditSummaryCallback:function(_1dc){this.editSummaryCallback=_1dc;},getEditSummary:function(_1dd,_1de,_1df){_1df=_17b.isDefined(_1df)?_1df:(new Date()).getTime();var _1e0="",info=this.getEditInfo(_1dd,_1de,_1df),_1e1=(_1de&&_1de.callback)||this.editSummaryCallback;if(_1e1){info=_1e1(_1dd,info)||"";}if(lang.isString(info)){_1e0=info;}else{if(info){var _1e2=info.action,_1e3=info.userId,_1e4=info.timeValue,_1e5=0;if(_1e2){_1e5++;}if(_1e3){_1e5++;}if(_17b.isDefined(_1e4)){_1e5++;}if(_1e5>1){_1e0=(_1e2==="edit"?"edit":"create")+(_1e3?"User":"")+(_17b.isDefined(_1e4)?info.displayPattern:"");}}_1e0=_1e0&&_17b.substitute(info,this.i18n.layers.FeatureLayer[_1e0]);}return _1e0;},getEditInfo:function(_1e6,_1e7,_1e8){if(!this.loaded){return;}_1e8=_17b.isDefined(_1e8)?_1e8:(new Date()).getTime();var _1e9=(_1e7&&_1e7.action)||"last",_1ea=this.editFieldsInfo,_1eb=_1ea&&_1ea.creatorField,_1ec=_1ea&&_1ea.creationDateField,_1ed=_1ea&&_1ea.editorField,_1ee=_1ea&&_1ea.editDateField,_1ef=_1ea&&_1ea.realm,_1f0=_1e6&&_1e6.attributes,_1f1=(_1f0&&_1eb)?_1f0[_1eb]:undefined,_1f2=(_1f0&&_1ec)?_1f0[_1ec]:null,_1f3=(_1f0&&_1ed)?_1f0[_1ed]:undefined,_1f4=(_1f0&&_1ee)?_1f0[_1ee]:null,_1f5=this._getEditData(_1f1,_1f2,_1e8),_1f6=this._getEditData(_1f3,_1f4,_1e8),_1f7;switch(_1e9){case "creation":_1f7=_1f5;break;case "edit":_1f7=_1f6;break;case "last":_1f7=_1f6||_1f5;break;}if(_1f7){_1f7.action=(_1f7===_1f6)?"edit":"creation";}return _1f7;},_getEditData:function(_1f8,_1f9,_1fa){var data,_1fb,_1fc,_1fd=60000,_1fe=3600000,_1ff=2*_1fe,_200=24*_1fe,_201=7*_200;if(_17b.isDefined(_1f9)){_1fb=_1fa-_1f9;if(_1fb<0){_1fc="Full";}else{if(_1fb<_1fd){_1fc="Seconds";}else{if(_1fb<(2*_1fd)){_1fc="Minute";}else{if(_1fb<_1fe){_1fc="Minutes";}else{if(_1fb<_1ff){_1fc="Hour";}else{if(_1fb<_200){_1fc="Hours";}else{if(_1fb<_201){_1fc="WeekDay";}else{_1fc="Full";}}}}}}}}if((_1f8!==undefined)||_1fc){data=data||{};data.userId=_1f8;if(_1fc){var _202=_178.format,_203=new Date(_1f9);data.minutes=Math.floor(_1fb/_1fd);data.hours=Math.floor(_1fb/_1fe);data.weekDay=_202(_203,{datePattern:"EEEE",selector:"date"});data.formattedDate=_202(_203,{selector:"date"});data.formattedTime=_202(_203,{selector:"time"});data.displayPattern=_1fc;data.timeValue=_1f9;}}return data;},isEditable:function(){return !!(this._editable||this.userIsAdmin);},setMaxAllowableOffset:function(_204){if(!this.isEditable()){this._maxOffset=_204;}return this;},getMaxAllowableOffset:function(){return this._maxOffset;},setAutoGeneralize:function(_205){if(!this.loaded){this._optAutoGen=_205;}else{if(!this.isEditable()&&(this.mode!==this.constructor.MODE_SNAPSHOT)&&((this.geometryType==="esriGeometryPolyline")||(this.geometryType==="esriGeometryPolygon"))){this._autoGeneralize=_205;if(_205){var map=this._map;if(map&&map.loaded){this._maxOffset=Math.floor(map.extent.getWidth()/map.width);}}else{delete this._maxOffset;}}}return this;},setGDBVersion:function(_206){if(!this._collection&&(_206!==this.gdbVersion)&&(_206||this.gdbVersion)){this.gdbVersion=_206;this._task.gdbVersion=_206;this._url.query=lang.mixin(this._url.query,{gdbVersion:_206});if(this.loaded){this.clearSelection();if(this._map){this.refresh();}}this.onGDBVersionChange();}return this;},setDefinitionExpression:function(expr){this._defnExpr=expr;var mode=this._mode;if(mode){mode.propertyChangeHandler(1);}return this;},getDefinitionExpression:function(){return this._defnExpr;},setTimeDefinition:function(_207){if(this._isSnapshot){this._timeDefn=_207;var mode=this._mode;if(mode){mode.propertyChangeHandler(2);}}else{console.log("FeatureLayer.setTimeDefinition: layer in on-demand or selection mode does not support time definitions. Layer id = "+this.id+", Layer URL = "+this.url);}return this;},getTimeDefinition:function(){return this._timeDefn;},setTimeOffset:function(_208,_209){this._timeOffset=_208;this._timeOffsetUnits=_209;var mode=this._mode;if(mode){mode.propertyChangeHandler(0);}return this;},setUseMapTime:function(use){this.useMapTime=use;this._toggleTime(!this.suspended);var mode=this._mode;if(mode){mode.propertyChangeHandler(0);}},selectFeatures:function(_20a,_20b,_20c,_20d){_20b=_20b||this.constructor.SELECTION_NEW;var _20e=this._getShallowClone(_20a),map=this._map,_20f,dfd=_17d._fixDfd(new _177(_17d._dfdCanceller));_20e.outFields=this.getOutFields();_20e.returnGeometry=true;if(map){_20e.outSpatialReference=new _17e(map.spatialReference.toJson());}if(!this._applyQueryFilters(_20e)){_20f={features:[]};this._selectHandler(_20f,_20b,_20c,_20d,dfd);return dfd;}var _210=this._canDoClientSideQuery(_20e);if(_210){_20f={features:this._doQuery(_20e,_210)};this._selectHandler(_20f,_20b,_20c,_20d,dfd);return dfd;}else{if(this._collection){var err=new Error("FeatureLayer::selectFeatures - "+this.invalidParams);this._resolve([err],null,_20d,dfd,true);return dfd;}var self=this;if(this._ts){_20e._ts=(new Date()).getTime();}var temp=dfd._pendingDfd=this._task.execute(_20e);temp.addCallbacks(function(_211){self._selectHandler(_211,_20b,_20c,_20d,dfd);},function(err){self._resolve([err],null,_20d,dfd,true);});return dfd;}},getSelectedFeatures:function(){var _212=this._selectedFeatures,_213=[],item;for(item in _212){if(_212.hasOwnProperty(item)){_213.push(_212[item]);}}return _213;},clearSelection:function(_214){var _215=this._selectedFeatures,mode=this._mode,item;for(item in _215){if(_215.hasOwnProperty(item)){this._unSelectFeatureIIf(item,mode);mode._removeFeatureIIf(item);}}this._selectedFeatures={};if(this._isSelOnly){mode._applyTimeFilter(true);}if(!_214){this.onSelectionClear();}return this;},setSelectionSymbol:function(_216){this._selectionSymbol=_216;if(_216){var _217=this._selectedFeatures,item;for(item in _217){if(_217.hasOwnProperty(item)){_217[item].setSymbol(_216);}}}return this;},getSelectionSymbol:function(){return this._selectionSymbol;},__msigns:[{n:"applyEdits",c:5,a:[{i:0},{i:1}],e:4,f:1}],applyEdits:function(adds,_218,_219,_21a,_21b,_21c){var _21d=_21c.assembly,dfd=_21c.dfd;this._applyNormalized(adds,_21d&&_21d[0]);this._applyNormalized(_218,_21d&&_21d[1]);this.onBeforeApplyEdits(adds,_218,_219);var i,_21e={},_21f=this.objectIdField,_220={f:"json"},_221=false;if(this._collection){var _222={};_222.addResults=adds?_175.map(adds,function(){_221=true;return {objectId:this._nextId++,success:true};},this):null;_222.updateResults=_218?_175.map(_218,function(_223){_221=true;var oid=_223.attributes[_21f];_21e[oid]=_223;return {objectId:oid,success:true};},this):null;_222.deleteResults=_219?_175.map(_219,function(_224){_221=true;return {objectId:_224.attributes[_21f],success:true};},this):null;if(_221){this._editHandler(_222,adds,_21e,_21a,_21b,dfd);}return;}if(adds&&adds.length>0){_220.adds=this._convertFeaturesToJson(adds,0,1);_221=true;}if(_218&&_218.length>0){for(i=0;i<_218.length;i++){var _225=_218[i];_21e[_225.attributes[_21f]]=_225;}_220.updates=this._convertFeaturesToJson(_218,0,0,1);_221=true;}if(_219&&_219.length>0){var ids=[];for(i=0;i<_219.length;i++){ids.push(_219[i].attributes[_21f]);}_220.deletes=ids.join(",");_221=true;}if(_221){var self=this;return _17c({url:this._url.path+"/applyEdits",content:lang.mixin(_220,this._url.query),callbackParamName:"callback",load:function(_226){self._editHandler(_226,adds,_21e,_21a,_21b,dfd);},error:function(err){self._resolve([err],null,_21b,dfd,true);}},{usePost:true});}},queryFeatures:function(_227,_228,_229){return this._query("execute","onQueryFeaturesComplete",_227,_228,_229);},queryRelatedFeatures:function(_22a,_22b,_22c){return this._query("executeRelationshipQuery","onQueryRelatedFeaturesComplete",_22a,_22b,_22c);},queryIds:function(_22d,_22e,_22f){return this._query("executeForIds","onQueryIdsComplete",_22d,_22e,_22f);},queryCount:function(_230,_231,_232){return this._query("executeForCount","onQueryCountComplete",_230,_231,_232);},queryAttachmentInfos:function(_233,_234,_235){var url=this._url.path+"/"+_233+"/attachments",dfd=new _177(_17d._dfdCanceller),self=this;dfd._pendingDfd=_17c({url:url,content:lang.mixin({f:"json"},this._url.query),callbackParamName:"callback",load:function(_236){var _237=_236.attachmentInfos,_238;_175.forEach(_237,function(info){_238=ioq.objectToQuery({gdbVersion:self._url.query&&self._url.query.gdbVersion,layer:self._url.query&&self._url.query.layer,token:self._getToken()});info.url=url+"/"+info.id+(_238?("?"+_238):"");info.objectId=_233;});self._resolve([_237],"onQueryAttachmentInfosComplete",_234,dfd);},error:function(err){self._resolve([err],null,_235,dfd,true);}});return dfd;},addAttachment:function(_239,_23a,_23b,_23c){return this._sendAttachment("add",_239,_23a,_23b,_23c);},updateAttachment:function(_23d,_23e,_23f,_240,_241){_23f.appendChild(_179.create("input",{type:"hidden",name:"attachmentId",value:_23e}));return this._sendAttachment("update",_23d,_23f,_240,_241);},deleteAttachments:function(_242,_243,_244,_245){var url=this._url.path+"/"+_242+"/deleteAttachments",dfd=new _177(_17d._dfdCanceller),self=this,_246={f:"json",attachmentIds:_243.join(",")};dfd._pendingDfd=_17c({url:url,content:lang.mixin(_246,this._url.query),callbackParamName:"callback",load:lang.hitch(this,function(_247){var _248=_247.deleteAttachmentResults;_248=_175.map(_248,function(_249){var res=new _191(_249);res.attachmentId=res.objectId;res.objectId=_242;return res;});self._resolve([_248],"onDeleteAttachmentsComplete",_244,dfd);}),error:function(err){self._resolve([err],null,_245,dfd,true);}},{usePost:true});return dfd;},addType:function(_24a){var _24b=this.types;if(_24b){var _24c=_175.some(_24b,function(type){if(type.id==_24a.id){return true;}return false;});if(_24c){return false;}else{_24b.push(_24a);}}else{this.types=[_24a];}this._typesDirty=true;return true;},deleteType:function(_24d){if(!this._collection){return;}var _24e=this.types;if(_24e){var _24f=-1;_175.some(_24e,function(type,_250){if(type.id==_24d){_24f=_250;return true;}return false;});if(_24f>-1){this._typesDirty=true;return _24e.splice(_24f,1)[0];}}},toJson:function(){var _251=this._json,json=lang.isString(_251)?_176.fromJson(_251):lang.clone(_251);if(!json){return;}json=json.layerDefinition?json:{layerDefinition:json};var _252=json.layerDefinition,_253=this._collection;if(_253&&this._typesDirty){_252.types=_175.map(this.types||[],function(type){return type.toJson();});var _254=this.renderer,_255=_252.drawingInfo;if(_255&&_254&&_254.declaredClass.indexOf("TemporalRenderer")===-1){_255.renderer=_254.toJson();}}var _256=null;if(!(_253&&!this._fcAdded)){_256={geometryType:_252.geometryType,features:this._convertFeaturesToJson(this.graphics,true)};}json.featureSet=lang.mixin({},json.featureSet||{},_256);if(_253){json.nextObjectId=this._nextId;_252.capabilities=this.capabilities;}return json;},onSelectionComplete:function(){},onSelectionClear:function(){},onBeforeApplyEdits:function(){},onEditsComplete:function(){},onQueryFeaturesComplete:function(){},onQueryRelatedFeaturesComplete:function(){},onQueryIdsComplete:function(){},onQueryCountComplete:function(){},onQueryAttachmentInfosComplete:function(){},onAddAttachmentComplete:function(){},onUpdateAttachmentComplete:function(){},onDeleteAttachmentsComplete:function(){},onCapabilitiesChange:function(){},onGDBVersionChange:function(){},onQueryLimitExceeded:function(){},_forceIdentity:function(_257){var self=this,path=this._url&&this._url.path;if((this.ownershipBasedAccessControlForFeatures||this.userIsAdmin)&&!this._getToken()&&path&&_17a.id&&_17a.id._hasPortalSession()&&_17a.id._doPortalSignIn(path)){_17a.id.getCredential(path).then(function(){self._findCredential();_257.call(self);},function(){_257.call(self);});}else{_257.call(this);}},_updateCaps:function(){var _258=this._editable,_259=lang.trim(this.capabilities||""),_25a=_175.map((_259?_259.split(","):[]),lang.trim),caps=_175.map((_259?_259.toLowerCase().split(","):[]),lang.trim),_25b=_175.indexOf(caps,"editing"),cap,i,_25c,_25d={"Create":_175.indexOf(caps,"create"),"Update":_175.indexOf(caps,"update"),"Delete":_175.indexOf(caps,"delete")};if(_258&&_25b===-1){_25a.push("Editing");}else{if(!_258&&_25b>-1){_25c=[_25b];for(cap in _25d){if(_25d[cap]>-1){_25c.push(_25d[cap]);}}_25c.sort();for(i=_25c.length-1;i>=0;i--){_25a.splice(_25c[i],1);}}}this.capabilities=_25a.join(",");},_counter:{value:0},_getUniqueId:function(){return this._counter.value++;},onSuspend:function(){this.inherited(arguments);this._toggleTime(false);var mode=this._mode;if(mode){mode.suspend();}},onResume:function(evt){this.inherited(arguments);this._toggleTime(true);this._updateMaxOffset();var mode=this._mode,map=this._map,_25e=this.renderer;if(evt.firstOccurrence){this.clearSelection();if(this.timeInfo){if(this._trackIdField||(_25e&&(_25e.latestObservationRenderer||_25e.trackRenderer))){this._trackManager=new _195(this);this._trackManager.initialize(map);}}this._zoomConnect=_174.connect(map,"onZoomEnd",this,this._updateMaxOffset);}if(mode){evt.firstOccurrence?mode.startup():mode.resume();}},_updateMaxOffset:function(){var map=this._map;if(map&&map.loaded){if(this._autoGeneralize){this._maxOffset=Math.floor(map.extent.getWidth()/map.width);}}},_toggleTime:function(_25f){var map=this._map;if(_25f&&this.timeInfo&&this.useMapTime&&map){this._mapTimeExtent=map.timeExtent;if(!this._timeConnect){this._timeConnect=_174.connect(map,"onTimeExtentChange",this,this._timeChangeHandler);}}else{this._mapTimeExtent=null;_174.disconnect(this._timeConnect);this._timeConnect=null;}},_timeChangeHandler:function(_260){this._mapTimeExtent=_260;var mode=this._mode;if(mode){mode.propertyChangeHandler(0);}},_getOffsettedTE:function(_261){var _262=this._timeOffset,_263=this._timeOffsetUnits;return (_261&&_262&&_263)?_261.offset(-1*_262,_263):_261;},_getTimeOverlap:function(_264,_265){if(_264&&_265){return _264.intersection(_265);}else{return _264||_265;}},_getTimeFilter:function(_266){var _267=this.getTimeDefinition(),_268=null,_269;if(_267||_268){_269=this._getTimeOverlap(_267,_268);if(!_269){return [false];}}if(_266){_266=_269?this._getTimeOverlap(_266,_269):_266;if(!_266){return [false];}}else{_266=_269;}return [true,_266];},_getAttributeFilter:function(_26a){var _26b=this.getDefinitionExpression();if(_26a){_26a=_26b?"("+_26b+") AND ("+_26a+")":_26a;}else{_26a=_26b;}return _26a;},_applyQueryFilters:function(_26c){_26c.where=this._getAttributeFilter(_26c.where);_26c.maxAllowableOffset=this._maxOffset;if(this.timeInfo){var _26d=this._getTimeFilter(_26c.timeExtent);if(!_26d[0]){return false;}else{_26c.timeExtent=_26d[1];}}return true;},_add:function(_26e){var _26f=this._selectionSymbol,attr=_26e.attributes,_270=this.visibilityField;if(_26f&&this._isSelOnly){_26e.setSymbol(_26f);}if(_270&&attr&&attr.hasOwnProperty(_270)){_26e[attr[_270]?"show":"hide"]();}return this.add.apply(this,arguments);},_remove:function(){return this.remove.apply(this,arguments);},_canDoClientSideQuery:function(_271){var _272=[],map=this._map;if(this._isTable||!map){return;}if(_271.text||(_271.where&&_271.where!==this.getDefinitionExpression())){return;}var _273=this._isSnapshot,_274=this._isSelOnly;var _275=_271.geometry;if(_275){if(!_274&&_271.spatialRelationship===_187.SPATIAL_REL_INTERSECTS&&(_275.type==="extent"&&(_273||map.extent.contains(_275)))){_272.push(1);}else{return;}}var ids=_271.objectIds;if(ids){if(_273){_272.push(2);}else{var len=ids.length,mode=this._mode,_276=0,i;for(i=0;i<len;i++){if(mode._getFeature(ids[i])){_276++;}}if(_276===len){_272.push(2);}else{return;}}}if(this.timeInfo){var _277=_271.timeExtent,_278=this._mapTimeExtent;if(_273){if(_277){_272.push(3);}}else{if(_274){if(_277){return;}}else{if(_278){if(_175.indexOf(_272,2)!==-1){if(_277){_272.push(3);}}else{return;}}else{if(_272.length>0){if(_277){_272.push(3);}}else{if(_277){return;}}}}}}return _272.length>0?_272:null;},_doQuery:function(_279,_27a,_27b){var _27c=[],mode=this._mode,_27d=this.objectIdField,i,len,_27e;if(_175.indexOf(_27a,2)!==-1){_27c=[];var ids=_279.objectIds;len=ids.length;for(i=0;i<len;i++){var obj=mode._getFeature(ids[i]);if(obj){_27c.push(obj);}}if(_27c.length===0){return [];}}if(_175.indexOf(_27a,1)!==-1){_27e=_27c.length>0?_27c:this.graphics;len=_27e.length;var _27f=_279.geometry._normalize(null,true);_27c=[];for(i=0;i<len;i++){var _280=_27e[i],_281=_280.geometry;if(_281){if(this.normalization&&_27f.length){if(_27f[0].intersects(_281)||_27f[1].intersects(_281)){_27c.push(_280);}}else{if(_27f.intersects(_281)){_27c.push(_280);}}}}if(_27c.length===0){return [];}}if(_175.indexOf(_27a,3)!==-1){if(this.timeInfo){_27e=_27c.length>0?_27c:this.graphics;var time=_279.timeExtent,_282=this._filterByTime(_27e,time.startTime,time.endTime);_27c=_282.match;}}if(_27b){return _175.map(_27c,function(obj){return obj.attributes[_27d];},this);}else{return _27c;}},_filterByTime:function(_283,_284,_285){var _286=this._startTimeField,_287=this._endTimeField,_288;if(!this._twoTimeFields){_288=_286||_287;}var _289=_17b.isDefined,yea=[],nay=[],i,len=_283.length,_28a,_28b;_284=_284?_284.getTime():-Infinity;_285=_285?_285.getTime():Infinity;if(_288){for(i=0;i<len;i++){_28a=_283[i];_28b=_28a.attributes;var time=_28b[_288];if(time>=_284&&time<=_285){yea.push(_28a);}else{nay.push(_28a);}}}else{for(i=0;i<len;i++){_28a=_283[i];_28b=_28a.attributes;var _28c=_28b[_286],end=_28b[_287];_28c=_289(_28c)?_28c:-Infinity;end=_289(end)?end:Infinity;if((_28c>=_284&&_28c<=_285)||(end>=_284&&end<=_285)||(_284>=_28c&&_285<=end)){yea.push(_28a);}else{nay.push(_28a);}}}return {match:yea,noMatch:nay};},_resolve:function(args,_28d,_28e,dfd,_28f){if(_28d){this[_28d].apply(this,args);}if(_28e){_28e.apply(null,args);}if(dfd){_17d._resDfd(dfd,args,_28f);}},_getShallowClone:function(_290){var _291=new _187(),prop;for(prop in _290){if(_290.hasOwnProperty(prop)){_291[prop]=_290[prop];}}return _291;},_query:function(type,_292,_293,_294,_295){var that=this,map=this._map,dfd=new _177(_17d._dfdCanceller),_296=_293;var _297=function(_298,_299){if(!_299&&type==="execute"&&!that._isTable){var _29a=_298.features,mode=that._mode,_29b=that.objectIdField,il=_29a.length,i;for(i=il-1;i>=0;i--){var oid=_29a[i].attributes[_29b];var _29c=mode._getFeature(oid);if(_29c){_29a.splice(i,1,_29c);}}}that._resolve([_298],_292,_294,dfd);};if(type!=="executeRelationshipQuery"){_296=this._getShallowClone(_293);_296.outFields=this.getOutFields();_296.returnGeometry=_293.hasOwnProperty("returnGeometry")?_293.returnGeometry:true;var _29d;if(map){_296.outSpatialReference=new _17e(map.spatialReference.toJson());}if(!this._applyQueryFilters(_296)){switch(type){case "execute":_29d=new _188({features:[]});break;case "executeForIds":_29d=[];break;case "executeForCount":_29d=0;break;}_297(_29d,true);return dfd;}var _29e=this._canDoClientSideQuery(_296);if(_29e){var _29f=this._doQuery(_296,_29e,(type==="executeForIds"||type==="executeForCount"));switch(type){case "execute":_29d=new _188();_29d.features=_29f;break;case "executeForIds":_29d=_29f;break;case "executeForCount":_29d=_29f.length;break;}_297(_29d,true);return dfd;}}if(this._collection){var err=new Error("FeatureLayer::_query - "+this.invalidParams);this._resolve([err],null,_295,dfd,true);return dfd;}if(this._ts){_296._ts=(new Date()).getTime();}var temp=dfd._pendingDfd=this._task[type](_296);temp.addCallbacks(_297,function(err){that._resolve([err],null,_295,dfd,true);});return dfd;},_convertFeaturesToJson:function(_2a0,_2a1,_2a2,_2a3){var json=[],_2a4=this._selectionSymbol,_2a5=this.visibilityField,i,_2a6,_2a7=this.objectIdField;if(this.loaded&&(_2a2||_2a3)){_2a6=_175.filter(this.fields,function(_2a8){return (_2a8.editable===false)&&(!_2a3||(_2a8.name!==_2a7));});}for(i=0;i<_2a0.length;i++){var _2a9=_2a0[i],_2aa={},_2ab=_2a9.geometry,attr=_2a9.attributes,_2ac=_2a9.symbol;if(_2ab&&(!_2a3||!this.loaded||this.allowGeometryUpdates)){_2aa.geometry=_2ab.toJson();}if(_2a5){_2aa.attributes=attr=lang.mixin({},attr);attr[_2a5]=_2a9.visible?1:0;}else{if(attr){_2aa.attributes=lang.mixin({},attr);}}if(_2aa.attributes&&_2a6&&_2a6.length){_175.forEach(_2a6,function(_2ad){delete _2aa.attributes[_2ad.name];});}if(_2ac&&(_2ac!==_2a4)){_2aa.symbol=_2ac.toJson();}json.push(_2aa);}return _2a1?json:_176.toJson(json);},_selectHandler:function(_2ae,_2af,_2b0,_2b1,dfd){var _2b2,ctor=this.constructor;switch(_2af){case ctor.SELECTION_NEW:this.clearSelection(true);_2b2=true;break;case ctor.SELECTION_ADD:_2b2=true;break;case ctor.SELECTION_SUBTRACT:_2b2=false;break;}var i,_2b3=_2ae.features,mode=this._mode,_2b4=[],_2b5=this.objectIdField,_2b6,oid;if(_2b2){for(i=0;i<_2b3.length;i++){_2b6=_2b3[i];oid=_2b6.attributes[_2b5];var _2b7=mode._addFeatureIIf(oid,_2b6);_2b4.push(_2b7);this._selectFeatureIIf(oid,_2b7,mode);}}else{for(i=0;i<_2b3.length;i++){_2b6=_2b3[i];oid=_2b6.attributes[_2b5];this._unSelectFeatureIIf(oid,mode);var _2b8=mode._removeFeatureIIf(oid);_2b4.push(_2b8||_2b6);}}if(this._isSelOnly){mode._applyTimeFilter(true);}this._resolve([_2b4,_2af,_2ae.exceededTransferLimit?{queryLimitExceeded:true}:null],"onSelectionComplete",_2b0,dfd);if(_2ae.exceededTransferLimit){this.onQueryLimitExceeded();}},_selectFeatureIIf:function(oid,_2b9,mode){var _2ba=this._selectedFeatures,_2bb=_2ba[oid];if(!_2bb){mode._incRefCount(oid);_2ba[oid]=_2b9;if(!this._isTable){this._setSelectSymbol(_2b9);}}return _2bb||_2b9;},_unSelectFeatureIIf:function(oid,mode){var _2bc=this._selectedFeatures[oid];if(_2bc){mode._decRefCount(oid);delete this._selectedFeatures[oid];if(!this._isTable){this._setUnSelectSymbol(_2bc);}}return _2bc;},_isSelected:function(_2bd){},_setSelectSymbol:function(_2be){var _2bf=this._selectionSymbol;if(_2bf&&!this._isSelOnly){_2be.setSymbol(_2bf);}},_setUnSelectSymbol:function(_2c0){var _2c1=this._selectionSymbol;if(_2c1&&!this._isSelOnly){if(_2c1===_2c0.symbol){_2c0.setSymbol(null,true);}}},_getOutFields:function(){var _2c2=_175.filter([this.objectIdField,this.typeIdField,this.creatorField,this._startTimeField,this._endTimeField,this._trackIdField].concat(this._rendererFields),function(_2c3,_2c4,arr){return !!_2c3&&(_175.indexOf(arr,_2c3)===_2c4);});var _2c5=lang.clone(this._outFields);if(_2c5){if(_175.indexOf(_2c5,"*")!==-1){return _2c5;}_175.forEach(_2c2,function(_2c6){if(_175.indexOf(_2c5,_2c6)===-1){_2c5.push(_2c6);}});return _2c5;}else{return _2c2;}},_checkFields:function(_2c7){var _2c8=_2c7||this._getOutFields();_175.forEach(_2c8,function(_2c9){if(_2c9==="*"){return;}if(!this._getField(_2c9)){console.debug("esri.layers.FeatureLayer: "+_17b.substitute({url:this.url,field:_2c9},"unable to find '${field}' field in the layer 'fields' information [url: ${url}]"));}},this);if(!_2c7&&!this._isTable&&!this._fserver&&!this._collection){var _2ca=_175.some(this.fields,function(_2cb){return (_2cb&&_2cb.type==="esriFieldTypeGeometry")?true:false;});if(!_2ca){console.debug("esri.layers.FeatureLayer: "+_17b.substitute({url:this.url},"unable to find a field of type 'esriFieldTypeGeometry' in the layer 'fields' information. If you are using a map service layer, features will not have geometry [url: ${url}]"));}}},_fixRendererFields:function(){var _2cc=this.renderer;if(_2cc&&this.fields.length>0){var _2cd=_175.filter([_2cc,_2cc.observationRenderer,_2cc.latestObservationRenderer,_2cc.trackRenderer],_17b.isDefined);var _2ce=[];_175.forEach(_2cd,function(rnd){var _2cf,_2d0;_2d0=rnd.attributeField;if(_2d0&&!lang.isFunction(_2d0)){_2cf=!this._getField(_2d0)&&this._getField(_2d0,true);if(_2cf){rnd.attributeField=_2cf.name;}}_2d0=rnd.attributeField2;if(_2d0){_2cf=!this._getField(_2d0)&&this._getField(_2d0,true);if(_2cf){rnd.attributeField2=_2cf.name;}}_2d0=rnd.attributeField3;if(_2d0){_2cf=!this._getField(_2d0)&&this._getField(_2d0,true);if(_2cf){rnd.attributeField3=_2cf.name;}}if(!lang.isFunction(rnd.attributeField)){_2ce.push(rnd.attributeField);}_2ce.push(rnd.attributeField2);_2ce.push(rnd.attributeField3);},this);this._rendererFields=_175.filter(_2ce,_17b.isDefined);}},_getField:function(_2d1,_2d2){var _2d3=this.fields;if(!_2d3||_2d3.length===0){return null;}var _2d4;if(_2d2){_2d1=_2d1.toLowerCase();}_175.some(_2d3,function(_2d5){var _2d6=false;if(_2d2){_2d6=(_2d5&&_2d5.name.toLowerCase()===_2d1)?true:false;}else{_2d6=(_2d5&&_2d5.name===_2d1)?true:false;}if(_2d6){_2d4=_2d5;}return _2d6;});return _2d4;},_getDateOpts:function(){if(!this._dtOpts){var _2d7=_175.map(_175.filter(this.fields,function(_2d8){return !!(_2d8&&_2d8.type==="esriFieldTypeDate");}),function(_2d9){return _2d9.name;});this._dtOpts={properties:_2d7};}return this._dtOpts;},_applyNormalized:function(_2da,_2db){if(_2da&&_2db){_175.forEach(_2da,function(_2dc,_2dd){if(_2dc&&_2db[_2dd]){_2dc.setGeometry(_2db[_2dd]);}});}},_editHandler:function(_2de,adds,_2df,_2e0,_2e1,dfd){var _2e2=_2de.addResults,_2e3=_2de.updateResults,_2e4=_2de.deleteResults,i,_2e5,oid,_2e6,attr,_2e7=this.objectIdField,mode=this._mode,_2e8=this._isTable;var _2e9=this.editFieldsInfo,_2ea=this.getOutFields()||[],_2eb=_2e9&&_2e9.creatorField,_2ec=_2e9&&_2e9.creationDateField,_2ed=_2e9&&_2e9.editorField,_2ee=_2e9&&_2e9.editDateField,_2ef=_2e9&&_2e9.realm;if(_175.indexOf(_2ea,"*")===-1){if(_2eb&&_175.indexOf(_2ea,_2eb)===-1){_2eb=null;}if(_2ec&&_175.indexOf(_2ea,_2ec)===-1){_2ec=null;}if(_2ed&&_175.indexOf(_2ea,_2ed)===-1){_2ed=null;}if(_2ee&&_175.indexOf(_2ea,_2ee)===-1){_2ee=null;}}var _2f0=(_2ec||_2ee)?(new Date()).getTime():null,_2f1=(_2eb||_2ed)?this.getUserId():undefined;if(_2f1&&_2ef){_2f1=_2f1+"@"+_2ef;}if(_2e2){for(i=0;i<_2e2.length;i++){_2e2[i]=new _191(_2e2[i]);if(_2e8){continue;}_2e5=_2e2[i];if(_2e5.success){oid=_2e5.objectId;_2e6=adds[i];var gl=_2e6._graphicsLayer;if(gl&&gl!==this){gl.remove(_2e6);}attr=_2e6.attributes||{};attr[_2e7]=oid;if(_2eb){attr[_2eb]=_2f1;}if(_2ed){attr[_2ed]=_2f1;}if(_2ec){attr[_2ec]=_2f0;}if(_2ee){attr[_2ee]=_2f0;}_2e6.setAttributes(attr);if(mode._init){mode.drawFeature(_2e6);}}}}if(_2e3){for(i=0;i<_2e3.length;i++){_2e3[i]=new _191(_2e3[i]);if(_2e8){continue;}_2e5=_2e3[i];if(_2e5.success){oid=_2e5.objectId;_2e6=_2df[oid];var _2f2=mode._getFeature(oid);if(_2f2){if(_2f2.geometry!==_2e6.geometry){_2f2.setGeometry(_18a.fromJson(_2e6.geometry.toJson()));}this._repaint(_2f2,oid);}_2e6=_2f2||_2e6;attr=_2e6.attributes||{};if(_2ed){attr[_2ed]=_2f1;}if(_2ee){attr[_2ee]=_2f0;}_2e6.setAttributes(attr);}}}if(_2e4){var _2f3=[];for(i=0;i<_2e4.length;i++){_2e4[i]=new _191(_2e4[i]);if(_2e8){continue;}_2e5=_2e4[i];if(_2e5.success){oid=_2e5.objectId;_2e6=mode._getFeature(oid);if(_2e6){if(this._unSelectFeatureIIf(oid,mode)){_2f3.push(_2e6);}_2e6._count=0;mode._removeFeatureIIf(oid);}}}if(_2f3.length>0){this.onSelectionComplete(_2f3,this.constructor.SELECTION_SUBTRACT);}}this._resolve([_2e2,_2e3,_2e4],"onEditsComplete",_2e0,dfd);},_sendAttachment:function(type,_2f4,_2f5,_2f6,_2f7){var _2f8=(type==="add")?"addAttachment":"updateAttachment",url=this._url.path+"/"+_2f4+"/"+_2f8,self=this;var dfd=_17c({url:url,form:_2f5,content:lang.mixin(this._url.query,{f:"json",token:this._getToken()||undefined}),callbackParamName:"callback.html",handleAs:"json"}).addCallback(function(_2f9){var _2fa=(type==="add")?"addAttachmentResult":"updateAttachmentResult",_2fb=(type==="add")?"onAddAttachmentComplete":"onUpdateAttachmentComplete",_2fc=new _191(_2f9[_2fa]);_2fc.attachmentId=_2fc.objectId;_2fc.objectId=_2f4;self._resolve([_2fc],_2fb,_2f6);return _2fc;}).addErrback(function(_2fd){self._resolve([_2fd],null,_2f7,null,true);});return dfd;},_repaint:function(_2fe,oid,_2ff){oid=_17b.isDefined(oid)?oid:_2fe.attributes[this.objectIdField];if(!(oid in this._selectedFeatures)||!this._selectionSymbol){_2fe.setSymbol(_2fe.symbol,_2ff);}},_getKind:function(_300){var _301=this._trackManager;if(_301){return _301.isLatestObservation(_300)?1:0;}return 0;}});lang.mixin(_196,{MODE_SNAPSHOT:0,MODE_ONDEMAND:1,MODE_SELECTION:2,SELECTION_NEW:3,SELECTION_ADD:4,SELECTION_SUBTRACT:5,POPUP_NONE:"esriServerHTMLPopupTypeNone",POPUP_HTML_TEXT:"esriServerHTMLPopupTypeAsHTMLText",POPUP_URL:"esriServerHTMLPopupTypeAsURL"});_18b._createWrappers(_196);if(has("extend-esri")){lang.setObject("layers.FeatureLayer",_196,_17a);}return _196;});},"dojo/DeferredList":function(){define(["./_base/kernel","./_base/Deferred","./_base/array"],function(dojo,_302,_303){dojo.DeferredList=function(list,_304,_305,_306,_307){var _308=[];_302.call(this);var self=this;if(list.length===0&&!_304){this.resolve([0,[]]);}var _309=0;_303.forEach(list,function(item,i){item.then(function(_30a){if(_304){self.resolve([i,_30a]);}else{_30b(true,_30a);}},function(_30c){if(_305){self.reject(_30c);}else{_30b(false,_30c);}if(_306){return null;}throw _30c;});function _30b(_30d,_30e){_308[i]=[_30d,_30e];_309++;if(_309===list.length){self.resolve(_308);}};});};dojo.DeferredList.prototype=new _302();dojo.DeferredList.prototype.gatherResults=function(_30f){var d=new dojo.DeferredList(_30f,false,true,false);d.addCallback(function(_310){var ret=[];_303.forEach(_310,function(_311){ret.push(_311[1]);});return ret;});return d;};return dojo.DeferredList;});},"esri/layers/KMLFolder":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","esri/kernel","esri/lang"],function(_312,lang,has,_313,_314){var _315=_312(null,{declaredClass:"esri.layers.KMLFolder",constructor:function(json){lang.mixin(this,json);if(_314.isDefined(this.visibility)){this.visible=!!this.visibility;}}});if(has("extend-esri")){lang.setObject("layers.KMLFolder",_315,_313);}return _315;});},"esri/layers/TrackManager":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/has","esri/kernel","esri/graphic","esri/geometry/Polyline","esri/layers/GraphicsLayer"],function(_316,lang,_317,has,_318,_319,_31a,_31b){var _31c=_316(null,{declaredClass:"esri.layers._TrackManager",constructor:function(_31d){this.layer=_31d;this.trackMap={};},initialize:function(map){this.map=map;var _31e=this.layer,_31f=_31e.renderer.trackRenderer;if(_31f&&(_31e.geometryType==="esriGeometryPoint")){var _320=(this.container=new _31b._GraphicsLayer({id:_31e.id+"_tracks",_child:true}));_320.loaded=true;_320.onLoad(_320);_320._setMap(map,_31e._div);_320.setRenderer(_31f);}},addFeatures:function(_321){var tkid,_322=this.trackMap,_323=this.layer,_324=_323._trackIdField;_317.forEach(_321,function(_325){var _326=_325.attributes;tkid=_326[_324];var ary=(_322[tkid]=(_322[tkid]||[]));ary.push(_325);});var _327=_323._startTimeField,_328=_323.objectIdField;var _329=function(a,b){var _32a=a.attributes[_327],_32b=b.attributes[_327];if(_32a===_32b){return (a.attributes[_328]<b.attributes[_328])?-1:1;}else{return (_32a<_32b)?-1:1;}};for(tkid in _322){_322[tkid].sort(_329);}},drawTracks:function(){var _32c=this.container;if(!_32c){return;}var _32d=this.trackMap,sr=this.map.spatialReference,tkid,ary,path,i,_32e,_32f=this.layer._trackIdField,_330;for(tkid in _32d){ary=_32d[tkid];path=[];for(i=ary.length-1;i>=0;i--){_32e=ary[i].geometry;if(_32e){path.push([_32e.x,_32e.y]);}}_330={};_330[_32f]=tkid;if(path.length>0){_32c.add(new _319(new _31a({paths:[path],spatialReference:sr}),null,_330));}}},moveLatestToFront:function(){_317.forEach(this.getLatestObservations(),function(_331){var _332=_331._shape;_332&&_332._moveToFront();this._repaint(_331,null,true);},this.layer);},getLatestObservations:function(){var _333=[];if(!this.layer.renderer.latestObservationRenderer){return _333;}var _334=this.trackMap,tkid;for(tkid in _334){var ary=_334[tkid];_333.push(ary[ary.length-1]);}return _333;},clearTracks:function(){var _335=this.getLatestObservations();this.trackMap={};var _336=this.container;if(_336){_336.clear();}_317.forEach(_335,function(_337){this._repaint(_337,null,true);},this.layer);},isLatestObservation:function(_338){var _339=this.layer._trackIdField;var _33a=this.trackMap[_338.attributes[_339]];if(_33a){return (_33a[_33a.length-1]===_338);}return false;},destroy:function(){var _33b=this.container;if(_33b){_33b.clear();_33b._unsetMap(this.map,this.layer._div);this.container=null;}this.map=null;this.layer=null;this.trackMap=null;}});if(has("extend-esri")){lang.setObject("layers._TrackManager",_31c,_318);}return _31c;});},"esri/layers/WMSLayer":function(){define(["require","dojo/_base/kernel","dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/has","esri/kernel","esri/request","esri/urlUtils","esri/SpatialReference","esri/geometry/Extent","esri/layers/DynamicMapServiceLayer","esri/layers/WMSLayerInfo","dojo/query"],function(_33c,_33d,_33e,lang,_33f,has,_340,_341,_342,_343,_344,_345,_346){var _347=_33e([_345],{declaredClass:"esri.layers.WMSLayer",_CRS_TO_EPSG:{84:4326,83:4269,27:4267},_REVERSED_LAT_LONG_RANGES:[[4001,4999],[2044,2045],[2081,2083],[2085,2086],[2093,2093],[2096,2098],[2105,2132],[2169,2170],[2176,2180],[2193,2193],[2200,2200],[2206,2212],[2319,2319],[2320,2462],[2523,2549],[2551,2735],[2738,2758],[2935,2941],[2953,2953],[3006,3030],[3034,3035],[3058,3059],[3068,3068],[3114,3118],[3126,3138],[3300,3301],[3328,3335],[3346,3346],[3350,3352],[3366,3366],[3416,3416],[20004,20032],[20064,20092],[21413,21423],[21473,21483],[21896,21899],[22171,22177],[22181,22187],[22191,22197],[25884,25884],[27205,27232],[27391,27398],[27492,27492],[28402,28432],[28462,28492],[30161,30179],[30800,30800],[31251,31259],[31275,31279],[31281,31290],[31466,31700]],_WEB_MERCATOR:[102100,3857,102113,900913],_WORLD_MERCATOR:[3395,54004],allExtents:[],constructor:function(url,_348){url=this._stripParameters(url,["version","service","request","bbox","format","height","width","layers","srs","crs","styles","transparent","bgcolor","exceptions","time","elevation","sld","wfs"]);this.url=url;this._url=_342.urlToObject(url);this._getCapabilitiesURL=url;this._initLayer=lang.hitch(this,this._initLayer);this._parseCapabilities=lang.hitch(this,this._parseCapabilities);this._getCapabilitiesError=lang.hitch(this,this._getCapabilitiesError);if(_348){this.imageFormat=this._getImageFormat(_348.format);this.imageTransparency=(_348.transparent===false)?false:true;this.visibleLayers=_348.visibleLayers?_348.visibleLayers:[];if(_348.resourceInfo){this._readResourceInfo(_348.resourceInfo);}else{this._getCapabilities();}}else{this.imageFormat="image/png";this.imageTransparency=true;this.visibleLayers=[];this._getCapabilities();}this._blankImageURL=_33c.toUrl("esri/layers")+"/../images/pixel.png";},setVisibleLayers:function(_349){_349=this._checkVisibleLayersList(_349);this.visibleLayers=_349?_349:[];this.refresh(true);},setImageFormat:function(_34a){this.imageFormat=this._getImageFormat(_34a);this.refresh(true);},setImageTransparency:function(_34b){this.imageTransparency=_34b;this.refresh(true);},getImageUrl:function(_34c,_34d,_34e,_34f){if(!this.visibleLayers||this.visibleLayers.length===0){_34f(this._blankImageURL);return;}var wkid=_34c.spatialReference.wkid;if(_33f.some(this._WEB_MERCATOR,function(el){return el==wkid;})){var _350=_33f.filter(this.spatialReferences,function(el){return (_33f.some(this._WEB_MERCATOR,function(el2){return el2==el;}));},this);if(_350.length==0){_350=_33f.filter(this.spatialReferences,function(el){return (_33f.some(this._WORLD_MERCATOR,function(el2){return el2==el;}));},this);}if(_350.length>0){wkid=_350[0];}else{wkid=this._WEB_MERCATOR[0];}}var list=_33f.filter(this.spatialReferences,function(el){return el!==wkid;});this.spatialReferences=list;this.spatialReferences.unshift(wkid);var xmin=_34c.xmin;var xmax=_34c.xmax;var ymin=_34c.ymin;var ymax=_34c.ymax;var _351={};_351.SERVICE="WMS";_351.REQUEST="GetMap";_351.FORMAT=this.imageFormat;_351.TRANSPARENT=this.imageTransparency?"TRUE":"FALSE";_351.STYLES="";_351.VERSION=this.version;_351.LAYERS=this.visibleLayers?this.visibleLayers.toString():null;_351.WIDTH=_34d;_351.HEIGHT=_34e;if(this.maxWidth<_34d){_351.WIDTH=this.maxWidth;}if(this.maxHeight<_34e){_351.HEIGHT=this.maxHeight;}var _352=wkid?wkid:NaN;if(!isNaN(_352)){if(this.version=="1.3.0"){_351.CRS="EPSG:"+_352;}else{_351.SRS="EPSG:"+_352;}}if(this.version=="1.3.0"&&this._useLatLong(_352)){_351.BBOX=ymin+","+xmin+","+ymax+","+xmax;}else{_351.BBOX=xmin+","+ymin+","+xmax+","+ymax;}var _353=this.getMapURL,key;_353+=(_353.indexOf("?")==-1)?"?":"";for(key in _351){_353+=(_353.substring(_353.length-1,_353.length)=="?")?"":"&";_353+=key+"="+_351[key];}_34f(_342.addProxy(_353));},_initLayer:function(_354,io){this.spatialReference=new _343(this.extent.spatialReference);this.initialExtent=new _344(this.extent);this.fullExtent=new _344(this.extent);this.visibleLayers=this._checkVisibleLayersList(this.visibleLayers);this.loaded=true;this.onLoad(this);var _355=this._loadCallback;if(_355){delete this._loadCallback;_355(this);}},_readResourceInfo:function(_356){if(!_356.extent){console.error("esri.layers.WMSLayer: unable to find the 'extent' property in resourceInfo");return;}if(!_356.layerInfos){console.error("esri.layers.WMSLayer: unable to find the 'layerInfos' property in resourceInfo");return;}this.extent=_356.extent;this.allExtents[0]=_356.extent;this.layerInfos=_356.layerInfos;this.description=_356.description?_356.description:"";this.copyright=_356.copyright?_356.copyright:"";this.title=_356.title?_356.title:"";this.getMapURL=_356.getMapURL?_356.getMapURL:this._getCapabilitiesURL;this.version=_356.version?_356.version:"1.3.0";this.maxWidth=_356.maxWidth?_356.maxWidth:5000;this.maxHeight=_356.maxHeight?_356.maxHeight:5000;this.spatialReferences=_356.spatialReferences?_356.spatialReferences:[];this.imageFormat=this._getImageFormat(_356.format);this.setScaleRange(_356.minScale,_356.maxScale);this._initLayer();},_getCapabilities:function(){var _357=this._url.query?this._url.query:{};_357.SERVICE="WMS";_357.REQUEST="GetCapabilities";var uri=this._url.path+"?",key;for(key in _357){uri+=(uri.substring(uri.length-1,uri.length)=="?")?"":"&";uri+=key+"="+_357[key];}var _358=_341({url:uri,handleAs:"xml",load:this._parseCapabilities,error:this._getCapabilitiesError},{usePost:false});},_parseCapabilities:function(xml){if(!xml){this.onError("GetCapabilities request for "+this._getCapabilitiesURL+" failed. (Response is null.)");return;}this.version=this._getAttributeValue("WMS_Capabilities","version",xml,null);if(!this.version){this.version=this._getAttributeValue("WMT_MS_Capabilities","version",xml,"1.3.0");}var _359=this._getTag("Service",xml);this.title=this._getTagValue("Title",_359,"");if(!this.title||this.title.length==0){this.title=this._getTagValue("Name",_359,"");}this.copyright=this._getTagValue("AccessConstraints",_359,"");this.description=this._getTagValue("Abstract",_359,"");this.maxWidth=parseInt(this._getTagValue("MaxWidth",_359,5000),10);this.maxHeight=parseInt(this._getTagValue("MaxHeight",_359,5000),10);var _35a=this._getTag("Layer",xml);if(!_35a){this._getCapabilitiesError({"error":{"message":"Response does not contain any layers."}});return;}var _35b=this._getLayerInfo(_35a);if(_35b){this.layerInfos=_35b.subLayers;if(!this.layerInfos||this.layerInfos.length==0){this.layerInfos=[_35b];}this.extent=_35b.extent;this.allExtents=_35b.allExtents;this.spatialReferences=_35b.spatialReferences;if(this.spatialReferences.length==0&&this.layerInfos.length>0){this.spatialReferences=this.layerInfos[0].spatialReferences;}}this.getMapURL=this._getCapabilitiesURL;var _35c=_33d.query("DCPType",this._getTag("GetMap",xml));if(_35c&&_35c.length>0){var _35d=_33d.query("HTTP",_35c[0]);if(_35d&&_35d.length>0){var _35e=_33d.query("Get",_35d[0]);if(_35e&&_35e.length>0){var _35f=this._getAttributeValue("OnlineResource","xlink:href",_35e[0],null);if(_35f){if(_35f.indexOf("&")==(_35f.length-1)){_35f=_35f.substring(0,_35f.length-1);}this.getMapURL=_35f;}}}}this.getMapFormats=[];if(_33d.query("Operation",xml).length==0){_33f.forEach(_33d.query("Format",this._getTag("GetMap",xml)),function(_360){this.getMapFormats.push(_360.text?_360.text:_360.textContent);},this);}else{_33f.forEach(_33d.query("Operation",xml),function(_361){if(_361.getAttribute("name")=="GetMap"){_33f.forEach(_33d.query("Format",_361),function(_362){this.getMapFormats.push(_362.text?_362.text:_362.textContent);},this);}},this);}if(!_33f.some(this.getMapFormats,function(el){return el.indexOf(this.imageFormat)>-1;},this)){this.imageFormat=this.getMapFormats[0];}this._initLayer();},_getCapabilitiesError:function(_363,io){this.onError("GetCapabilities request for "+this._getCapabilitiesURL+" failed.",_363);},_getLayerInfo:function(_364){if(!_364){return null;}var _365=new _346();_365.name="";_365.title="";_365.description="";_365.allExtents=[];_365.spatialReferences=[];_365.subLayers=[];var _366=this._getTag("LatLonBoundingBox",_364);if(_366){_365.allExtents[0]=this._getExtent(_366,4326);}var _367=this._getTag("EX_GeographicBoundingBox",_364);if(_367){var _368=new _344(0,0,0,0,new _343({wkid:4326}));_368.xmin=parseFloat(this._getTagValue("westBoundLongitude",_367,0));_368.ymin=parseFloat(this._getTagValue("southBoundLatitude",_367,0));_368.xmax=parseFloat(this._getTagValue("eastBoundLongitude",_367,0));_368.ymax=parseFloat(this._getTagValue("northBoundLatitude",_367,0));_365.allExtents[0]=_368;}_365.extent=_365.allExtents[0];var _369=(_33f.indexOf(["1.0.0","1.1.0","1.1.1"],this.version)>-1)?"SRS":"CRS";_33f.forEach(_364.childNodes,function(_36a){if(_36a.nodeName=="Name"){_365.name=(_36a.text?_36a.text:_36a.textContent)||"";}else{if(_36a.nodeName=="Title"){_365.title=(_36a.text?_36a.text:_36a.textContent)||"";}else{if(_36a.nodeName=="Abstract"){_365.description=(_36a.text?_36a.text:_36a.textContent)||"";}else{if(_36a.nodeName=="BoundingBox"){var _36b=_36a.getAttribute(_369),wkid;if(_36b&&_36b.indexOf("EPSG:")===0){wkid=parseInt(_36b.substring(5),10);if(wkid!==0&&!isNaN(wkid)){var _36c;if(this.version=="1.3.0"){_36c=this._getExtent(_36a,wkid,this._useLatLong(wkid));}else{_36c=this._getExtent(_36a,wkid);}_365.allExtents[wkid]=_36c;if(!_365.extent){_365.extent=_36c;}}}else{if(_36b&&_36b.indexOf("CRS:")===0){wkid=parseInt(_36b.substring(4),10);if(wkid!==0&&!isNaN(wkid)){if(this._CRS_TO_EPSG[wkid]){wkid=this._CRS_TO_EPSG[wkid];}_365.allExtents[wkid]=this._getExtent(_36a,wkid);}}else{wkid=parseInt(_36b,10);if(wkid!==0&&!isNaN(wkid)){_365.allExtents[wkid]=this._getExtent(_36a,wkid);}}}}else{if(_36a.nodeName==_369){var _36d=_36a.text?_36a.text:_36a.textContent;var arr=_36d.split(" ");_33f.forEach(arr,function(val){if(val.indexOf(":")>-1){val=parseInt(val.split(":")[1],10);}else{val=parseInt(val,10);}if(val!==0&&!isNaN(val)){if(this._CRS_TO_EPSG[val]){val=this._CRS_TO_EPSG[val];}if(_33f.indexOf(_365.spatialReferences,val)==-1){_365.spatialReferences.push(val);}}},this);}else{if(_36a.nodeName=="Style"){var _36e=this._getTag("LegendURL",_36a);if(_36e){var _36f=this._getTag("OnlineResource",_36e);if(_36f){_365.legendURL=_36f.getAttribute("xlink:href");}}}else{if(_36a.nodeName==="Layer"){_365.subLayers.push(this._getLayerInfo(_36a));}}}}}}}},this);return _365;},_getImageFormat:function(_370){var _371=_370?_370.toLowerCase():"";switch(_371){case "jpg":return "image/jpeg";case "bmp":return "image/bmp";case "gif":return "image/gif";case "svg":return "image/svg+xml";default:return "image/png";}},getImageFormat:function(){var _372=this.imageFormat?this.imageFormat.toLowerCase():"";switch(_372){case "image/jpeg":return "jpg";case "image/bmp":return "bmp";case "image/gif":return "gif";case "image/svg+xml":return "svg";default:return "png";}},_getExtent:function(_373,wkid,_374){var _375;if(_373){_375=new _344();var minx=parseFloat(_373.getAttribute("minx"));var miny=parseFloat(_373.getAttribute("miny"));var maxx=parseFloat(_373.getAttribute("maxx"));var maxy=parseFloat(_373.getAttribute("maxy"));if(_374){_375.xmin=isNaN(miny)?((-1)*Number.MAX_VALUE):miny;_375.ymin=isNaN(minx)?((-1)*Number.MAX_VALUE):minx;_375.xmax=isNaN(maxy)?Number.MAX_VALUE:maxy;_375.ymax=isNaN(maxx)?Number.MAX_VALUE:maxx;}else{_375.xmin=isNaN(minx)?((-1)*Number.MAX_VALUE):minx;_375.ymin=isNaN(miny)?((-1)*Number.MAX_VALUE):miny;_375.xmax=isNaN(maxx)?Number.MAX_VALUE:maxx;_375.ymax=isNaN(maxy)?Number.MAX_VALUE:maxy;}_375.spatialReference=new _343({wkid:wkid});}return _375;},_useLatLong:function(wkid){var _376,i;for(i=0;i<this._REVERSED_LAT_LONG_RANGES.length;i++){var _377=this._REVERSED_LAT_LONG_RANGES[i];if(wkid>=_377[0]&&wkid<=_377[1]){_376=true;break;}}return _376;},_getTag:function(_378,xml){var tags=_33d.query(_378,xml);if(tags&&tags.length>0){return tags[0];}else{return null;}},_getTagValue:function(_379,xml,_37a){var _37b=_33d.query(_379,xml);if(_37b&&_37b.length>0){if(_37b[0].text){return _37b[0].text;}else{return _37b[0].textContent;}}else{return _37a;}},_getAttributeValue:function(_37c,_37d,xml,_37e){var _37f=_33d.query(_37c,xml);if(_37f&&_37f.length>0){return _37f[0].getAttribute(_37d);}else{return _37e;}},_checkVisibleLayersList:function(_380){if(_380&&_380.length>0&&this.layerInfos&&this.layerInfos.length>0){if((typeof _380[0])=="number"){var list=[];_33f.forEach(_380,function(pos){if(pos<this.layerInfos.length){list.push(this.layerInfos[pos].name);}},this);_380=list;}}return _380;},_stripParameters:function(url,_381){var obj=_342.urlToObject(url),prop,qs=[];for(prop in obj.query){if(_33f.indexOf(_381,prop.toLowerCase())===-1){qs.push(prop+"="+obj.query[prop]);}}return obj.path+(qs.length?("?"+qs.join("&")):"");}});if(has("extend-esri")){lang.setObject("layers.WMSLayer",_347,_340);}return _347;});},"esri/layers/SnapshotMode":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","esri/kernel","esri/SpatialReference","esri/tasks/query","esri/layers/RenderMode"],function(_382,lang,has,_383,_384,_385,_386){var _387=_382([_386],{declaredClass:"esri.layers._SnapshotMode",constructor:function(_388){this.featureLayer=_388;this._featureMap={};this._drawFeatures=lang.hitch(this,this._drawFeatures);this._queryErrorHandler=lang.hitch(this,this._queryErrorHandler);},startup:function(){if(this.featureLayer._collection){this._applyTimeFilter();}else{this._fetchAll();}},propertyChangeHandler:function(type){if(this._init){if(type){if(this.featureLayer._collection){console.log("FeatureLayer: layer created by value (from a feature collection) does not support definition expressions and time definitions. Layer id = "+this.featureLayer.id);}else{this._fetchAll();}}else{this._applyTimeFilter();}}},drawFeature:function(_389){var _38a=this.featureLayer,_38b=_38a.objectIdField,oid=_389.attributes[_38b];this._addFeatureIIf(oid,_389);this._incRefCount(oid);},resume:function(){this.propertyChangeHandler(0);},refresh:function(){var _38c=this.featureLayer;if(_38c._collection){_38c._fireUpdateStart();_38c._refresh(true);_38c._fireUpdateEnd();}else{this._fetchAll();}},_getRequestId:function(_38d){var id="_"+_38d.name+_38d.layerId+_38d._ulid;return id.replace(/[^a-zA-Z0-9\_]+/g,"_");},_fetchAll:function(){var _38e=this.featureLayer;if(_38e._collection){return;}_38e._fireUpdateStart();this._clearIIf();this._sendRequest();},_sendRequest:function(){var map=this.map,_38f=this.featureLayer,_390=_38f.getDefinitionExpression();var _391=new _385();_391.outFields=_38f.getOutFields();_391.where=_390||"1=1";_391.returnGeometry=true;_391.outSpatialReference=new _384(map.spatialReference.toJson());_391.timeExtent=_38f.getTimeDefinition();_391.maxAllowableOffset=_38f._maxOffset;if(_38f._ts){_391._ts=(new Date()).getTime();}var _392;if(_38f._usePatch){_392=this._getRequestId(_38f);this._cancelPendingRequest(null,_392);}_38f._task.execute(_391,this._drawFeatures,this._queryErrorHandler,_392);},_drawFeatures:function(_393){this._purgeRequests();var _394=_393.features,_395=this.featureLayer,_396=_395.objectIdField,i,len=_394.length,_397,oid;for(i=0;i<len;i++){_397=_394[i];oid=_397.attributes[_396];this._addFeatureIIf(oid,_397);this._incRefCount(oid);}this._applyTimeFilter(true);_395._fireUpdateEnd(null,_393.exceededTransferLimit?{queryLimitExceeded:true}:null);if(_393.exceededTransferLimit){_395.onQueryLimitExceeded();}},_queryErrorHandler:function(err){this._purgeRequests();var _398=this.featureLayer;_398._errorHandler(err);_398._fireUpdateEnd(err);}});if(has("extend-esri")){lang.setObject("layers._SnapshotMode",_387,_383);}return _387;});},"esri/layers/SelectionMode":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","esri/kernel","esri/layers/RenderMode"],function(_399,lang,has,_39a,_39b){var _39c=_399([_39b],{declaredClass:"esri.layers._SelectionMode",constructor:function(_39d){this.featureLayer=_39d;this._featureMap={};},propertyChangeHandler:function(type){if(this._init&&type===0){this._applyTimeFilter();}},resume:function(){this.propertyChangeHandler(0);}});if(has("extend-esri")){lang.setObject("layers._SelectionMode",_39c,_39a);}return _39c;});},"esri/layers/GridLayout":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/has","esri/kernel","esri/SpatialReference","esri/geometry/Extent","esri/geometry/Polyline"],function(_39e,lang,_39f,has,_3a0,_3a1,_3a2,_3a3){var _3a4=_39e(null,{declaredClass:"esri.layers._GridLayout",constructor:function(_3a5,_3a6,_3a7,_3a8){this.origin=_3a5;this.cellWidth=_3a6.width;this.cellHeight=_3a6.height;this.mapWidth=_3a7.width;this.mapHeight=_3a7.height;this.srInfo=_3a8;},setResolution:function(_3a9){this._resolution=(_3a9.xmax-_3a9.xmin)/this.mapWidth;if(this.srInfo){var _3aa=Math.round((2*this.srInfo.valid[1])/this._resolution),_3ab=Math.round(_3aa/this.cellWidth);this._frameStats=[_3ab,0,_3ab-1];}},getCellCoordinates:function(_3ac){var res=this._resolution,_3ad=this.origin;return {row:Math.floor((_3ad.y-_3ac.y)/(this.cellHeight*res)),col:Math.floor((_3ac.x-_3ad.x)/(this.cellWidth*res))};},normalize:function(col){var _3ae=this._frameStats;if(_3ae){var _3af=_3ae[0],m180=_3ae[1],p180=_3ae[2];if(col<m180){col=col%_3af;col=col<m180?col+_3af:col;}else{if(col>p180){col=col%_3af;}}}return col;},intersects:function(_3b0,_3b1){var _3b2=this.srInfo;if(_3b2){return _39f.some(_3b1._getParts(_3b2),function(_3b3){return _3b0.intersects(_3b3.extent);});}else{return _3b0.intersects(_3b1);}},getCellExtent:function(row,col){var res=this._resolution,_3b4=this.origin,_3b5=this.cellWidth,_3b6=this.cellHeight;return new _3a2((col*_3b5*res)+_3b4.x,_3b4.y-((row+1)*_3b6*res),((col+1)*_3b5*res)+_3b4.x,_3b4.y-(row*_3b6*res),new _3a1(_3b4.spatialReference.toJson()));},getLatticeID:function(_3b7){var _3b8=this.getCellCoordinates({x:_3b7.xmin,y:_3b7.ymax}),_3b9=this.getCellCoordinates({x:_3b7.xmax,y:_3b7.ymin}),_3ba=_3b8.row,_3bb=_3b9.row,_3bc=this.normalize(_3b8.col),_3bd=this.normalize(_3b9.col);return _3ba+"_"+_3bb+"_"+_3bc+"_"+_3bd;},sorter:function(a,b){return (a<b)?-1:1;},getCellsInExtent:function(_3be,_3bf){var _3c0=this.getCellCoordinates({x:_3be.xmin,y:_3be.ymax}),_3c1=this.getCellCoordinates({x:_3be.xmax,y:_3be.ymin}),_3c2=_3c0.row,_3c3=_3c1.row,_3c4=_3c0.col,_3c5=_3c1.col,_3c6=[],i,j,nj,_3c7=[],_3c8=[],len,xmin,xmax,ymin,ymax,_3c9=[],_3ca,_3cb;for(i=_3c2;i<=_3c3;i++){for(j=_3c4;j<=_3c5;j++){nj=this.normalize(j);_3be=this.getCellExtent(i,nj);_3c6.push({row:i,col:nj,extent:_3be,resolution:this._resolution});if(_3bf){_3c7.push(_3be.xmin,_3be.xmax);_3c8.push(_3be.ymin,_3be.ymax);}}}_3c4=this.normalize(_3c4);_3c5=this.normalize(_3c5);_3c7.sort(this.sorter);_3c8.sort(this.sorter);len=_3c7.length;for(i=len-1;i>=0;i--){if(i<(len-1)){if(_3c7[i]===_3c7[i+1]){_3c7.splice(i,1);}}}len=_3c8.length;for(i=len-1;i>=0;i--){if(i<(len-1)){if(_3c8[i]===_3c8[i+1]){_3c8.splice(i,1);}}}if(_3c7.length&&_3c8.length){xmin=_3c7[0];xmax=_3c7[_3c7.length-1];ymin=_3c8[0];ymax=_3c8[_3c8.length-1];len=_3c7.length;for(i=0;i<len;i++){_3c9.push([[_3c7[i],ymax],[_3c7[i],ymin]]);}len=_3c8.length;for(i=0;i<len;i++){_3c9.push([[xmin,_3c8[i]],[xmax,_3c8[i]]]);}_3ca=new _3a3({paths:_3c9,spatialReference:this.origin.spatialReference.toJson()});_3cb=_3c2+"_"+_3c3+"_"+_3c4+"_"+_3c5;_3c6.push({latticeID:_3cb,lattice:_3ca,resolution:this._resolution});}return {minRow:_3c2,maxRow:_3c3,minCol:_3c4,maxCol:_3c5,cells:_3c6};}});if(has("extend-esri")){lang.setObject("layers._GridLayout",_3a4,_3a0);}return _3a4;});},"dojox/data/CsvStore":function(){define("dojox/data/CsvStore",["dojo/_base/lang","dojo/_base/declare","dojo/_base/xhr","dojo/_base/kernel","dojo/data/util/filter","dojo/data/util/simpleFetch"],function(lang,_3cc,xhr,_3cd,_3ce,_3cf){var _3d0=_3cc("dojox.data.CsvStore",null,{constructor:function(_3d1){this._attributes=[];this._attributeIndexes={};this._dataArray=[];this._arrayOfAllItems=[];this._loadFinished=false;if(_3d1.url){this.url=_3d1.url;}this._csvData=_3d1.data;if(_3d1.label){this.label=_3d1.label;}else{if(this.label===""){this.label=undefined;}}this._storeProp="_csvStore";this._idProp="_csvId";this._features={"dojo.data.api.Read":true,"dojo.data.api.Identity":true};this._loadInProgress=false;this._queuedFetches=[];this.identifier=_3d1.identifier;if(this.identifier===""){delete this.identifier;}else{this._idMap={};}if("separator" in _3d1){this.separator=_3d1.separator;}if("urlPreventCache" in _3d1){this.urlPreventCache=_3d1.urlPreventCache?true:false;}},url:"",label:"",identifier:"",separator:",",urlPreventCache:false,_assertIsItem:function(item){if(!this.isItem(item)){throw new Error(this.declaredClass+": a function was passed an item argument that was not an item");}},_getIndex:function(item){var idx=this.getIdentity(item);if(this.identifier){idx=this._idMap[idx];}return idx;},getValue:function(item,_3d2,_3d3){this._assertIsItem(item);var _3d4=_3d3;if(typeof _3d2==="string"){var ai=this._attributeIndexes[_3d2];if(ai!=null){var _3d5=this._dataArray[this._getIndex(item)];_3d4=_3d5[ai]||_3d3;}}else{throw new Error(this.declaredClass+": a function was passed an attribute argument that was not a string");}return _3d4;},getValues:function(item,_3d6){var _3d7=this.getValue(item,_3d6);return (_3d7?[_3d7]:[]);},getAttributes:function(item){this._assertIsItem(item);var _3d8=[];var _3d9=this._dataArray[this._getIndex(item)];for(var i=0;i<_3d9.length;i++){if(_3d9[i]!==""){_3d8.push(this._attributes[i]);}}return _3d8;},hasAttribute:function(item,_3da){this._assertIsItem(item);if(typeof _3da==="string"){var _3db=this._attributeIndexes[_3da];var _3dc=this._dataArray[this._getIndex(item)];return (typeof _3db!=="undefined"&&_3db<_3dc.length&&_3dc[_3db]!=="");}else{throw new Error(this.declaredClass+": a function was passed an attribute argument that was not a string");}},containsValue:function(item,_3dd,_3de){var _3df=undefined;if(typeof _3de==="string"){_3df=_3ce.patternToRegExp(_3de,false);}return this._containsValue(item,_3dd,_3de,_3df);},_containsValue:function(item,_3e0,_3e1,_3e2){var _3e3=this.getValues(item,_3e0);for(var i=0;i<_3e3.length;++i){var _3e4=_3e3[i];if(typeof _3e4==="string"&&_3e2){return (_3e4.match(_3e2)!==null);}else{if(_3e1===_3e4){return true;}}}return false;},isItem:function(_3e5){if(_3e5&&_3e5[this._storeProp]===this){var _3e6=_3e5[this._idProp];if(this.identifier){var data=this._dataArray[this._idMap[_3e6]];if(data){return true;}}else{if(_3e6>=0&&_3e6<this._dataArray.length){return true;}}}return false;},isItemLoaded:function(_3e7){return this.isItem(_3e7);},loadItem:function(item){},getFeatures:function(){return this._features;},getLabel:function(item){if(this.label&&this.isItem(item)){return this.getValue(item,this.label);}return undefined;},getLabelAttributes:function(item){if(this.label){return [this.label];}return null;},_fetchItems:function(_3e8,_3e9,_3ea){var self=this;var _3eb=function(_3ec,_3ed){var _3ee=null;if(_3ec.query){var key,_3ef;_3ee=[];var _3f0=_3ec.queryOptions?_3ec.queryOptions.ignoreCase:false;var _3f1={};for(key in _3ec.query){_3ef=_3ec.query[key];if(typeof _3ef==="string"){_3f1[key]=_3ce.patternToRegExp(_3ef,_3f0);}}for(var i=0;i<_3ed.length;++i){var _3f2=true;var _3f3=_3ed[i];for(key in _3ec.query){_3ef=_3ec.query[key];if(!self._containsValue(_3f3,key,_3ef,_3f1[key])){_3f2=false;}}if(_3f2){_3ee.push(_3f3);}}}else{_3ee=_3ed.slice(0,_3ed.length);}_3e9(_3ee,_3ec);};if(this._loadFinished){_3eb(_3e8,this._arrayOfAllItems);}else{if(this.url!==""){if(this._loadInProgress){this._queuedFetches.push({args:_3e8,filter:_3eb});}else{this._loadInProgress=true;var _3f4={url:self.url,handleAs:"text",preventCache:self.urlPreventCache};var _3f5=xhr.get(_3f4);_3f5.addCallback(function(data){try{self._processData(data);_3eb(_3e8,self._arrayOfAllItems);self._handleQueuedFetches();}catch(e){_3ea(e,_3e8);}});_3f5.addErrback(function(_3f6){self._loadInProgress=false;if(_3ea){_3ea(_3f6,_3e8);}else{throw _3f6;}});var _3f7=null;if(_3e8.abort){_3f7=_3e8.abort;}_3e8.abort=function(){var df=_3f5;if(df&&df.fired===-1){df.cancel();df=null;}if(_3f7){_3f7.call(_3e8);}};}}else{if(this._csvData){try{this._processData(this._csvData);this._csvData=null;_3eb(_3e8,this._arrayOfAllItems);}catch(e){_3ea(e,_3e8);}}else{var _3f8=new Error(this.declaredClass+": No CSV source data was provided as either URL or String data input.");if(_3ea){_3ea(_3f8,_3e8);}else{throw _3f8;}}}}},close:function(_3f9){},_getArrayOfArraysFromCsvFileContents:function(_3fa){if(lang.isString(_3fa)){var _3fb=new RegExp("^\\s+","g");var _3fc=new RegExp("\\s+$","g");var _3fd=new RegExp("\"\"","g");var _3fe=[];var i;var _3ff=this._splitLines(_3fa);for(i=0;i<_3ff.length;++i){var _400=_3ff[i];if(_400.length>0){var _401=_400.split(this.separator);var j=0;while(j<_401.length){var _402=_401[j];var _403=_402.replace(_3fb,"");var _404=_403.replace(_3fc,"");var _405=_404.charAt(0);var _406=_404.charAt(_404.length-1);var _407=_404.charAt(_404.length-2);var _408=_404.charAt(_404.length-3);if(_404.length===2&&_404=="\"\""){_401[j]="";}else{if((_405=="\"")&&((_406!="\"")||((_406=="\"")&&(_407=="\"")&&(_408!="\"")))){if(j+1===_401.length){return;}var _409=_401[j+1];_401[j]=_403+this.separator+_409;_401.splice(j+1,1);}else{if((_405=="\"")&&(_406=="\"")){_404=_404.slice(1,(_404.length-1));_404=_404.replace(_3fd,"\"");}_401[j]=_404;j+=1;}}}_3fe.push(_401);}}this._attributes=_3fe.shift();for(i=0;i<this._attributes.length;i++){this._attributeIndexes[this._attributes[i]]=i;}this._dataArray=_3fe;}},_splitLines:function(_40a){var _40b=[];var i;var line="";var _40c=false;for(i=0;i<_40a.length;i++){var c=_40a.charAt(i);switch(c){case "\"":_40c=!_40c;line+=c;break;case "\r":if(_40c){line+=c;}else{_40b.push(line);line="";if(i<(_40a.length-1)&&_40a.charAt(i+1)=="\n"){i++;}}break;case "\n":if(_40c){line+=c;}else{_40b.push(line);line="";}break;default:line+=c;}}if(line!==""){_40b.push(line);}return _40b;},_processData:function(data){this._getArrayOfArraysFromCsvFileContents(data);this._arrayOfAllItems=[];if(this.identifier){if(this._attributeIndexes[this.identifier]===undefined){throw new Error(this.declaredClass+": Identity specified is not a column header in the data set.");}}for(var i=0;i<this._dataArray.length;i++){var id=i;if(this.identifier){var _40d=this._dataArray[i];id=_40d[this._attributeIndexes[this.identifier]];this._idMap[id]=i;}this._arrayOfAllItems.push(this._createItemFromIdentity(id));}this._loadFinished=true;this._loadInProgress=false;},_createItemFromIdentity:function(_40e){var item={};item[this._storeProp]=this;item[this._idProp]=_40e;return item;},getIdentity:function(item){if(this.isItem(item)){return item[this._idProp];}return null;},fetchItemByIdentity:function(_40f){var item;var _410=_40f.scope?_40f.scope:_3cd.global;if(!this._loadFinished){var self=this;if(this.url!==""){if(this._loadInProgress){this._queuedFetches.push({args:_40f});}else{this._loadInProgress=true;var _411={url:self.url,handleAs:"text"};var _412=xhr.get(_411);_412.addCallback(function(data){try{self._processData(data);var item=self._createItemFromIdentity(_40f.identity);if(!self.isItem(item)){item=null;}if(_40f.onItem){_40f.onItem.call(_410,item);}self._handleQueuedFetches();}catch(error){if(_40f.onError){_40f.onError.call(_410,error);}}});_412.addErrback(function(_413){this._loadInProgress=false;if(_40f.onError){_40f.onError.call(_410,_413);}});}}else{if(this._csvData){try{self._processData(self._csvData);self._csvData=null;item=self._createItemFromIdentity(_40f.identity);if(!self.isItem(item)){item=null;}if(_40f.onItem){_40f.onItem.call(_410,item);}}catch(e){if(_40f.onError){_40f.onError.call(_410,e);}}}}}else{item=this._createItemFromIdentity(_40f.identity);if(!this.isItem(item)){item=null;}if(_40f.onItem){_40f.onItem.call(_410,item);}}},getIdentityAttributes:function(item){if(this.identifier){return [this.identifier];}else{return null;}},_handleQueuedFetches:function(){if(this._queuedFetches.length>0){for(var i=0;i<this._queuedFetches.length;i++){var _414=this._queuedFetches[i];var _415=_414.filter;var _416=_414.args;if(_415){_415(_416,this._arrayOfAllItems);}else{this.fetchItemByIdentity(_414.args);}}this._queuedFetches=[];}}});lang.extend(_3d0,_3cf);return _3d0;});},"esri/arcgis/csv":function(){define(["dojo/_base/lang","dojo/_base/array","dojo/_base/Deferred","dojo/sniff","dojo/number","dojox/data/CsvStore","esri/kernel","esri/config","esri/request","esri/SpatialReference","esri/geometry/Point","esri/geometry/jsonUtils","esri/geometry/webMercatorUtils"],function(lang,_417,_418,has,_419,_41a,_41b,_41c,_41d,_41e,_41f,_420,_421){var _422=["lat","latitude","y","ycenter","latitude83","latdecdeg","POINT-Y"],_423=["lon","lng","long","longitude","x","xcenter","longitude83","longdecdeg","POINT-X"];function _424(_425){var _426=[","," ",";","|","\t"];var _427=0;var _428="";_417.forEach(_426,function(_429){var _42a=_425.split(_429).length;if(_42a>_427){_427=_42a;_428=_429;}});return _428;};function _42b(d,_42c){if(!d||Object.prototype.toString.call(d)!=="[object Date]"||isNaN(d.getTime())){return false;}var _42d=true;if(has("chrome")&&/\d+\W*$/.test(_42c)){var _42e=_42c.match(/[a-zA-Z]{2,}/);if(_42e){var _42f=false,i=0,len=_42e.length,_430=/^((jan(uary)?)|(feb(ruary)?)|(mar(ch)?)|(apr(il)?)|(may)|(jun(e)?)|(jul(y)?)|(aug(ust)?)|(sep(tember)?)|(oct(ober)?)|(nov(ember)?)|(dec(ember)?)|(am)|(pm)|(gmt)|(utc))$/i;while(!_42f&&(i<=len)&&!(_42f=!_430.test(_42e[i]))){i++;}_42d=!_42f;}}return _42d;};function _431(data,_432,_433){var _434=data.indexOf("\n");var _435=lang.trim(data.substr(0,_434));var _436=_432.columnDelimiter;if(!_436){_436=_424(_435);}var _437=new _41a({data:data,separator:_436});var _438=(has("ie")<9)?750:1001;_437.fetch({start:0,count:_438,onComplete:function(_439,_43a){var _43b=0;var _43c={"layerDefinition":_432.layerDefinition,"featureSet":{"features":[],"geometryType":"esriGeometryPoint"}};var _43d=_43c.layerDefinition.objectIdField;if(!_43d){if(!_417.some(_43c.layerDefinition.fields,function(_43e){if(_43e.type=="esriFieldTypeOID"){_43d=_43e.name;return true;}return false;})){_43c.layerDefinition.fields.push({"name":"__OBJECTID","alias":"__OBJECTID","type":"esriFieldTypeOID","editable":false,"domain":null});_43d="__OBJECTID";}}var _43f,_440;var _441=_437._attributes;var _442=[];var _443=[];_417.forEach(_43c.layerDefinition.fields,function(_444,_445){if(_444.type==="esriFieldTypeDate"){_442.push(_444.name);}else{if(_444.type==="esriFieldTypeDouble"||_444.type==="esriFieldTypeInteger"){_443.push(_444.name);}}});if(_432.locationInfo&&_432.locationInfo.locationType==="coordinates"){_43f=_432.locationInfo.latitudeFieldName;_440=_432.locationInfo.longitudeFieldName;}else{_417.forEach(_441,function(_446){var _447;_447=_417.indexOf(_422,_446.toLowerCase());if(_447!==-1){_43f=_446;}_447=_417.indexOf(_423,_446.toLowerCase());if(_447!==-1){_440=_446;}},this);}if(!_43f||!_440){setTimeout(function(){console.error("File does not seem to contain fields with point coordinates.");},1);return;}var i=0,il=_439.length;for(i;i<il;i++){if(_43c.featureSet.features.length>=1000){setTimeout(function(){console.error("1000 feature limit reached. Unable to load any more data.");},1);break;}var item=_439[i];var _448=_437.getAttributes(item),_449={};_417.forEach(_448,function(attr,_44a){if(attr){var _44b=attr;if(attr.length===0){_417.forEach(_43c.layerDefinition.fields,function(_44c,idx){if(_44c.name==="attribute_"+(idx-1)){attr="attribute_"+(idx-1);}});}if(_417.some(_442,function(a){return a===attr;})){var val=_437.getValue(item,_44b),date=new Date(val);_449[attr]=_42b(date,val)?date.getTime():null;}else{if(_417.some(_443,function(a){return a===attr;})){var _44d=_419.parse(_437.getValue(item,_44b));if((attr==_43f||attr==_440)&&(isNaN(_44d)||Math.abs(_44d)>181)){_44d=parseFloat(_437.getValue(item,_44b));if(isNaN(_44d)){_449[attr]=null;}else{_449[attr]=_44d;}}else{if(isNaN(_44d)){_449[attr]=null;}else{_449[attr]=_44d;}}}else{_449[attr]=_437.getValue(item,_44b);}}}});_449[_43d]=_43b;_43b++;var _44e=_449[_43f];var _44f=_449[_440];if(_44f==null||_44e==null||isNaN(_44e)||isNaN(_44f)){continue;}var _450=new _41f(_44f,_44e,new _41e({wkid:4326}));var _451={"geometry":_450.toJson(),"attributes":_449};_43c.featureSet.features.push(_451);}_43c.layerDefinition.name="csv";if(_433){_433(_43c);}},onError:function(_452){console.error("Error fetching items from CSV store: ",_452);}});return true;};function _453(_454,_455,inSR,_456,_457,_458){if(_454.length===0){_457(null);}var _459=_420.getGeometryType(_455);var _45a=[];_417.forEach(_454,function(_45b){var _45c=new _459(_45b);_45c.spatialReference=inSR;_45a.push(_45c);},this);var _45d=[102113,102100,3857];if(inSR.wkid&&inSR.wkid===4326&&_456.wkid&&_417.indexOf(_45d,_456.wkid)>-1){_417.forEach(_45a,function(_45e){if(_45e.xmin){_45e.xmin=Math.max(_45e.xmin,-180);_45e.xmax=Math.min(_45e.xmax,180);_45e.ymin=Math.max(_45e.ymin,-89.99);_45e.ymax=Math.min(_45e.ymax,89.99);}else{if(_45e.rings){_417.forEach(_45e.rings,function(ring){_417.forEach(ring,function(_45f){_45f[0]=Math.min(Math.max(_45f[0],-180),180);_45f[1]=Math.min(Math.max(_45f[1],-89.99),89.99);},this);},this);}else{if(_45e.paths){_417.forEach(_45e.paths,function(path){_417.forEach(path,function(_460){_460[0]=Math.min(Math.max(_460[0],-180),180);_460[1]=Math.min(Math.max(_460[1],-89.99),89.99);},this);},this);}else{if(_45e.x){_45e.x=Math.min(Math.max(_45e.x,-180),180);_45e.y=Math.min(Math.max(_45e.y,-89.99),89.99);}}}}},this);_454=[];_417.forEach(_45a,function(_461){var _462=_421.geographicToWebMercator(_461);if(_456.wkid!==102100){_462.spatialReference=_456;}_454.push(_462.toJson());},this);_457(_454);}else{if(inSR.wkid!==null&&_417.indexOf(_45d,inSR.wkid)>-1&&_456.wkid!==null&&_456.wkid===4326){_454=[];_417.forEach(_45a,function(_463){_454.push(_421.webMercatorToGeographic(_463).toJson());},this);_457(_454);}else{var _464=function(_465,args){if(_465&&_465.length===_454.length){_454=[];_417.forEach(_465,function(_466){if(_466&&((_466.rings&&_466.rings.length>0&&_466.rings[0].length>0&&_466.rings[0][0].length>0&&!isNaN(_466.rings[0][0][0])&&!isNaN(_466.rings[0][0][1]))||(_466.paths&&_466.paths.length>0&&_466.paths[0].length>0&&_466.paths[0][0].length>0&&!isNaN(_466.paths[0][0][0])&&!isNaN(_466.paths[0][0][1]))||(_466.xmin&&!isNaN(_466.xmin)&&_466.ymin&&!isNaN(_466.ymin))||(_466.x&&!isNaN(_466.x)&&_466.y&&!isNaN(_466.y)))){_454.push(_466.toJson());}else{_454.push(null);}},this);_457(_454);}else{_458(_465,args);}};if(_41c.defaults.geometryService){_41c.defaults.geometryService.project(_45a,_456,lang.hitch(this,_464),_458);}else{_457(null);}}}};function _467(sp1,sp2){var _468=[102113,102100,3857];if(sp1&&sp2&&sp1.wkid===sp2.wkid&&sp1.wkt===sp2.wkt){return true;}else{if(sp1&&sp2&&sp1.wkid&&sp2.wkid&&_417.indexOf(_468,sp1.wkid)>-1&&_417.indexOf(_468,sp2.wkid)>-1){return true;}}return false;};function _469(_46a,_46b,_46c,_46d){if(!_46a.featureSet||_46a.featureSet.length===0){return;}if(_467(_46c,_46b)){_46d(_46a);return;}var _46e=function(_46f){var _470=[];_417.forEach(_46a.featureSet.features,function(_471,i){if(_46f[i]){_471.geometry=_46f[i];_470.push(_471);}},this);_46d(_46a);};var _472=function(_473,args){console.error("error projecting featureSet ("+_46a.layerDefinition.name+"). Final try.");_46d(_46a);};var _474=function(_475,args){console.error("error projecting featureSet ("+_46a.layerDefinition.name+"). Try one more time.");_453(_476,_46a.featureSet.geometryType,_46b,_46c,lang.hitch(this,_46e),lang.hitch(this,_472));};if(_46a.featureSet.features&&_46a.featureSet.features.length>0){var _476=[];_417.forEach(_46a.featureSet.features,function(_477){_476.push(_477.geometry);});_453(_476,_46a.featureSet.geometryType,_46b,_46c,lang.hitch(this,_46e),lang.hitch(this,_474));}else{_46d(_46a);}};function _478(_479){var _47a=new _418();var _47b=function(_47c){_47a.callback(_47c);};var _47d=_41d({url:_479.url,handleAs:"text",load:function(_47e){_431(_47e,_479,lang.hitch(this,_47b));},error:function(_47f){console.error("error: "+_47f);}},{usePost:false});return _47a;};function _480(_481,_482){var _483=new _418();var _484=function(_485){_483.callback(_485);};_469(_481,new _41e({wkid:4326}),_482,lang.hitch(this,_484));return _483;};function _486(_487){var _488=_487.layerDefinition.fields;var _489={"esriFieldTypeDouble":1,"esriFieldTypeSingle":1};var _48a={"esriFieldTypeInteger":1,"esriFieldTypeSmallInteger":1};var dt={"esriFieldTypeDate":1};var _48b=null;var _48c=_417.map(_488,lang.hitch(this,function(item){if(item.name.toUpperCase()==="NAME"){_48b=item.name;}var _48d=(item.type!=="esriFieldTypeOID"&&item.type!=="esriFieldTypeGlobalID"&&item.type!=="esriFieldTypeGeometry");var _48e=null;if(_48d){var f=item.name.toLowerCase();var _48f=",stretched value,fnode_,tnode_,lpoly_,rpoly_,poly_,subclass,subclass_,rings_ok,rings_nok,";if(_48f.indexOf(","+f+",")>-1||f.indexOf("area")>-1||f.indexOf("length")>-1||f.indexOf("shape")>-1||f.indexOf("perimeter")>-1||f.indexOf("objectid")>-1||f.indexOf("_")===f.length-1||(f.indexOf("_i")===f.length-2&&f.length>1)){_48d=false;}if(item.type in _48a){_48e={places:0,digitSeparator:true};}else{if(item.type in _489){_48e={places:2,digitSeparator:true};}else{if(item.type in dt){_48e={dateFormat:"shortDateShortTime"};}}}}return lang.mixin({},{fieldName:item.name,label:item.alias,isEditable:true,tooltip:"",visible:_48d,format:_48e,stringFieldOption:"textbox"});}));var _490={title:_48b?"{"+_48b+"}":"",fieldInfos:_48c,description:null,showAttachments:false,mediaInfos:[]};return _490;};var csv={latFieldStrings:_422,longFieldStrings:_423,buildCSVFeatureCollection:_478,projectFeatureCollection:_480,generateDefaultPopupInfo:_486,_getSeparator:_424,_isValidDate:_42b,_processCsvData:_431,_projectGeometries:_453,_sameSpatialReference:_467,_projectFeatureSet:_469};if(has("extend-esri")){lang.setObject("arcgis.csv",csv,_41b);}return csv;});},"dojo/data/util/filter":function(){define(["../../_base/lang"],function(lang){var _491={};lang.setObject("dojo.data.util.filter",_491);_491.patternToRegExp=function(_492,_493){var rxp="^";var c=null;for(var i=0;i<_492.length;i++){c=_492.charAt(i);switch(c){case "\\":rxp+=c;i++;rxp+=_492.charAt(i);break;case "*":rxp+=".*";break;case "?":rxp+=".";break;case "$":case "^":case "/":case "+":case ".":case "|":case "(":case ")":case "{":case "}":case "[":case "]":rxp+="\\";default:rxp+=c;}}rxp+="$";if(_493){return new RegExp(rxp,"mi");}else{return new RegExp(rxp,"m");}};return _491;});},"esri/layers/WMSLayerInfo":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/has","esri/kernel"],function(_494,lang,_495,has,_496){var _497=_494(null,{declaredClass:"esri.layers.WMSLayerInfo",name:null,title:null,description:null,extent:null,legendURL:null,subLayers:[],allExtents:[],spatialReferences:[],constructor:function(_498){if(_498){this.name=_498.name;this.title=_498.title;this.description=_498.description;this.extent=_498.extent;this.legendURL=_498.legendURL;this.subLayers=_498.subLayers?_498.subLayers:[];this.allExtents=_498.allExtents?_498.allExtents:[];this.spatialReferences=_498.spatialReferences?_498.spatialReferences:[];}},clone:function(){var info={name:this.name,title:this.title,description:this.description,legendURL:this.legendURL},wkid;if(this.extent){info.extent=this.extent.getExtent();}info.subLayers=[];_495.forEach(this.subLayers,function(_499){info.subLayers.push(_499.clone());});info.allExtents=[];for(wkid in this.allExtents){wkid=parseInt(wkid,10);if(!isNaN(wkid)){info.allExtents[wkid]=this.allExtents[wkid].getExtent();}}info.spatialReferences=[];_495.forEach(this.spatialReferences,function(wkid){info.spatialReferences.push(wkid);});return info;}});if(has("extend-esri")){lang.setObject("layers.WMSLayerInfo",_497,_496);}return _497;});},"esri/layers/FeatureType":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/has","esri/kernel","esri/lang","esri/symbols/jsonUtils","esri/layers/RangeDomain","esri/layers/CodedValueDomain","esri/layers/InheritedDomain","esri/layers/FeatureTemplate"],function(_49a,lang,_49b,has,_49c,_49d,_49e,_49f,_4a0,_4a1,_4a2){var _4a3=_49a(null,{declaredClass:"esri.layers.FeatureType",constructor:function(json){if(json&&lang.isObject(json)){this.id=json.id;this.name=json.name;var _4a4=json.symbol;if(_4a4){this.symbol=_49e.fromJson(_4a4);}var _4a5=json.domains,_4a6,i;var _4a7=this.domains={};for(_4a6 in _4a5){if(_4a5.hasOwnProperty(_4a6)){var _4a8=_4a5[_4a6];switch(_4a8.type){case "range":_4a7[_4a6]=new _49f(_4a8);break;case "codedValue":_4a7[_4a6]=new _4a0(_4a8);break;case "inherited":_4a7[_4a6]=new _4a1(_4a8);break;}}}var _4a9=json.templates;if(_4a9){var _4aa=this.templates=[];for(i=0;i<_4a9.length;i++){_4aa.push(new _4a2(_4a9[i]));}}}},toJson:function(){var json={id:this.id,name:this.name,symbol:this.symbol&&this.symbol.toJson()};var _4ab,_4ac=this.domains,_4ad=this.templates,_4ae=_49d.fixJson;if(_4ac){var _4af=json.domains={};for(_4ab in _4ac){if(_4ac.hasOwnProperty(_4ab)){_4af[_4ab]=_4ac[_4ab]&&_4ac[_4ab].toJson();}}_4ae(_4af);}if(_4ad){json.templates=_49b.map(_4ad,function(_4b0){return _4b0.toJson();});}return _4ae(json);}});if(has("extend-esri")){lang.setObject("layers.FeatureType",_4a3,_49c);}return _4a3;});},"esri/layers/RenderMode":function(){define(["dojo/_base/kernel","dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/has","dojo/io/script","esri/kernel"],function(_4b1,_4b2,lang,_4b3,has,_4b4,_4b5){var _4b6=_4b2(null,{declaredClass:"esri.layers._RenderMode",constructor:function(){this._prefix="jsonp_"+(_4b1._scopeName||"dojo")+"IoScript";},initialize:function(map){this.map=map;this._init=true;},startup:function(){},propertyChangeHandler:function(type){},destroy:function(){this._init=false;},drawFeature:function(_4b7){},suspend:function(){},resume:function(){},refresh:function(){},_incRefCount:function(oid){var _4b8=this._featureMap[oid];if(_4b8){_4b8._count++;}},_decRefCount:function(oid){var _4b9=this._featureMap[oid];if(_4b9){_4b9._count--;}},_getFeature:function(oid){return this._featureMap[oid];},_addFeatureIIf:function(oid,_4ba){var fmap=this._featureMap,_4bb=fmap[oid],_4bc=this.featureLayer;if(!_4bb){fmap[oid]=_4ba;_4bc._add(_4ba);_4ba._count=0;}return _4bb||_4ba;},_removeFeatureIIf:function(oid){var _4bd=this._featureMap[oid],_4be=this.featureLayer;if(_4bd){if(_4bd._count){return;}delete this._featureMap[oid];_4be._remove(_4bd);}return _4bd;},_clearIIf:function(){var i,_4bf=this.featureLayer,_4c0=_4bf.graphics,_4c1=_4bf._selectedFeatures,_4c2=_4bf.objectIdField;for(i=_4c0.length-1;i>=0;i--){var _4c3=_4c0[i];var oid=_4c3.attributes[_4c2];if(oid in _4c1){_4c3._count=1;continue;}_4c3._count=0;this._removeFeatureIIf(oid);}},_isPending:function(id){var dfd=_4b4[this._prefix+id];return dfd?true:false;},_cancelPendingRequest:function(dfd,id){dfd=dfd||_4b4[this._prefix+id];if(dfd){try{dfd.cancel();_4b4._validCheck(dfd);}catch(e){}}},_purgeRequests:function(){_4b4._validCheck(null);},_toggleVisibility:function(show){var _4c4=this.featureLayer,_4c5=_4c4.graphics,_4c6=show?"show":"hide",i,len=_4c5.length;show=show&&_4c4._ager;for(i=0;i<len;i++){var _4c7=_4c5[i];_4c7[_4c6]();if(show){_4c4._repaint(_4c7);}}},_applyTimeFilter:function(_4c8){var _4c9=this.featureLayer;if(!_4c9.timeInfo||_4c9.suspended){return;}if(!_4c8){_4c9._fireUpdateStart();}var _4ca=_4c9._trackManager;if(_4ca){_4ca.clearTracks();}var defn=_4c9.getTimeDefinition(),_4cb=_4c9._getOffsettedTE(_4c9._mapTimeExtent);if(_4cb){_4cb=_4c9._getTimeOverlap(defn,_4cb);if(_4cb){var _4cc=_4c9._filterByTime(_4c9.graphics,_4cb.startTime,_4cb.endTime);if(_4ca){_4ca.addFeatures(_4cc.match);}_4b3.forEach(_4cc.match,function(_4cd){var _4ce=_4cd._shape;if(!_4cd.visible){_4cd.show();_4ce=_4cd._shape;_4ce&&_4ce._moveToFront();}if(_4c9._ager&&_4ce){_4c9._repaint(_4cd);}});_4b3.forEach(_4cc.noMatch,function(_4cf){if(_4cf.visible){_4cf.hide();}});}else{this._toggleVisibility(false);}}else{if(_4ca){_4ca.addFeatures(_4c9.graphics);}this._toggleVisibility(true);}if(_4ca){_4ca.moveLatestToFront();_4ca.drawTracks();}if(!_4c8){_4c9._fireUpdateEnd();}}});if(has("extend-esri")){lang.setObject("layers._RenderMode",_4b6,_4b5);}return _4b6;});},"esri/layers/GeoRSSLayer":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/json","dojo/has","esri/kernel","esri/config","esri/request","esri/layers/ServiceGeneratedFeatureCollection"],function(_4d0,lang,_4d1,has,_4d2,_4d3,_4d4,_4d5){var _4d6=_4d0([_4d5],{declaredClass:"esri.layers.GeoRSSLayer",serviceUrl:location.protocol+"//utility.arcgis.com/sharing/rss",constructor:function(url,_4d7){if(_4d3.defaults.geoRSSService){this.serviceUrl=_4d3.defaults.geoRSSService;}this._createLayer();this.registerConnectEvents("esri.layers.GeoRSSLayer",true);},parse:function(){this._io=_4d4({url:this.serviceUrl,content:{url:this.url,refresh:this.loaded?true:undefined,outSR:this._outSR?_4d1.toJson(this._outSR.toJson()):undefined},callbackParamName:"callback"});return this._io;},_initLayer:function(json){this.inherited(arguments);if(!this.loaded){this.loaded=true;this.onLoad(this);}}});if(has("extend-esri")){lang.setObject("layers.GeoRSSLayer",_4d6,_4d2);}return _4d6;});},"esri/layers/FeatureTemplate":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","esri/kernel","esri/lang","esri/graphic"],function(_4d8,lang,has,_4d9,_4da,_4db){var _4dc=_4d8(null,{declaredClass:"esri.layers.FeatureTemplate",constructor:function(json){if(json&&lang.isObject(json)){this.name=json.name;this.description=json.description;this.drawingTool=json.drawingTool;var _4dd=json.prototype;this.prototype=new _4db(_4dd.geometry,null,_4dd.attributes);}},toJson:function(){return _4da.fixJson({name:this.name,description:this.description,drawingTool:this.drawingTool,prototype:this.prototype&&this.prototype.toJson()});}});lang.mixin(_4dc,{TOOL_AUTO_COMPLETE_POLYGON:"esriFeatureEditToolAutoCompletePolygon",TOOL_CIRCLE:"esriFeatureEditToolCircle",TOOL_ELLIPSE:"esriFeatureEditToolEllipse",TOOL_FREEHAND:"esriFeatureEditToolFreehand",TOOL_LINE:"esriFeatureEditToolLine",TOOL_NONE:"esriFeatureEditToolNone",TOOL_POINT:"esriFeatureEditToolPoint",TOOL_POLYGON:"esriFeatureEditToolPolygon",TOOL_RECTANGLE:"esriFeatureEditToolRectangle",TOOL_ARROW:"esriFeatureEditToolArrow",TOOL_TRIANGLE:"esriFeatureEditToolTriangle",TOOL_LEFT_ARROW:"esriFeatureEditToolLeftArrow",TOOL_RIGHT_ARROW:"esriFeatureEditToolRightArrow",TOOL_UP_ARROW:"esriFeatureEditToolUpArrow",TOOL_DOWN_ARROW:"esriFeatureEditToolDownArrow"});if(has("extend-esri")){lang.setObject("layers.FeatureTemplate",_4dc,_4d9);}return _4dc;});},"*noref":1}});define("esri/arcgis/utils",["dojo/_base/lang","dojo/_base/array","dojo/_base/connect","dojo/_base/Deferred","dojo/_base/json","dojo/_base/url","dojo/has","dojo/DeferredList","dojo/dom-construct","esri/kernel","esri/config","esri/lang","esri/request","esri/SpatialReference","esri/map","esri/urlUtils","esri/geometry/ScreenPoint","esri/geometry/Extent","esri/geometry/webMercatorUtils","esri/symbols/jsonUtils","esri/renderers/jsonUtils","esri/dijit/PopupTemplate","esri/dijit/Popup","esri/tasks/query","esri/tasks/GeometryService","esri/arcgis/csv","esri/layers/ArcGISTiledMapServiceLayer","esri/layers/ArcGISDynamicMapServiceLayer","esri/layers/ArcGISImageServiceLayer","esri/layers/OpenStreetMapLayer","esri/layers/WebTiledLayer","esri/layers/FeatureLayer","esri/layers/WMSLayer","esri/layers/KMLLayer","esri/layers/GeoRSSLayer","esri/virtualearth/VETiledLayer","esri/layers/TileInfo","esri/layers/DynamicLayerInfo","esri/layers/LayerDrawingOptions","esri/layers/ImageParameters","esri/layers/ImageServiceParameters","esri/layers/WMSLayerInfo","dojo/i18n!esri/nls/jsapi"],function(lang,_4de,_4df,_4e0,_4e1,Url,has,_4e2,_4e3,_4e4,_4e5,_4e6,_4e7,_4e8,Map,_4e9,_4ea,_4eb,_4ec,_4ed,_4ee,_4ef,_4f0,_4f1,_4f2,csv,_4f3,_4f4,_4f5,_4f6,_4f7,_4f8,_4f9,_4fa,_4fb,_4fc,_4fd,_4fe,_4ff,_500,_501,_502,_503){String.prototype.endsWith=function(str){return (this.match(str+"$")==str);};var _504;function _505(_506){var url=_504.arcgisUrl+"/"+_506.itemId+"/data";var _507=_4e7({url:url,content:{f:"json"},callbackParamName:"callback"},{disableIdentityLookup:true,_preLookup:true});return _507;};function _508(_509){var _50a={f:"json"};if(_4e4.id){var _50b=_4e4.id.findCredential(_4e9.urlToObject(_504.arcgisUrl).path);if(_50b){_50a.token=_50b.token;}}var _50c=_4e7({url:_509,content:_50a,callbackParamName:"callback"},{"disableIdentityLookup":true});return _50c;};function _50d(_50e){if(_50e.itemProperties.layerDefinition){if(_50e.layerDefinition){if(!_50e.layerDefinition.drawingInfo){_50e.layerDefinition.drawingInfo=_50e.itemProperties.layerDefinition.drawingInfo;}if(!_4e6.isDefined(_50e.layerDefinition.definitionExpression)){_50e.layerDefinition.definitionExpression=_50e.itemProperties.layerDefinition.definitionExpression;}if(!_4e6.isDefined(_50e.layerDefinition.minScale)){_50e.layerDefinition.minScale=_50e.itemProperties.layerDefinition.minScale;}if(!_4e6.isDefined(_50e.layerDefinition.maxScale)){_50e.layerDefinition.maxScale=_50e.itemProperties.layerDefinition.maxScale;}}else{_50e.layerDefinition=_50e.itemProperties.layerDefinition;}}if(_50e.itemProperties.popupInfo&&!_50e.popupInfo&&!_50e.disablePopup){_50e.popupInfo=_50e.itemProperties.popupInfo;}};function _50f(_510,_511){var _512=new _4e0();var _513=_510.itemData;var _514=[];var _515=[];_4de.forEach(_513.operationalLayers,function(_516){if(_516.itemId&&!_516.type){var _517=_516.url.toLowerCase();if(_517.indexOf("/featureserver")>-1){_515.push(_516);_514.push(_505(_516));}else{if(_517.indexOf("/mapserver")>-1&&_517.indexOf("/mapserver/")===-1&&(!_516.layers||(!_4e6.isDefined(_516.minScale)&&!_4e6.isDefined(_516.maxScale)))){_515.push(_516);_514.push(_505(_516));}else{if(_517.indexOf("/imageserver")>-1&&!_4e6.isDefined(_516.minScale)&&!_4e6.isDefined(_516.maxScale)){_515.push(_516);_514.push(_505(_516));}}}}});if(_513.baseMap&&_513.baseMap.baseMapLayers){_4de.forEach(_513.baseMap.baseMapLayers,function(_518){if((_518.type==="BingMapsAerial"||_518.type==="BingMapsRoad"||_518.type==="BingMapsHybrid")&&_518.portalUrl){_515.push(_518);_514.push(_508(_518.portalUrl));}});}if(_514.length>0){var _519=new _4e2(_514);_519.addCallback(function(_51a){_4de.forEach(_515,function(_51b,i){if((_51b.type==="BingMapsAerial"||_51b.type==="BingMapsRoad"||_51b.type==="BingMapsHybrid")&&_51b.portalUrl){if(_51a[i][1].bingKey){_511.bingMapsKey=_51a[i][1].bingKey;}else{_51b.errors=_51b.errors||[];var _51c={message:"The owner of the map has not provided a Bing Key for the Bing Map it includes. [type:"+_51b.type+"]"};_51b.errors.push(_51c);}return;}var _51d=_51a[i][1];if(_51d){var _51e=_51b.url.toLowerCase();if(_51e.indexOf("/featureserver")>-1&&_51d.layers){_4de.forEach(_51d.layers,function(_51f){if(_51e.endsWith("/featureserver/"+_51f.id)){_51b.itemProperties=_51f;_50d(_51b);}});}else{if(_51e.indexOf("/mapserver")>-1){if(_51d.layers&&!_51b.layers){_51b.layers=_51d.layers;}if(_4e6.isDefined(_51d.minScale)&&!_4e6.isDefined(_51b.minScale)){_51b.minScale=_51d.minScale;}if(_4e6.isDefined(_51d.maxScale)&&!_4e6.isDefined(_51b.maxScale)){_51b.maxScale=_51d.maxScale;}}else{if(_51e.indexOf("/imageserver")>-1){if(_4e6.isDefined(_51d.minScale)&&!_4e6.isDefined(_51b.minScale)){_51b.minScale=_51d.minScale;}if(_4e6.isDefined(_51d.maxScale)&&!_4e6.isDefined(_51b.maxScale)){_51b.maxScale=_51d.maxScale;}}}}}});_512.callback(_510);});}else{_512.callback(_510);}return _512;};function _520(_521,_522){var _523=_521.dynamicLayerInfos||_521.layerInfos;var _524=_522.layers;if(_524&&_523){var _525=[],ids=[],urls=[];_4de.forEach(_523,function(_526){var id=_526.id,i;if(!_526.subLayerIds&&_4de.indexOf(_521.visibleLayers,id)!==-1){for(i=0;i<_524.length;i++){var _527=_524[i];if(_527.id===id){ids.push(id);_525.push(_527.popupInfo);urls.push(_527.layerUrl||"");break;}}}});if(_525.length){_521.__popups=_525;_521.__popupIds=ids;_521.__popupUrls=urls;_521.__resourceInfo=_522.resourceInfo;}}};function _528(url){if(!url){return false;}var _529=".arcgis.com/";var _52a=(new Url(_504.arcgisUrl)).authority;return (url.indexOf(_529)!==-1||url.indexOf(_52a)!==-1);};function _52b(url){if(!url){return false;}return (url.indexOf("/services.arcgisonline.com/")!==-1||url.indexOf("/server.arcgisonline.com/")!==-1);};function _52c(url){if(location.protocol==="https:"&&(_528(url)||_52b(url))){url=url.replace("http:","https:");}return url;};function _52d(_52e){var _52f=[];if(!_52e.displayLevels){_52f=_4de.map(_52e.resourceInfo.tileInfo.lods,function(lod){return lod.level;});}var _530=new _4f3(_52c(_52e.url),{resourceInfo:_52e.resourceInfo,opacity:_52e.opacity,visible:_52e.visibility,displayLevels:_52e.displayLevels||_52f,id:_52e.id,minScale:_52e.minScale,maxScale:_52e.maxScale});_520(_530,_52e);return _530;};function _531(_532,_533){if(!_532||!_533||_533.length===0){return [];}var _534=","+_533+",";var _535=[];var _536="";var k,_537=",";for(k=0;k<_532.length;k++){if(_532[k].subLayerIds!==null){if(_534.indexOf(","+_532[k].id+",")===-1||_537.indexOf(","+_532[k].id+",")>-1){_537+=_532[k].subLayerIds.toString()+",";}}else{if(_534.indexOf(","+_532[k].id+",")>-1&&_537.indexOf(","+_532[k].id+",")===-1){_535.push(_532[k].id);_536=",";}}}return _535;};function _538(_539){var _53a=new _500();_53a.format="png24";if(_539.resourceInfo&&_539.resourceInfo.supportedImageFormatTypes&&_539.resourceInfo.supportedImageFormatTypes.indexOf("PNG32")>-1){_53a.format="png32";}var _53b=new _4f4(_52c(_539.url),{resourceInfo:_539.resourceInfo,opacity:_539.opacity,visible:_539.visibility,id:_539.id,imageParameters:_53a,minScale:_539.minScale,maxScale:_539.maxScale});var _53c=_539.visibleLayers;if(!_539.visibleLayers){var _53d="";var _53e=_53b.layerInfos;_4de.forEach(_53e,function(_53f){if(_53f.defaultVisibility){_53d+=(_53d.length>0?",":"")+_53f.id;}});_53c=_53d;}_53c=_531(_53b.layerInfos,_53c);_53b.setVisibleLayers(_53c);if(_539.layers&&_539.layers.length>0){var _540=[],_541=[],_542,_543=[],_544;_4de.forEach(_539.layers,function(_545){if(_545.layerDefinition&&_545.layerDefinition.definitionExpression){_540[_545.id]=_545.layerDefinition.definitionExpression;}if(_545.layerDefinition&&_545.layerDefinition.source){_542=new _4fe(lang.mixin(_545,_545.layerDefinition));delete _542.layerDefinition;_542.id=_545.id;if(_539.visibleLayers&&_4de.indexOf(_539.visibleLayers,_545.id)===-1){_542.defaultVisibility=false;}_541.push(_542);}if(_545.layerDefinition&&_545.layerDefinition.source&&_545.layerDefinition.drawingInfo){_544=new _4ff(_545.layerDefinition.drawingInfo);_543[_545.id]=_544;}},this);if(_540.length>0){_53b.setLayerDefinitions(_540);}if(_541.length>0){_53b.setDynamicLayerInfos(_541,true);if(_543.length>0){_53b.setLayerDrawingOptions(_543,true);}}}_520(_53b,_539);return _53b;};function _546(_547,_548){var _549=[102113,102100,3857];var sp1=new _4e8(_548[0].layerObject.fullExtent.spatialReference);var sp2=new _4e8(_547.resourceInfo.fullExtent.spatialReference);if(sp1.wkt==sp2.wkt&&(sp1.wkid==sp2.wkid||(esri.isDefined(sp1.latestWkid)&&sp1.latestWkid==sp2.wkid)||(esri.isDefined(sp2.latestWkid)&&sp1.wkid==sp2.latestWkid)||(esri.isDefined(sp1.latestWkid)&&sp1.latestWkid==sp2.latestWkid))){return true;}else{if(sp1.wkid&&sp2.wkid&&_4de.some(_549,function(wkid){return wkid===sp2.wkid;})&&_4de.some(_549,function(wkid){return wkid===sp1.wkid;})){return true;}}return false;};function _54a(_54b,_54c){if(!_54c[0].layerObject.tileInfo){return false;}var _54d=[];_4de.forEach(_54c,function(_54e){if(_54e.baseMapLayer){if(_54e.layerObject.tileInfo){_54d=_54d.concat(_4de.map(_54e.layerObject.tileInfo.lods,function(lod){return lod.scale;}));}}});var _54f=_4de.some(_54b.resourceInfo.tileInfo.lods,function(lod){return _4de.some(_54d,function(_550){return _550===lod.scale;});});return _54f;};function _551(_552,_553,_554,_555){var _556,_557=_554._clazz;if(_552.type==="OpenStreetMap"){_556=new _4f6({id:_552.id,opacity:_552.opacity,visible:(_552.visibility!==null&&_552.visibility!==undefined)?_552.visibility:true});}else{if(_552.type==="WMS"){var _558=[];var _559=[];_4de.forEach(_552.layers,function(_55a){_559.push(new _502({name:_55a.name,title:_55a.title,legendURL:_55a.legendURL}));_558.push(_55a.name);},this);if(_552.visibleLayers){_558=_552.visibleLayers;}var _55b=new _4eb(_552.extent[0][0],_552.extent[0][1],_552.extent[1][0],_552.extent[1][1],new _4e8({wkid:4326}));var _55c={extent:_55b,layerInfos:_559,version:_552.version,maxWidth:_552.maxWidth,maxHeight:_552.maxHeight,getMapUrl:_552.mapUrl,spatialReferences:_552.spatialReferences,title:_552.title,copyright:_552.copyright};_556=new _4f9(_552.url,{id:_552.id,visibleLayers:_558,format:"png",transparent:_552.baseMapLayer?false:true,opacity:_552.opacity,visible:(_552.visibility!==null)?_552.visibility:true,resourceInfo:_55c});_556.spatialReference.wkid=_55c.spatialReferences[0];}else{if(_552.type==="KML"){_556=new _4fa(_552.url,{id:_552.id,visible:(_552.visibility!==null)?_552.visibility:true,outSR:_555});_4df.connect(_556,"onLoad",function(){var _55d=function(_55e){_4de.forEach(_55e,function(_55f){if(_55f.declaredClass==="esri.layers.FeatureLayer"||_55f.declaredClass==="esri.layers.MapImageLayer"){_55f.setOpacity(_552.opacity);}else{if(_55f.declaredClass==="esri.layers.KMLLayer"){if(_55f.loaded){_55d(_55f.getLayers());}else{_4df.connect(_55f,"onLoad",lang.hitch(this,function(lyr){_55d(lyr.getLayers());}));}}}});};if(_552.opacity||_552.opacity===0){_55d(_556.getLayers());}if(_552.visibleFolders){_4de.forEach(_556.folders,function(_560){if(_4de.indexOf(_552.visibleFolders,_560.id)>-1){_556.setFolderVisibility(_560,true);}else{_556.setFolderVisibility(_560,false);}},this);}});}else{if(_552.type==="WebTiledLayer"){_556=new _4f7(_552.templateUrl,{id:_552.id,visible:(_552.visibility!==null)?_552.visibility:true,opacity:_552.opacity,copyright:_552.copyright,fullExtent:_552.fullExtent&&new _4eb(_552.fullExtent),initialExtent:_552.fullExtent&&new _4eb(_552.fullExtent),subDomains:_552.subDomains,tileInfo:_552.tileInfo?new _4fd(_552.tileInfo):null});_4df.connect(_556,"onLoad",function(){if(_4e6.isDefined(_552.minScale)||_4e6.isDefined(_552.maxScale)){_556.setScaleRange(_552.minScale,_552.maxScale);}});}else{if(_552.type==="GeoRSS"){_556=new _4fb(_552.url,{id:_552.id,visible:(_552.visibility!==null)?_552.visibility:true,opacity:_552.opacity,outSpatialReference:_555});_4df.connect(_556,"onLoad",function(){var _561=_556.getFeatureLayers();_4de.forEach(_561,function(_562){if(_552.pointSymbol&&_562.geometryType==="esriGeometryPoint"){_562.renderer.symbol=_4ed.fromJson(_552.pointSymbol);}else{if(_552.lineSymbol&&_562.geometryType==="esriGeometryPolyline"){_562.renderer.symbol=_4ed.fromJson(_552.lineSymbol);}else{if(_552.polygonSymbol&&_562.geometryType==="esriGeometryPolygon"){_562.renderer.symbol=_4ed.fromJson(_552.polygonSymbol);}}}if(_4e6.isDefined(_552.minScale)||_4e6.isDefined(_552.maxScale)){_562.setScaleRange(_552.minScale,_552.maxScale);}});});}else{if(_552.type=="CSV"&&_552.url){_556=new _4f8(_552.featureCollection,{infoTemplate:new _4ef(_552.popupInfo?_552.popupInfo:csv.generateDefaultPopupInfo(_552.featureCollection)),id:_552.id?_552.id:null,outFields:["*"],visible:(_552.visibility!==null)?_552.visibility:true,opacity:_552.opacity,autoGeneralize:true});}else{if(_552.layerDefinition&&!_552.url){var _563=_4e1.fromJson(_4e1.toJson(_552));delete _563.id;delete _563.opacity;delete _563.visibility;_556=new _4f8(_563,{id:_552.id,opacity:_552.opacity,visible:_552.visibility,outFields:["*"],infoTemplate:_563.popupInfo&&new _557(_563.popupInfo),autoGeneralize:true});}else{if(_552.type==="BingMapsAerial"||_552.type==="BingMapsRoad"||_552.type==="BingMapsHybrid"){if(_554.bingMapsKey){var _564=_4fc.MAP_STYLE_AERIAL_WITH_LABELS;if(_552.type==="BingMapsAerial"){_564=_4fc.MAP_STYLE_AERIAL;}else{if(_552.type==="BingMapsRoad"){_564=_4fc.MAP_STYLE_ROAD;}}_556=new _4fc({bingMapsKey:_554.bingMapsKey,mapStyle:_564,opacity:_552.opacity,id:_552.id});}}else{if(_552.resourceInfo&&_552.resourceInfo.mapName){if(_552.resourceInfo.singleFusedMapCache===true){if(!_552.baseMapLayer){if(_546(_552,_553)){if(_54a(_552,_553)){_556=_52d(_552);}else{_556=_538(_552);}}else{_556=_538(_552);}}else{_556=_52d(_552);}}else{_556=_538(_552);}}else{if(_552.resourceInfo&&_552.resourceInfo.pixelSizeX){var _565=new _501();_565.bandIds=_552.bandIds;if(!_552.bandIds&&_552.resourceInfo.bandCount&&parseInt(_552.resourceInfo.bandCount,10)>3){_565.bandIds=[0,1,2];}_556=new _4f5(_52c(_552.url),{resourceInfo:_552.resourceInfo,opacity:_552.opacity,visible:_552.visibility,id:_552.id,imageServiceParameters:_565,minScale:_552.minScale,maxScale:_552.maxScale});}else{if(_552.resourceInfo&&_552.resourceInfo.type==="Feature Layer"){_556=new _4f8(_52c(_552.url),{resourceInfo:_552.resourceInfo,opacity:_552.opacity,visible:_552.visibility,id:_552.id,mode:_4e6.isDefined(_552.mode)?_552.mode:_4f8.MODE_ONDEMAND,outFields:["*"],infoTemplate:_552.popupInfo&&new _557(_552.popupInfo),autoGeneralize:true});if(_552.layerDefinition){if(_552.layerDefinition.drawingInfo&&_552.layerDefinition.drawingInfo.renderer){var _566=_4ee.fromJson(_552.layerDefinition.drawingInfo.renderer);_566.isMaxInclusive=true;_556.setRenderer(_566);}if(_552.layerDefinition.definitionExpression){_556.setDefinitionExpression(_552.layerDefinition.definitionExpression);}if(_4e6.isDefined(_552.layerDefinition.minScale)){_556.setMinScale(_552.layerDefinition.minScale);}if(_4e6.isDefined(_552.layerDefinition.maxScale)){_556.setMaxScale(_552.layerDefinition.maxScale);}}}}}}}}}}}}}if(_556){_556.arcgisProps={title:_552.title};if(_552.baseMapLayer){if(_552.isReference){_556._basemapGalleryLayerType="reference";}else{_556._basemapGalleryLayerType="basemap";}}}return _556;};function _567(_568,_569,_56a){_4de.forEach(_568,function(_56b,_56c){if(_56b.url&&!_56b.type){if(_56c===0||_568[0].layerObject){_56b.layerObject=_551(_56b,_568,_569,_56a);}}else{if(_56b.url&&_56b.type=="CSV"){_56b.layerObject=_551(_56b,_568,_569,_56a);}else{_56b.layerObject=_551(_56b,_568,_569,_56a);}}});var _56d=_4de.filter(_568,function(lyr){return !lyr.isReference;});var _56e=_4de.filter(_568,function(lyr){return !!lyr.isReference;});_568=_56d.concat(_56e);return _568;};function _56f(_570){var _571=null;var _572=_570[0];if(_572.url&&!_572.type){if(_572.resourceInfo.spatialReference){_571=new _4e8();if(_572.resourceInfo.spatialReference.wkid){_571.wkid=_572.resourceInfo.spatialReference.wkid;}if(_572.resourceInfo.spatialReference.wkt){_571.wkt=_572.resourceInfo.spatialReference.wkt;}}}else{if(_572.type.indexOf("BingMaps")>-1||_572.type=="OpenStreetMap"){_571=new _4e8({wkid:102100});}else{if(_572.type=="WMS"){_571=new _4e8({wkid:_572.spatialReferences[0]});}}}return _571;};function _573(_574,_575,_576,_577,_578){_4de.forEach(_575,function(_579,_57a){if(_579.url&&!_579.type){_579.resourceInfo=_574[_579.deferredsPos][1];delete _579.deferredsPos;}else{if(_579.url&&_579.type=="CSV"){_579.featureCollection=_577[_579.deferredsPos].results[0];delete _579.deferredsPos;}}});var _57b=_56f(_575);var _57c=[];var _57d=new _4e0();_4de.forEach(_575,function(_57e){if(_57e.url&&_57e.type=="CSV"){_57e.deferredsPos=_57c.length;_57c.push(csv.projectFeatureCollection(_57e.featureCollection,_57b));}});if(_57c.length==0){_575=_567(_575,_576,_57b);_578.callback(_575);}else{var _57f=new _4e2(_57c);_57f.addCallback(function(){_4de.forEach(_575,function(_580){if(_580.url&&_580.type=="CSV"){_580.featureCollection=_57c[_580.deferredsPos].results[0];delete _580.deferredsPos;}});_575=_567(_575,_576,_57b);_578.callback(_575);});}};function _581(url,_582){var url2=_52c(url);return _4e7({url:url2,content:{f:"json"},callbackParamName:"callback",error:function(_583,io){if(_583.message){_583.message+=" [url:"+url2+"]";}else{_583.message="[url:"+url2+"]";}_582.push(_583);_4e5.defaults.io.errorHandler(_583,io);}});};function _584(_585,_586){var _587=[];var _588=[];var _589=[];var _58a=new _4e0();_4de.forEach(_585.operationalLayers,function(_58b,_58c){if(_58b.featureCollection){_4de.forEach(_58b.featureCollection.layers,function(_58d,idx){var _58e=true;if(_58b.visibleLayers){if(_4de.indexOf(_58b.visibleLayers,idx)==-1){_58e=false;}}_58d.visibility=(_58b.visibility&&_58e);_58d.opacity=_58b.opacity;_58d.id=(_58b.id||("operational"+_58c))+"_"+idx;_589.push(_58d);},this);}else{_589.push(_58b);}});_4de.forEach(_585.baseMap.baseMapLayers,function(_58f,_590){_58f.baseMapLayer=true;_58f.id=_58f.id||("base"+_590);_587.push(_58f);});_4de.forEach(_589,function(_591,_592){_591.id=_591.id||("operational"+_592);_587.push(_591);});_4de.forEach(_587,function(_593){if(_593.url&&!_593.type){_593.deferredsPos=_588.length;_593.errors=[];_588.push(_581(_593.url,_593.errors));}else{if(_593.url&&_593.type=="CSV"){_593.deferredsPos=_588.length;_588.push(csv.buildCSVFeatureCollection(_593));}}});if(_588.length==0){var _594=_56f(_587);_587=_567(_587,_586,_594);_58a.callback(_587);}else{var _595=new _4e2(_588);_595.addCallback(function(_596){_573(_596,_587,_586,_588,_58a);});}return _58a;};function _597(_598,_599){if(_599.version<=10.1&&_598){var i,id=parseInt(_599.url.substring(_599.url.lastIndexOf("/")+1,_599.url.length));for(i=_598.length-1;i>=0;i--){if(_598[i].id==id){if(_599.minScale==0&&_598[i].minScale>0){_599.minScale=_598[i].minScale;}else{if(_599.minScale>0&&_598[i].minScale==0){_599.minScale=_599.minScale;}else{if(_599.minScale>0&&_598[i].minScale>0){_599.minScale=Math.min(_599.minScale,_598[i].minScale);}}}_599.maxScale=Math.max(_599.maxScale||0,_598[i].maxScale||0);if(_598[i].parentLayerId>-1){id=_598[i].parentLayerId;}else{break;}}}}};function _59a(_59b,_59c,_59d,map){var url=_59b.url;var _59e=_59b.__popups;var ids=_59b.__popupIds;var urls=_59b.__popupUrls;var _59f=_59b.__resourceInfo;var _5a0=[];_4de.forEach(_59e,function(_5a1,_5a2){if(!_5a1){return;}var _5a3,_5a4=[];_4de.forEach(_5a1.fieldInfos,function(item){if(item.fieldName.toLowerCase()!=="shape"){_5a4.push(item.fieldName);}});if(_59b.dynamicLayerInfos&&_59b.dynamicLayerInfos.length>0){var _5a5=_4de.filter(_59b.dynamicLayerInfos,function(item){return ids[_5a2]==item.id;})[0].source;_5a3=new _4f8(url+"/dynamicLayer",{id:_59b.id+"_"+ids[_5a2],source:_5a5,outFields:_5a4,mode:_4f8.MODE_SELECTION,infoTemplate:_5a1&&new _59d(_5a1),drawMode:false,visible:_59b.visible,autoGeneralize:true});}else{var i,_5a6=null;if(_59c){for(i=0;i<_59c.length;i++){if(_59c[i].id===ids[_5a2]){_5a6=_59c[i];break;}}}var _5a7=url+"/"+ids[_5a2];if(urls[_5a2].length){_5a7=urls[_5a2];}_5a3=new _4f8(_52c(_5a7),{id:_59b.id+"_"+ids[_5a2],outFields:_5a4,mode:_4f8.MODE_SELECTION,infoTemplate:_5a1&&new _59d(_5a1),drawMode:false,visible:_59b.visible,resourceInfo:_5a6,autoGeneralize:true});}if(_5a3.loaded){_597(_59f.layers,_5a3);}else{_4df.connect(_5a3,"onLoad",function(_5a8){_597(_59f.layers,_5a8);});}_5a0.push(_5a3);});if(_5a0.length>0){var _5a9=function(_5aa,_5ab){_4de.forEach(_5aa,function(_5ac){if(_5ab){_5ac.show();}else{_5ac.hide();}});};_4df.connect(_59b,"onVisibilityChange",lang.hitch(this,_5a9,_5a0));var _5ad=function(_5ae,_5af,_5b0){if(_5ae.id===_5b0.id){_4de.forEach(_5af,function(_5b1){map.removeLayer(_5b1);});}};_4df.connect(map,"onLayerRemove",lang.hitch(this,_5ad,_59b,_5a0));}delete _59b.__popups;delete _59b.__popupIds;delete _59b.__popupUrls;delete _59b.__resourceInfo;return _5a0;};function _5b2(_5b3){return _4e7({url:_52c(_5b3.url+"/layers"),content:{f:"json"},callbackParamName:"callback",error:function(){}});};function _5b4(_5b5,map,_5b6){var _5b7=[];_4de.forEach(_5b5,function(_5b8){var _5b9=_5b8.__popups;if(_5b9&&_5b9.length>1&&_5b8.version>=10){_5b8.__deferredsPos=_5b7.length;_5b7.push(_5b2(_5b8));}});var _5ba=[];if(_5b7.length>0){var _5bb=new _4e2(_5b7);_5bb.addCallback(function(_5bc){_4de.forEach(_5b5,function(_5bd){if(_5bd.__popups&&_5bd.__popups.length>0){if(_5bd.__deferredsPos||_5bd.__deferredsPos===0){var _5be=_5bc[_5bd.__deferredsPos][1];_5ba=_5ba.concat(_59a(_5bd,_5be.layers,_5b6,map));delete _5bd.__deferredsPos;}else{_5ba=_5ba.concat(_59a(_5bd,null,_5b6,map));}}});map.addLayers(_5ba);});}else{_4de.forEach(_5b5,function(_5bf){if(_5bf.__popups&&_5bf.__popups.length>0){_5ba=_5ba.concat(_59a(_5bf,null,_5b6,map));}});map.addLayers(_5ba);}};function _5c0(_5c1){_4de.forEach(_5c1,function(_5c2){var _5c3=_5c2.layer;if(_5c3.toJson){var json=_5c3.toJson();if(json.featureSet&&_5c3.name.indexOf("Text")>-1){_4de.forEach(json.featureSet.features,function(_5c4,idx){if(_5c4.attributes.TEXT){var _5c5=_5c3.graphics[idx];_5c5.symbol.setText(_5c4.attributes.TEXT);if(_5c4.symbol.horizontalAlignment){_5c5.symbol.align=_5c4.symbol.horizontalAlignment;}_5c5.setSymbol(_5c5.symbol);_5c5.setAttributes(_5c4.attributes);}},this);}}});};function _5c6(_5c7){var _5c8=6;_4de.forEach(_5c7,function(_5c9){var _5ca=_5c9.renderer;if(_5ca.declaredClass==="esri.renderer.SimpleRenderer"){var _5cb=_5ca.symbol;if(_5cb&&_5cb.xoffset){_5c8=Math.max(_5c8,Math.abs(_5cb.xoffset));}if(_5cb&&_5cb.yoffset){_5c8=Math.max(_5c8,Math.abs(_5cb.yoffset));}}else{if(_5ca.declaredClass==="esri.renderer.UniqueValueRenderer"||_5ca.declaredClass==="esri.renderer.ClassBreaksRenderer"){_4de.forEach(_5ca.infos,function(info){var _5cc=info.symbol;if(_5cc&&_5cc.xoffset){_5c8=Math.max(_5c8,Math.abs(_5cc.xoffset));}if(_5cc&&_5cc.yoffset){_5c8=Math.max(_5c8,Math.abs(_5cc.yoffset));}});}}});return _5c8;};function _5cd(evt){var map=this,_5ce=map.infoWindow,_5cf=evt.graphic;if(!map.loaded){return;}_5ce.hide();_5ce.clearFeatures();var _5d0=[];_4de.forEach(map.graphicsLayerIds,function(_5d1){var _5d2=map.getLayer(_5d1);if(_5d2&&_5d2.declaredClass.indexOf("FeatureLayer")!==-1&&_5d2.loaded&&_5d2.visible){_5d2.clearSelection();if(_5d2.infoTemplate&&!_5d2.suspended){_5d0.push(_5d2);}}});_5cf=(_5cf&&_5cf.getInfoTemplate())?_5cf:null;if(!_5d0.length&&!_5cf){return;}var _5d3=_5c6(_5d0);var _5d4=evt.screenPoint,_5d5=map.toMap(new _4ea(_5d4.x-_5d3,_5d4.y+_5d3)),_5d6=map.toMap(new _4ea(_5d4.x+_5d3,_5d4.y-_5d3)),_5d7=new _4eb(_5d5.x,_5d5.y,_5d6.x,_5d6.y,map.spatialReference);var _5d8=new _4f1();_5d8.geometry=_5d7;_5d8.timeExtent=map.timeExtent;var _5d9=_4de.map(_5d0,function(_5da){var dfd=_5da.selectFeatures(_5d8);dfd.addCallback(function(){var _5db=_5da.getSelectedFeatures();return _5db;});return dfd;});if(_5cf){var dfd=new _4e0();dfd.callback([_5cf]);_5d9.splice(0,0,dfd);}var _5dc=_4de.some(_5d9,function(dfd){return dfd.fired===-1;});if(!_5dc){var _5dd=_5cf?1:0;_4de.forEach(_5d0,function(_5de){_5dd=_5dd+_5de.getSelectedFeatures().length;});if(!_5dd){return;}}_5ce.setFeatures(_5d9);_5ce.show(evt.mapPoint,{closestFirst:true});};function _5df(_5e0,_5e1,_5e2,_5e3,_5e4,_5e5){var _5e6=(_5e4.mapOptions||{}),_5e7,_5e8;if(!_5e6.infoWindow){_5e7=new _4f0(null,_4e3.create("div"));_5e6.infoWindow=_5e7;}if(!_4e6.isDefined(_5e6.showInfoWindowOnClick)){_5e6.showInfoWindowOnClick=false;}var map=new Map(_5e3,_5e6);if(_5e4.ignorePopups){_4de.forEach(_5e0,function(_5e9){delete _5e9.infoTemplate;});}if(!(_5e4.ignorePopups||_5e4.disableClickBehavior)){_5e8=_4df.connect(map,"onClick",_5cd);}_4df.connect(map,"onLayersAddResult",_5c0);map.addLayers(_5e0);if(!_5e4.ignorePopups){_5b4(_5e0,map,_5e4._clazz);}var _5ea=[];_4de.forEach(_5e1,function(_5eb){_5ea=_5ea.concat(_5eb.errors);},this);_5e5.callback({map:map,itemInfo:_5e2,errors:_5ea,clickEventHandle:_5e8,clickEventListener:_5cd});};function _5ec(_5ed,_5ee,_5ef,_5f0,_5f1){try{var _5f2=_5ef.mapOptions||{};_5ef.mapOptions=_5f2;var card=_5ed.item;var _5f3=[];_4de.forEach(_5f1,function(_5f4){if(lang.isArray(_5f4.layerObject)){_4de.forEach(_5f4.layerObject,function(l){_5f3.push(l);});}else{_5f3.push(_5f4.layerObject);}});if(!_5f3[0]){var msg="";if(_5f1[0].errors&&_5f1[0].errors.length){msg=" ("+_5f1[0].errors[0].message+")";}_5f0.errback(new Error(_503.arcgis.utils.baseLayerError+msg));return;}_5f3=_4de.filter(_5f3,_4e6.isDefined);if(card){if(card.extent){if(!_5f2.extent){var _5f5=new _4eb(card.extent[0][0],card.extent[0][1],card.extent[1][0],card.extent[1][1],new _4e8({wkid:4326}));var _5f6=_5f3[0].spatialReference;if(_5f6.wkid===4326){_5f2.extent=_5f5;_5df(_5f3,_5f1,_5ed,_5ee,_5ef,_5f0);}else{if(_5f6.wkid===102100||_5f6.wkid===102113||_5f6.wkid===3857){_5f5.xmin=Math.max(_5f5.xmin,-180);_5f5.xmax=Math.min(_5f5.xmax,180);_5f5.ymin=Math.max(_5f5.ymin,-89.99);_5f5.ymax=Math.min(_5f5.ymax,89.99);_5f2.extent=_4ec.geographicToWebMercator(_5f5);_5df(_5f3,_5f1,_5ed,_5ee,_5ef,_5f0);}else{if(_5ef.geometryServiceURL||_4e5.defaults.geometryService){var gs;if(_5ef.geometryServiceURL){gs=new _4f2(_5ef.geometryServiceURL);}else{gs=_4e5.defaults.geometryService;}gs.project([_5f5],_5f6,function(_5f7){var _5f8=_5f7[0];_5f2.extent=_5f2.extent||_5f8;_5df(_5f3,_5f1,_5ed,_5ee,_5ef,_5f0);});}else{_5f0.errback(new Error(_503.arcgis.utils.geometryServiceError));}}}}else{_5df(_5f3,_5f1,_5ed,_5ee,_5ef,_5f0);}}else{_5df(_5f3,_5f1,_5ed,_5ee,_5ef,_5f0);}}else{_5df(_5f3,_5f1,_5ed,_5ee,_5ef,_5f0);}}catch(err){_5f0.errback(err);}};function _5f9(_5fa){var _5fb=[];var _5fc=_5fa.baseMap.baseMapLayers.concat(_5fa.operationalLayers);_4de.forEach(_5fc,function(_5fd,_5fe){var _5ff={};if(_5fd.featureCollection&&_5fd.type!=="CSV"){if(_5fd.featureCollection.showLegend===true){_4de.forEach(_5fd.featureCollection.layers,function(_600){if(_600.showLegend!==false){_5ff={"layer":_600.layerObject,"title":_5fd.title,"defaultSymbol":false};if(_5fd.featureCollection.layers.length>1){_5ff.title+=" - "+_600.layerDefinition.name;}_5fb.push(_5ff);}});}}else{if((_5fd.baseMapLayer&&_5fd.showLegend===true&&_5fd.layerObject)||(!_5fd.baseMapLayer&&_5fd.showLegend!==false&&_5fd.layerObject)){var _601=false;if(_5fd.layerObject.version<10.1&&(_5fd.layerObject instanceof _4f4||_5fd.layerObject instanceof _4f3)){_601=true;}_5ff={"layer":_5fd.layerObject,"title":_5fd.title,"defaultSymbol":_601};if(_5fd.layers){var _602=_4de.map(_4de.filter(_5fd.layers,function(lyr){return (lyr.showLegend===false);}),function(lyr){return lyr.id;});if(_602.length){_5ff.hideLayers=_602;}}_5fb.push(_5ff);}}});return _5fb;};function _603(_604){if(_504._arcgisUrl&&_504._arcgisUrl.length>0){_504.arcgisUrl=_504._arcgisUrl;}var url=_504.arcgisUrl+"/"+_604;var _605={},_606=new _4e0();_4e7({url:url,content:{f:"json"},callbackParamName:"callback",load:function(_607){_605.item=_607;_4e7({url:url+"/data",content:{f:"json"},callbackParamName:"callback",load:function(_608){_605.itemData=_608;_606.callback(_605);},error:function(_609){_606.errback(_609);}});},error:function(_60a){_606.errback(_60a);}});return _606;};function _60b(arg1,_60c,_60d){var _60e=new _4e0();_60d=_60d||{};var _60f=_60d.infoTemplateClass;_60d._clazz=(_60f&&(lang.isObject(_60f)?_60f:lang.getObject(_60f)))||_4ef;if(lang.isString(arg1)){_603(arg1).addCallback(function(_610){_50f(_610,_60d).addCallback(function(_611){_584(_611.itemData,_60d).addCallback(lang.hitch(null,_5ec,_611,_60c,_60d,_60e));});}).addErrback(lang.hitch(_60e,_60e.errback));}else{_50f(arg1,_60d).addCallback(function(_612){_584(_612.itemData,_60d).addCallback(lang.hitch(null,_5ec,_612,_60c,_60d,_60e));});}return _60e;};function _613(_614){if(_614&&_614.itemInfo&&_614.itemInfo.itemData){return _5f9(_614.itemInfo.itemData);}else{return [];}};_504={arcgisUrl:location.protocol+"//www.arcgis.com/sharing/rest/content/items",getItem:_603,createMap:_60b,getLegendLayers:_613,_arcgisUrl:null,_getItemProps:_50f,_getItemData:_505,_getBingKey:_508,_processFSItemProperties:_50d,_getLayers:_584,_preBuildLayerObjects:_573,_buildLayerObjects:_567,_preCreateMap:_5ec,_getMapSR:_56f,_createMap:_5df,_addSelectionLayers:_5b4,_createSelectionFeatureLayers:_59a,_getServiceInfo:_581,_getLayersInfo:_5b2,_initLayer:_551,_loadAsCached:_52d,_loadAsDynamic:_538,_processPopups:_520,_onLayersAddResult:_5c0,_sameSpatialReferenceAsBasemap:_546,_sameTilingSchemeAsBasemap:_54a,_showPopup:_5cd,_calculateClickTolerance:_5c6,_getVisibleFeatureLayers:_531,_updateLayerScaleInfo:_597,_checkUrl:_52c,_isHostedService:_528,_isAgolService:_52b,_getLegendLayers:_5f9};lang.setObject("arcgis.utils",_504,_4e4);return _504;});